webpackJsonp([1],[function(e,t,o){e.exports=o(367)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=o(2),r=n(i),a=o(368),s=n(a),l=o(369),u=n(l),c=o(474),d=n(c);window.Perf=d["default"],s["default"].render(r["default"].createElement(u["default"],null),document.getElementById("content"))},function(e,t,o){"use strict";e.exports=o(4)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(234),r=n(i),a=o(237),s=n(a),l=o(238),u=n(l),c=o(242),d=n(c),h=o(243),p=n(h),f=o(2),m=n(f),v=o(370),y=n(v),g=o(375),w=n(g),b=o(378),x=n(b),E=o(395),M=n(E),C=o(396),_=n(C),S=o(399),P=n(S),R=o(404),A=n(R),B=o(412),T=n(B),I=o(469),z=n(I),F=o(471),V=n(F),q=o(473),L=n(q),k=[{name:"Simple",component:y["default"],url:"Simple/index"},{name:"Cloth",component:x["default"],url:"AnimationCloth/index"},{name:"Camera",component:_["default"],url:"WebGLCameraExample/index"},{name:"Geometries",component:M["default"],url:"Geometries/index"},{name:"Geometry Shapes",component:P["default"],url:"GeometryShapes/index"},{name:"Draggable Cubes",component:A["default"],url:"DraggableCubes/index"},{name:"Physics",component:T["default"],url:"Physics/index"},{name:"Physics - MousePick",component:z["default"],url:"Physics/mousePick"},{separator:!0,name:"Advanced"},{name:"Without react-dom",advanced:!0,page:"advanced.html"},{name:"Manual rendering",component:w["default"],url:"ManualRendering/index"},{separator:!0,name:"Benchmarks"},{name:"RotatingCubes - Through React",component:V["default"],url:"Benchmark/RotatingCubes"},{name:"RotatingCubes - Direct Updates",component:L["default"],url:"Benchmark/RotatingCubesDirectUpdates"}],N=function(e){function t(e,o){(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,r["default"])(t).call(this,e,o));return n._onWindowResize=function(){var e=n.refs.viewer;n.setState({viewerWidth:e.offsetWidth,viewerHeight:e.offsetHeight})},n.state={activeExample:null,viewerWidth:0,viewerHeight:0},n}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this._onWindowResize,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._onWindowResize,!1)}},{key:"render",value:function(){var e=this,t=null,o=this.state,n=o.viewerWidth,i=o.viewerHeight,r=null;if(null!==this.state.activeExample){var a=k[this.state.activeExample],s=a.component,l=a.url;t=m["default"].createElement(s,{width:n,height:i}),r=m["default"].createElement("div",{key:"src",id:"button"},m["default"].createElement("a",{href:"https://github.com/toxicFork/react-three-renderer-example/blob/master/src/examples/"+l+".js",target:"_blank"},"View source"))}return m["default"].createElement("div",null,m["default"].createElement("div",{id:"panel",className:"collapsed"},m["default"].createElement("h1",null,m["default"].createElement("a",{href:"https://github.com/toxicFork/react-three-renderer/"},"react-three-renderer")," / examples"),m["default"].createElement("div",{id:"content"},m["default"].createElement("div",null,m["default"].createElement("h2",null,"webgl"),k.map(function(t,o){if(t.separator)return m["default"].createElement("h2",{key:o},t.name);if(t.advanced)return m["default"].createElement("div",{key:o},m["default"].createElement("a",{href:t.page,target:"blank"},t.name)," (new tab)");var n=function(){var t=e.refs.viewer;e.setState({viewerWidth:t.offsetWidth,viewerHeight:t.offsetHeight,activeExample:o})};return m["default"].createElement("div",{className:"link",key:o,onClick:n},t.name)})))),m["default"].createElement("div",{id:"viewer",ref:"viewer"},t,r))}}]),t}(m["default"].Component);t["default"]=N},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=o(371),w=n(g),b=o(251),x=n(b),E=(r=i=function(e){function t(e,o){(0,u["default"])(this,t);var n=(0,p["default"])(this,(0,s["default"])(t).call(this,e,o));return n.cameraPosition=new x["default"].Vector3(0,0,5),n.state={cubeRotation:new x["default"].Euler},n._onAnimate=function(){n.setState({cubeRotation:new x["default"].Euler(n.state.cubeRotation.x+.1,n.state.cubeRotation.y+.1,0)})},n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.width,o=e.height;return y["default"].createElement(w["default"],{mainCamera:"camera",width:t,height:o,onAnimate:this._onAnimate},y["default"].createElement("scene",null,y["default"].createElement("perspectiveCamera",{name:"camera",fov:75,aspect:t/o,near:.1,far:1e3,position:this.cameraPosition}),y["default"].createElement("mesh",{rotation:this.state.cubeRotation},y["default"].createElement("boxGeometry",{width:1,height:1,depth:1}),y["default"].createElement("meshBasicMaterial",{color:65280}))))}}]),t}(y["default"].Component),i.propTypes={width:y["default"].PropTypes.number.isRequired,height:y["default"].PropTypes.number.isRequired},r);t["default"]=E},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i=o(372),r=n(i);e.exports=r["default"]},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var i,r,a=o(257),s=n(a),l=o(234),u=n(l),c=o(237),d=n(c),h=o(238),p=n(h),f=o(242),m=n(f),v=o(243),y=n(v),g=o(2),w=n(g),b=o(154),x=n(b),E=o(373),M=n(E),C=o(251),_=n(C),S=o(275),P=n(S),R=w["default"].PropTypes,A=(r=i=function(e){function t(e,o){(0,d["default"])(this,t);var n=(0,m["default"])(this,(0,u["default"])(t).call(this,e,o));return n.shouldComponentUpdate=M["default"].shouldComponentUpdate,n._onRecreateCanvas=function(){n.setState({canvasKey:n.state.canvasKey+1})},n.state={canvasKey:0},n}return(0,y["default"])(t,e),(0,p["default"])(t,[{key:"componentDidMount",value:function(){this.react3Renderer=new x["default"],this._render()}},{key:"componentDidUpdate",value:function(){this._render()}},{key:"componentWillUnmount",value:function(){this.react3Renderer.dispose(),delete this.react3Renderer}},{key:"_render",value:function(){var e=this.refs.canvas,t=(0,s["default"])({},this.props);delete t.canvasStyle,this.react3Renderer.render(w["default"].createElement("react3",(0,s["default"])({},t,{onRecreateCanvas:this._onRecreateCanvas}),this.props.children),e)}},{key:"render",value:function(){var e=this.state.canvasKey;return w["default"].createElement("canvas",{ref:"canvas",key:e,width:this.props.width,height:this.props.height,style:(0,s["default"])({},this.props.canvasStyle,{width:this.props.width,height:this.props.height})})}}]),t}(w["default"].Component),i.propTypes={context:R.string,width:R.number.isRequired,height:R.number.isRequired,children:R.any,canvasStyle:R.any,gammaInput:R.bool,gammaOutput:R.bool,sortObjects:R.bool,mainCamera:R.string,onAnimate:R.func,clearColor:R.oneOfType([(0,P["default"])(_["default"].Color),R.number,R.string]),shadowMapEnabled:R.bool,shadowMapType:R.oneOf([_["default"].BasicShadowMap,_["default"].PCFShadowMap,_["default"].PCFSoftShadowMap]),shadowMapCullFace:R.oneOf([_["default"].CullFaceNone,_["default"].CullFaceBack,_["default"].CullFaceFront,_["default"].CullFaceFrontBack]),shadowMapDebug:R.bool,pixelRatio:R.number,antialias:R.oneOfType([R.bool,R.number])},i.defaultProps={context:"3d"},i.findTHREEObject=x["default"].findTHREEObject,i.eventDispatcher=x["default"].eventDispatcher,r);e.exports=A},function(e,t,o){"use strict";var n=o(374),i={shouldComponentUpdate:function(e,t){return n(this,e,t)}};e.exports=i},function(e,t,o){"use strict";function n(e,t,o){return!i(e.props,t)||!i(e.state,o)}var i=o(117);e.exports=n},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(234),r=n(i),a=o(237),s=n(a),l=o(238),u=n(l),c=o(242),d=n(c),h=o(243),p=n(h),f=o(2),m=n(f),v=o(371),y=n(v),g=o(251),w=n(g),b=o(376),x=n(b),E=o(377),M=n(E),C=function(e){function t(e,o){(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,r["default"])(t).call(this,e,o));return n._onUpdateColorButtonPress=function(){n.setState({cubeColor:Math.floor(16777215*Math.random())})},n._onRenderButtonPress=function(){n._renderTrigger()},n._onManualButtonPress=function(){n.setState({forceManual:!n.state.forceManual})},n.cameraPosition=new w["default"].Vector3(0,0,5),n._onManualRenderTriggerCreated=function(e){n._renderTrigger=e},n.state={cubeColor:65280,forceManual:!0},n}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){var e=this;this._renderTrigger(),setTimeout(function(){e.setState({cubeColor:255})},20),setTimeout(function(){e.setState({cubeColor:16711680},function(){e._renderTrigger()})},1e3)}},{key:"render",value:function(){var e=this.props,t=e.width,o=e.height,n=this.state,i=n.forceManual,r=n.cubeColor;return m["default"].createElement("div",null,m["default"].createElement("div",null,m["default"].createElement(M["default"],{onUpdateColorButtonPress:this._onUpdateColorButtonPress,onRenderButtonPress:this._onRenderButtonPress,onManualButtonPress:this._onManualButtonPress,forceManual:i,cubeColor:r})),m["default"].createElement(y["default"],{width:t,height:o,forceManualRender:i,onManualRenderTriggerCreated:this._onManualRenderTriggerCreated,mainCamera:"camera"},m["default"].createElement("scene",null,m["default"].createElement("perspectiveCamera",{name:"camera",fov:75,aspect:t/o,near:.1,far:1e3,position:this.cameraPosition}),m["default"].createElement("mesh",null,m["default"].createElement("boxGeometry",{width:1,height:1,depth:1}),m["default"].createElement("meshBasicMaterial",{color:r})))))}}]),t}(x["default"]);t["default"]=C},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(234),s=n(a),l=o(237),u=n(l),c=o(242),d=n(c),h=o(243),p=n(h),f=o(2),m=n(f),v=m["default"].PropTypes,y=(r=i=function(e){function t(){return(0,u["default"])(this,t),(0,d["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,p["default"])(t,e),t}(m["default"].Component),i.propTypes={width:v.number.isRequired,height:v.number.isRequired},r);t["default"]=y},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=y["default"].PropTypes,w=(r=i=function(e){function t(e,o){(0,u["default"])(this,t);var n=(0,p["default"])(this,(0,s["default"])(t).call(this,e,o));return n._onColorButtonPress=function(){n.props.onUpdateColorButtonPress(),n.setState({colorButtonPressed:!0})},n._onTriggerPress=function(){n.setState({colorButtonPressed:!1}),n.props.onRenderButtonPress()},n._manualButtonPress=function(){n.setState({colorButtonPressed:!1}),n.props.onManualButtonPress()},n.state={colorButtonPressed:!1},n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.forceManual,o=e.cubeColor,n=this.state.colorButtonPressed,i={};return n&&t&&(i.fontWeight="bold"),y["default"].createElement("div",{style:{position:"absolute",textAlign:"center",top:0,width:"100%",padding:5,color:"white",zIndex:100}},y["default"].createElement("h2",null,"Manual rendering"),'If automatic rendering is off, the canvas will re-render only when you press the "Trigger render" button.',y["default"].createElement("br",null),"This way you can save battery life or have finer controls for rendering.",y["default"].createElement("br",null),"Check your CPU profiler with automatic rendering on/off :)",y["default"].createElement("br",null),y["default"].createElement("br",null),y["default"].createElement("button",{onClick:this._onColorButtonPress},"Update cube color state"),y["default"].createElement("span",{style:{width:15,minHeight:15,marginLeft:5,display:"inline-block",background:"rgb(\n            "+(o>>16&255)+",\n            "+(o>>8&255)+",\n            "+(255&o)+")"}}," "),y["default"].createElement("br",null),y["default"].createElement("button",{onClick:this._onTriggerPress,style:i,disabled:!t},n&&t?"TRIGGER RENDER":"Trigger render"),y["default"].createElement("br",null),y["default"].createElement("button",{onClick:this._manualButtonPress},"Turn automatic rendering ",t?"ON":"OFF"))}}]),t}(y["default"].Component),i.propTypes={onUpdateColorButtonPress:g.func.isRequired,onRenderButtonPress:g.func.isRequired,onManualButtonPress:g.func.isRequired,forceManual:g.bool,cubeColor:g.number.isRequired},r);t["default"]=w},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,o){U.subVectors(t.position,e.position);var n=U.length();if(0!==n){var i=U.multiplyScalar(1-o/n),r=i.multiplyScalar(.5);e.position.add(r),t.position.sub(r)}}Object.defineProperty(t,"__esModule",{value:!0});var r=o(257),a=n(r),s=o(234),l=n(s),u=o(237),c=n(u),d=o(238),h=n(d),p=o(242),f=n(p),m=o(243),v=n(m),y=o(2),g=n(y),w=o(368),b=n(w),x=o(251),E=n(x),M=o(379),C=n(M),_=o(371),S=n(_),P=o(376),R=n(P),A=o(380),B=n(A),T=o(381),I=n(T),z=o(382),F=n(z),V=o(393),q=n(V),L=o(394),k=n(L),N=60,j=981*1.4,D=new E["default"].Vector3(0,-j,0).multiplyScalar(I["default"].MASS),O=.018,W=O*O,U=new E["default"].Vector3,X=new E["default"].Vector3,G=function(e){function t(e,o){(0,c["default"])(this,t);var n=(0,f["default"])(this,(0,l["default"])(t).call(this,e,o));n._toggleRotate=function(){n.setState({rotate:!n.state.rotate})},n._toggleWind=function(){n.setState({wind:!n.state.wind})},n._toggleSphere=function(){n.setState({sphere:!n.state.sphere})},n._togglePins=function(){n.pins=n.pinsFormation[~~(Math.random()*n.pinsFormation.length)]},n._onAnimate=function(){n.controls.update();var e=n.state.minTimePerFrame,t=void 0;if(t=e>0?Math.round(Date.now()/e)*e:Date.now(),t!==n.state.time){var o=20*Math.cos(t/7e3)+40;n.windForce.set(Math.sin(t/2e3),Math.cos(t/3e3),Math.sin(t/1e3)).normalize().multiplyScalar(o),n._simulate(t);var i=S["default"].findTHREEObject(n._clothGeometry),r=2e-4*t,a=n.cloth.particles,s=void 0,l=void 0;for(l=0,s=a.length;s>l;++l)i.vertices[l].copy(a[l].position);i.computeFaceNormals(),i.computeVertexNormals(),i.normalsNeedUpdate=!0,i.verticesNeedUpdate=!0;var u={time:t,spherePosition:n.ballPosition};n.state.rotate&&(u.cameraPosition=new E["default"].Vector3(1500*Math.cos(r),n.state.cameraPosition.y,1500*Math.sin(r))),n.setState(u),n.stats.update()}},n._clothRef=function(e){n._clothGeometry=e},n._onFrameChange=function(e){n.setState({minTimePerFrame:+e.target.value})},n.state=(0,a["default"])({},n.state,{minTimePerFrame:0,rotate:!0,wind:!0,sphere:!1});var i=10,r=10;n.cloth=new I["default"](i,r);var s=[],u=[6];return s.push(u),u=[0,1,2,3,4,5,6,7,8,9,10],s.push(u),u=[0],s.push(u),u=[],s.push(u),u=[0,n.cloth.w],s.push(u),u=s[1],n.pins=u,n.pinsFormation=s,n.fog=new E["default"].Fog(13426943,500,1e4),n.windForce=new E["default"].Vector3(0,0,0),n.state=(0,a["default"])({},n.state,{ballPosition:new E["default"].Vector3(0,-45,0),cameraPosition:new E["default"].Vector3(0,50,1500)}),n.scenePosition=new E["default"].Vector3(0,0,0),n}return(0,v["default"])(t,e),(0,h["default"])(t,[{key:"componentDidMount",value:function(){var e=this,t=new k["default"](this.refs.mainCamera,b["default"].findDOMNode(this.refs.react3));t.rotateSpeed=1,t.zoomSpeed=1.2,t.panSpeed=.8,t.noZoom=!1,t.noPan=!1,t.staticMoving=!0,t.dynamicDampingFactor=.3,t.addEventListener("change",function(){e.setState({cameraPosition:e.refs.mainCamera.position})}),this.controls=t,this.stats=new C["default"],this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.refs.container.appendChild(this.stats.domElement)}},{key:"componentWillUnmount",value:function(){delete this.stats,this.controls.dispose(),delete this.controls}},{key:"_simulate",value:function(e){if(!this.lastTime)return void(this.lastTime=e);var t=void 0,o=void 0,n=void 0,r=void 0,a=void 0,s=void 0,l=S["default"].findTHREEObject(this._clothGeometry),u=S["default"].findTHREEObject(this.refs.sphere);if(this.state.wind){var c=void 0,d=l.faces,h=void 0;for(n=this.cloth.particles,t=0,o=d.length;o>t;t++)c=d[t],h=c.normal,X.copy(h).normalize().multiplyScalar(h.dot(this.windForce)),n[c.a].addForce(X),n[c.b].addForce(X),n[c.c].addForce(X)}for(n=this.cloth.particles,t=0,o=n.length;o>t;t++)r=n[t],r.addForce(D),r.integrate(W);for(a=this.cloth.constrains,o=a.length,t=0;o>t;t++)s=a[t],i(s[0],s[1],s[2]);var p=this.state.ballPosition.clone();if(p.z=90*-Math.sin(Date.now()/600),p.x=70*Math.cos(Date.now()/400),u.visible)for(n=this.cloth.particles,t=0,o=n.length;o>t;t++){r=n[t];var f=r.position;U.subVectors(f,p),U.length()<N&&(U.normalize().multiplyScalar(N),f.copy(p).add(U))}for(n=this.cloth.particles,t=0,o=n.length;o>t;t++){r=n[t];var m=r.position;m.y<-250&&(m.y=-250)}for(t=0,o=this.pins.length;o>t;t++){var v=this.pins[t],y=n[v];y.position.copy(y.original),y.previous.copy(y.original)}this.setState({ballPosition:p})}},{key:"render",value:function(){var e=this.props,t=e.width,o=e.height,n=this.state.minTimePerFrame;return g["default"].createElement("div",{ref:"container"},g["default"].createElement(B["default"],{toggleRotate:this._toggleRotate,toggleWind:this._toggleWind,toggleSphere:this._toggleSphere,togglePins:this._togglePins,rotating:this.state.rotate,winding:this.state.wind,balling:this.state.sphere,onFrameChange:this._onFrameChange,minTimePerFrame:n}),g["default"].createElement(S["default"],{ref:"react3",width:t,height:o,antialias:!0,pixelRatio:window.devicePixelRatio,clearColor:this.fog.color,gammaInput:!0,gammaOutput:!0,shadowMapEnabled:!0,shadowMapDebug:!0,mainCamera:"mainCamera",onAnimate:this._onAnimate},g["default"].createElement("scene",{fog:this.fog},g["default"].createElement("perspectiveCamera",{name:"mainCamera",fov:30,aspect:t/o,ref:"mainCamera",position:this.state.cameraPosition,near:1,far:1e4,lookAt:this.state.rotate?this.scenePosition:null}),g["default"].createElement(F["default"],{clothRef:this._clothRef,cloth:this.cloth}),g["default"].createElement(q["default"],{ref:"sphere",visible:this.state.sphere,position:this.state.ballPosition}))))}}]),t}(R["default"]);t["default"]=G},function(e,t,o){var n=function(){var e=Date.now(),t=e,o=0,n=1/0,i=0,r=0,a=1/0,s=0,l=0,u=0,c=document.createElement("div");c.id="stats",c.addEventListener("mousedown",function(e){e.preventDefault(),g(++u%2)},!1),c.style.cssText="width:80px;opacity:0.9;cursor:pointer";var d=document.createElement("div");d.id="fps",d.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",c.appendChild(d);var h=document.createElement("div");h.id="fpsText",h.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",h.innerHTML="FPS",d.appendChild(h);var p=document.createElement("div");for(p.id="fpsGraph",p.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",d.appendChild(p);p.children.length<74;){var f=document.createElement("span");f.style.cssText="width:1px;height:30px;float:left;background-color:#113",p.appendChild(f)}var m=document.createElement("div");m.id="ms",m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",c.appendChild(m);var v=document.createElement("div");v.id="msText",v.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",v.innerHTML="MS",m.appendChild(v);var y=document.createElement("div");for(y.id="msGraph",y.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",m.appendChild(y);y.children.length<74;){var f=document.createElement("span");f.style.cssText="width:1px;height:30px;float:left;background-color:#131",y.appendChild(f)}var g=function(e){switch(u=e){case 0:d.style.display="block",m.style.display="none";break;case 1:d.style.display="none",m.style.display="block"}},w=function(e,t){var o=e.appendChild(e.firstChild);o.style.height=t+"px"};return{REVISION:12,domElement:c,setMode:g,begin:function(){e=Date.now()},end:function(){var u=Date.now();return o=u-e,n=Math.min(n,o),i=Math.max(i,o),v.textContent=o+" MS ("+n+"-"+i+")",w(y,Math.min(30,30-o/200*30)),l++,u>t+1e3&&(r=Math.round(1e3*l/(u-t)),a=Math.min(a,r),s=Math.max(s,r),h.textContent=r+" FPS ("+a+"-"+s+")",w(p,Math.min(30,30-r/100*30)),t=u,l=0),u},update:function(){e=this.end()}}};e.exports=n},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=y["default"].PropTypes,w=(r=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e={textDecoration:"underline",cursor:"pointer"},t=this.props,o=t.toggleRotate,n=t.toggleWind,i=t.toggleSphere,r=t.togglePins,a=t.minTimePerFrame,s=t.onFrameChange,l=t.rotating,u=t.winding,c=t.balling;return y["default"].createElement("div",{style:{textAlign:"center",padding:10,zIndex:10,width:"100%",position:"absolute",color:"#000"}},y["default"].createElement("a",{href:"http://threejs.org",style:{color:"#0080ff"}},"three.js")," - Simple Cloth Simulation",y["default"].createElement("br",null),"Verlet integration with Constrains relaxation",y["default"].createElement("br",null),"Toggle: ",y["default"].createElement("a",{onClick:o,style:e},"Camera",l?"*":null)," |",y["default"].createElement("span",null," ",y["default"].createElement("a",{onClick:n,style:e},"Wind",u?"*":null))," |",y["default"].createElement("span",null," ",y["default"].createElement("a",{onClick:i,style:e},"Ball",c?"*":null))," |",y["default"].createElement("span",null," ",y["default"].createElement("a",{onClick:r,style:e},"Pins"))," |",y["default"].createElement("span",null," Time between frames (ms): ",y["default"].createElement("input",{onChange:s,value:a,type:"number",style:{width:40},min:"0"})," "),y["default"].createElement("br",null),y["default"].createElement("span",null,"Note: add some time between frames (e.g. 60ms) if you would like to inspect the scene through react devtools, because updating every frame kills the addon."))}}]),t}(y["default"].Component),i.propTypes={toggleWind:g.func.isRequired,toggleSphere:g.func.isRequired,togglePins:g.func.isRequired,toggleRotate:g.func.isRequired,onFrameChange:g.func.isRequired,minTimePerFrame:g.number.isRequired,rotating:g.bool.isRequired,winding:g.bool.isRequired,balling:g.bool.isRequired},r);t["default"]=w},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){return function(o,n){var i=(o-.5)*e,r=(n+.5)*t,a=0;return new h["default"].Vector3(i,r,a)}}Object.defineProperty(t,"__esModule",{value:!0});var r,a,s=o(237),l=n(s),u=o(238),c=n(u),d=o(251),h=n(d),p=.03,f=1-p,m=.1,v=25,y=10,g=10,w=i(v*y,v*g),b=function(){function e(t,o,n,i){(0,l["default"])(this,e),this.position=w(t,o),this.previous=w(t,o),this.original=w(t,o),this.a=new h["default"].Vector3(0,0,0),this.mass=i,this.invMass=1/i,this.tmp=new h["default"].Vector3,this.tmp2=new h["default"].Vector3}return(0,c["default"])(e,[{key:"addForce",value:function(e){this.a.add(this.tmp2.copy(e).multiplyScalar(this.invMass))}},{key:"integrate",value:function(e){var t=this.tmp.subVectors(this.position,this.previous);t.multiplyScalar(f).add(this.position),t.add(this.a.multiplyScalar(e)),this.tmp=this.previous,this.previous=this.position,this.position=t,this.a.set(0,0,0)}}]),e}(),x=(a=r=function E(){function e(e,o){return e+o*(t+1)}var t=arguments.length<=0||void 0===arguments[0]?10:arguments[0],o=arguments.length<=1||void 0===arguments[1]?10:arguments[1];(0,l["default"])(this,E),this.w=t,this.h=o;var n=[],i=[],r=void 0,a=void 0;for(a=0;o>=a;a++)for(r=0;t>=r;r++)n.push(new b(r/t,a/o,0,m));for(a=0;o>a;a++)for(r=0;t>r;r++)i.push([n[e(r,a)],n[e(r,a+1)],v]),i.push([n[e(r,a)],n[e(r+1,a)],v]);for(r=t,a=0;o>a;a++)i.push([n[e(r,a)],n[e(r,a+1)],v]);for(a=o,r=0;t>r;r++)i.push([n[e(r,a)],n[e(r+1,a)],v]);this.particles=n,this.constrains=i,this.index=e},r.clothFunction=w,r.MASS=m,a);t["default"]=x},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(383),s=n(a),l=o(234),u=n(l),c=o(237),d=n(c),h=o(238),p=n(h),f=o(242),m=n(f),v=o(243),y=n(v),g=o(2),w=n(g),b=o(251),x=n(b),E=o(389),M=n(E),C=o(390),_=n(C),S=o(381),P=n(S),R=o(373),A=n(R),B=o(391),T=n(B),I=o(392),z=n(I),F=w["default"].PropTypes,V=(r=i=function(e){function t(e,o){(0,d["default"])(this,t);var n=(0,m["default"])(this,(0,u["default"])(t).call(this,e,o));return n.shouldComponentUpdate=A["default"].shouldComponentUpdate,n.directionalLightPosition=new x["default"].Vector3(50,200,100).multiplyScalar(1.3),n.groundPosition=new x["default"].Vector3(0,-250,0),n.groundRotation=new x["default"].Euler(-Math.PI/2,0,0),n.groundRepeat=new x["default"].Vector2(25,25),n.state={ambientLightColor:"666666",directionalLightColor:"dfebff",fragmentShaderDepth:T["default"],vertexShaderDepth:z["default"]},n}return(0,y["default"])(t,e),(0,p["default"])(t,[{key:"render",value:function(){var e=300,t=this.state,o=t.ambientLightColor,n=t.directionalLightColor,i=t.fragmentShaderDepth,r=t.vertexShaderDepth;return w["default"].createElement("object3D",null,w["default"].createElement("resources",null,w["default"].createElement("texture",{url:"textures/patterns/circuit_pattern.png",wrapS:x["default"].RepeatWrapping,wrapT:x["default"].RepeatWrapping,anisotropy:16,resourceId:"clothTexture"})),w["default"].createElement("ambientLight",{color:(0,s["default"])(o,16)}),w["default"].createElement("directionalLight",{color:(0,s["default"])(n,16),intensity:1.75,position:this.directionalLightPosition,castShadow:!0,shadowMapWidth:1024,shadowMapHeight:1024,shadowCameraLeft:-e,shadowCameraRight:e,shadowCameraTop:e,shadowCameraBottom:-e,shadowCameraFar:1e3}),w["default"].createElement("mesh",{castShadow:!0,receiveShadow:!0},w["default"].createElement(M["default"],{ref:this.props.clothRef,cloth:this.props.cloth}),w["default"].createElement("meshPhongMaterial",{alphaTest:.5,color:16777215,specular:197379,emissive:1118481,shininess:10,side:x["default"].DoubleSide},w["default"].createElement("textureResource",{resourceId:"clothTexture"})),w["default"].createElement("shaderMaterial",{slot:"customDepthMaterial",fragmentShader:i,vertexShader:r},w["default"].createElement("uniforms",null,w["default"].createElement("uniform",{name:"texture",type:"t"},w["default"].createElement("textureResource",{resourceId:"clothTexture"}))))),w["default"].createElement("mesh",{position:this.groundPosition,rotation:this.groundRotation,receiveShadow:!0},w["default"].createElement("planeBufferGeometry",{width:2e4,height:2e4}),w["default"].createElement("meshPhongMaterial",{color:16777215,specular:1118481},w["default"].createElement("texture",{url:"textures/terrain/grasslight-big.jpg",wrapS:x["default"].RepeatWrapping,wrapT:x["default"].RepeatWrapping,repeat:this.groundRepeat,anisotropy:16}))),w["default"].createElement(_["default"],null))}}]),t}(w["default"].Component),i.propTypes={clothRef:F.func.isRequired,cloth:F.instanceOf(P["default"]).isRequired},r);t["default"]=V},function(e,t,o){e.exports={"default":o(384),__esModule:!0}},function(e,t,o){o(385),e.exports=parseInt},function(e,t,o){var n=o(171),i=o(386);n(n.S+n.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(e,t,o){var n=o(168).parseInt,i=o(387).trim,r=o(388),a=/^[\-+]?0[xX]/;e.exports=8!==n(r+"08")||22!==n(r+"0x16")?function(e,t){var o=i(String(e),3);return n(o,t>>>0||(a.test(o)?16:10))}:n},function(e,t,o){var n=o(171),i=o(183),r=o(166),a=o(388),s="["+a+"]",l="​",u=RegExp("^"+s+s+"*"),c=RegExp(s+s+"*$"),d=function(e,t,o){var i={},s=r(function(){return!!a[e]()||l[e]()!=l}),u=i[e]=s?t(h):a[e];o&&(i[o]=u),n(n.P+n.F*s,"String",i)},h=d.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(u,"")),2&t&&(e=e.replace(c,"")),e};e.exports=d},function(e,t){e.exports="	\n\x0B\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=o(381),w=n(g),b=o(373),x=n(b),E=y["default"].PropTypes,M=(r=i=function(e){function t(){var e,o,n,i;(0,u["default"])(this,t);for(var r=arguments.length,a=Array(r),l=0;r>l;l++)a[l]=arguments[l];return o=n=(0,p["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(a))),n.shouldComponentUpdate=x["default"].shouldComponentUpdate,i=o,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){var e=this.refs.geometry;e.computeFaceNormals()}},{key:"render",value:function(){var e=this.props.cloth;return y["default"].createElement("parametricGeometry",{ref:"geometry",parametricFunction:w["default"].clothFunction,slices:e.w,stacks:e.h,dynamic:!0})}}]),t}(y["default"].Component),i.propTypes={cloth:E.instanceOf(w["default"]).isRequired},r);t["default"]=M},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(383),r=n(i),a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=o(251),w=n(g),b=o(373),x=n(b),E=function(e){function t(e,o){(0,u["default"])(this,t);var n=(0,p["default"])(this,(0,s["default"])(t).call(this,e,o));return n.shouldComponentUpdate=x["default"].shouldComponentUpdate,n.state={poleMaterialColor:Number(16777215).toString(16),poleMaterialSpecular:Number(1118481).toString(16),poleMaterialShininess:100,sidePolePositions:[new w["default"].Vector3(-125,-62,0),new w["default"].Vector3(125,-62,0)],boxPositions:[new w["default"].Vector3(125,-250,0),new w["default"].Vector3(-125,-250,0)],topPolePosition:new w["default"].Vector3(0,125,0),subResource:!1},n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){return y["default"].createElement("object3D",null,y["default"].createElement("resources",null,y["default"].createElement("boxGeometry",{resourceId:"poleGeometry",width:5,height:375,depth:5}),y["default"].createElement("boxGeometry",{resourceId:"boxGeometry",width:10,height:10,depth:10}),y["default"].createElement("meshPhongMaterial",{resourceId:"poleMaterial",color:(0,r["default"])(this.state.poleMaterialColor,16),specular:(0,r["default"])(this.state.poleMaterialSpecular,16),shininess:this.state.poleMaterialShininess})),this.state.sidePolePositions.map(function(e,t){return y["default"].createElement("mesh",{key:t,position:e,receiveShadow:!0,castShadow:!0},y["default"].createElement("geometryResource",{resourceId:"poleGeometry"}),y["default"].createElement("materialResource",{resourceId:"poleMaterial"}))}),y["default"].createElement("mesh",{position:this.state.topPolePosition,receiveShadow:!0,castShadow:!0},y["default"].createElement("boxGeometry",{width:255,height:5,depth:5}),y["default"].createElement("materialResource",{resourceId:"poleMaterial"})),y["default"].createElement("object3D",null,this.state.subResource?y["default"].createElement("resources",null,this.state.subResource?y["default"].createElement("meshPhongMaterial",{resourceId:"poleMaterial",color:65280,specular:1118481,shininess:100}):null,y["default"].createElement("sphereGeometry",{resourceId:"boxGeometry",radius:20})):null,this.state.boxPositions.map(function(e,t){return y["default"].createElement("mesh",{key:t,position:e,
receiveShadow:!0,castShadow:!0},y["default"].createElement("geometryResource",{resourceId:"boxGeometry"}),y["default"].createElement("materialResource",{resourceId:"poleMaterial"}))})))}}]),t}(y["default"].Component);t["default"]=E},function(e,t){e.exports="uniform sampler2D texture;\r\nvarying vec2 vUV;\r\n\r\nvec4 pack_depth( const in float depth ) {\r\n  const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\r\n  const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\r\n  vec4 res = fract( depth * bit_shift );\r\n  res -= res.xxyz * bit_mask;\r\n\r\n  return res;\r\n}\r\n\r\nvoid main() {\r\n  vec4 pixel = texture2D( texture, vUV );\r\n\r\n  if ( pixel.a < 0.5 ) discard;\r\n\r\n  gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\r\n}\r\n"},function(e,t){e.exports="varying vec2 vUV;\r\n\r\nvoid main() {\r\n  vUV = 0.75 * uv;\r\n\r\n  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n\r\n  gl_Position = projectionMatrix * mvPosition;\r\n}\r\n"},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(383),s=n(a),l=o(234),u=n(l),c=o(237),d=n(c),h=o(238),p=n(h),f=o(242),m=n(f),v=o(243),y=n(v),g=o(2),w=n(g),b=o(251),x=n(b),E=o(373),M=n(E),C=w["default"].PropTypes,_=60,S=(r=i=function(e){function t(e,o){(0,d["default"])(this,t);var n=(0,m["default"])(this,(0,u["default"])(t).call(this,e,o));return n.shouldComponentUpdate=M["default"].shouldComponentUpdate,n.state={color:"0xaaaaaa"},n}return(0,y["default"])(t,e),(0,p["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.visible,o=e.position;return w["default"].createElement("mesh",{castShadow:!0,receiveShadow:!0,visible:t,position:o},w["default"].createElement("sphereGeometry",{radius:_,widthSegments:20,heightSegments:20}),w["default"].createElement("meshPhongMaterial",{color:(0,s["default"])(this.state.color,16)}))}}]),t}(w["default"].Component),i.propTypes={visible:C.bool.isRequired,position:C.instanceOf(x["default"].Vector3).isRequired},r);t["default"]=S},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(234),r=n(i),a=o(237),s=n(a),l=o(242),u=n(l),c=o(243),d=n(c),h=o(251),p=n(h),f=function(e){function t(e,o){function n(e){g.enabled!==!1&&(window.removeEventListener("keydown",n),M=E,E===w.NONE&&(e.keyCode!==g.keys[w.ROTATE]||g.noRotate?e.keyCode!==g.keys[w.ZOOM]||g.noZoom?e.keyCode!==g.keys[w.PAN]||g.noPan||(E=w.PAN):E=w.ZOOM:E=w.ROTATE))}function i(){g.enabled!==!1&&(E=M,window.addEventListener("keydown",n,!1))}function a(e){g.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),E!==w.ROTATE||g.noRotate?E!==w.ZOOM||g.noZoom?E!==w.PAN||g.noPan||F.copy(k(e.pageX,e.pageY)):B.copy(k(e.pageX,e.pageY)):(_.copy(S),S.copy(N(e.pageX,e.pageY))))}function l(e){g.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),E=w.NONE,document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l),g.dispatchEvent(L))}function c(e){g.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),E===w.NONE&&(E=e.button),E!==w.ROTATE||g.noRotate?E!==w.ZOOM||g.noZoom?E!==w.PAN||g.noPan||(z.copy(k(e.pageX,e.pageY)),F.copy(z)):(A.copy(k(e.pageX,e.pageY)),B.copy(A)):(S.copy(N(e.pageX,e.pageY)),_.copy(S)),document.addEventListener("mousemove",a,!1),document.addEventListener("mouseup",l,!1),g.dispatchEvent(q))}function d(e){if(g.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),A.y+=.01*t,g.dispatchEvent(q),g.dispatchEvent(L)}}function h(e){if(g.enabled!==!1){switch(e.touches.length){case 1:E=w.TOUCH_ROTATE,S.copy(N(e.touches[0].pageX,e.touches[0].pageY)),_.copy(S);break;case 2:E=w.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;I=T=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;z.copy(k(n,i)),F.copy(z);break;default:E=w.NONE}g.dispatchEvent(q)}}function f(e){if(g.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:_.copy(S),S.copy(N(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;I=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;F.copy(k(n,i));break;default:E=w.NONE}}function m(e){if(g.enabled!==!1){switch(e.touches.length){default:break;case 1:S.copy(N(e.touches[0].pageX,e.touches[0].pageY)),_.copy(S);break;case 2:T=I=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;F.copy(k(t,o)),z.copy(F)}E=w.NONE,g.dispatchEvent(L)}}function v(e){e.preventDefault()}(0,s["default"])(this,t);var y=(0,u["default"])(this,(0,r["default"])(t).call(this)),g=y,w={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};y.object=e,y.domElement=void 0!==o?o:document,y.enabled=!0,y.screen={left:0,top:0,width:0,height:0},y.rotateSpeed=1,y.zoomSpeed=1.2,y.panSpeed=.3,y.noRotate=!1,y.noZoom=!1,y.noPan=!1,y.staticMoving=!1,y.dynamicDampingFactor=.2,y.minDistance=0,y.maxDistance=1/0,y.keys=[65,83,68],y.target=new p["default"].Vector3;var b=1e-6,x=new p["default"].Vector3,E=w.NONE,M=w.NONE,C=new p["default"].Vector3,_=new p["default"].Vector2,S=new p["default"].Vector2,P=new p["default"].Vector3,R=0,A=new p["default"].Vector2,B=new p["default"].Vector2,T=0,I=0,z=new p["default"].Vector2,F=new p["default"].Vector2;y.target0=y.target.clone(),y.position0=y.object.position.clone(),y.up0=y.object.up.clone();var V={type:"change"},q={type:"start"},L={type:"end"};y.handleResize=function(){if(y.domElement===document)y.screen.left=0,y.screen.top=0,y.screen.width=window.innerWidth,y.screen.height=window.innerHeight;else{var e=y.domElement.getBoundingClientRect(),t=y.domElement.ownerDocument.documentElement;y.screen.left=e.left+window.pageXOffset-t.clientLeft,y.screen.top=e.top+window.pageYOffset-t.clientTop,y.screen.width=e.width,y.screen.height=e.height}},y.handleEvent=function(e){"function"==typeof y[e.type]&&y[e.type](e)};var k=function(){var e=new p["default"].Vector2;return function(t,o){return e.set((t-g.screen.left)/g.screen.width,(o-g.screen.top)/g.screen.height),e}}(),N=function(){var e=new p["default"].Vector2;return function(t,o){return e.set((t-.5*g.screen.width-g.screen.left)/(.5*g.screen.width),(g.screen.height+2*(g.screen.top-o))/g.screen.width),e}}();return y.rotateCamera=function(){var e=new p["default"].Vector3,t=new p["default"].Quaternion,o=new p["default"].Vector3,n=new p["default"].Vector3,i=new p["default"].Vector3,r=new p["default"].Vector3,a=void 0;return function(){r.set(S.x-_.x,S.y-_.y,0),a=r.length(),a?(C.copy(g.object.position).sub(g.target),o.copy(C).normalize(),n.copy(g.object.up).normalize(),i.crossVectors(n,o).normalize(),n.setLength(S.y-_.y),i.setLength(S.x-_.x),r.copy(n.add(i)),e.crossVectors(r,C).normalize(),a*=g.rotateSpeed,t.setFromAxisAngle(e,a),C.applyQuaternion(t),g.object.up.applyQuaternion(t),P.copy(e),R=a):!g.staticMoving&&R&&(R*=Math.sqrt(1-g.dynamicDampingFactor),C.copy(g.object.position).sub(g.target),t.setFromAxisAngle(P,R),C.applyQuaternion(t),g.object.up.applyQuaternion(t)),_.copy(S)}}(),y.zoomCamera=function(){var e=void 0;E===w.TOUCH_ZOOM_PAN?(e=T/I,T=I,C.multiplyScalar(e)):(e=1+(B.y-A.y)*g.zoomSpeed,1!==e&&e>0&&(C.multiplyScalar(e),g.staticMoving?A.copy(B):A.y+=(B.y-A.y)*y.dynamicDampingFactor))},y.panCamera=function(){var e=new p["default"].Vector2,t=new p["default"].Vector3,o=new p["default"].Vector3;return function(){e.copy(F).sub(z),e.lengthSq()&&(e.multiplyScalar(C.length()*g.panSpeed),o.copy(C).cross(g.object.up).setLength(e.x),o.add(t.copy(g.object.up).setLength(e.y)),g.object.position.add(o),g.target.add(o),g.staticMoving?z.copy(F):z.add(e.subVectors(F,z).multiplyScalar(g.dynamicDampingFactor)))}}(),y.checkDistances=function(){g.noZoom&&g.noPan||(C.lengthSq()>g.maxDistance*g.maxDistance&&(g.object.position.addVectors(g.target,C.setLength(g.maxDistance)),A.copy(B)),C.lengthSq()<g.minDistance*g.minDistance&&(g.object.position.addVectors(g.target,C.setLength(g.minDistance)),A.copy(B)))},y.update=function(){C.subVectors(g.object.position,g.target),g.noRotate||g.rotateCamera(),g.noZoom||g.zoomCamera(),g.noPan||g.panCamera(),g.object.position.addVectors(g.target,C),g.checkDistances(),g.object.lookAt(g.target),x.distanceToSquared(g.object.position)>b&&(g.dispatchEvent(V),x.copy(g.object.position))},y.reset=function(){E=w.NONE,M=w.NONE,g.target.copy(g.target0),g.object.position.copy(g.position0),g.object.up.copy(g.up0),C.subVectors(g.object.position,g.target),g.object.lookAt(g.target),g.dispatchEvent(V),x.copy(g.object.position)},y.dispose=function(){y.domElement.removeEventListener("contextmenu",v,!1),y.domElement.removeEventListener("mousedown",c,!1),y.domElement.removeEventListener("mousewheel",d,!1),y.domElement.removeEventListener("DOMMouseScroll",d,!1),y.domElement.removeEventListener("touchstart",h,!1),y.domElement.removeEventListener("touchend",m,!1),y.domElement.removeEventListener("touchmove",f,!1),document.removeEventListener("mousemove",a,!1),document.removeEventListener("mouseup",l,!1),window.removeEventListener("keydown",n,!1),window.removeEventListener("keyup",i,!1)},y.domElement.addEventListener("contextmenu",v,!1),y.domElement.addEventListener("mousedown",c,!1),y.domElement.addEventListener("mousewheel",d,!1),y.domElement.addEventListener("DOMMouseScroll",d,!1),y.domElement.addEventListener("touchstart",h,!1),y.domElement.addEventListener("touchend",m,!1),y.domElement.addEventListener("touchmove",f,!1),window.addEventListener("keydown",n,!1),window.addEventListener("keyup",i,!1),y.handleResize(),y.update(),y}return(0,d["default"])(t,e),t}(p["default"].EventDispatcher);t["default"]=f},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(257),r=n(i),a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=o(251),w=n(g),b=o(379),x=n(b),E=o(371),M=n(E),C=o(376),_=n(C),S=function(e){function t(e,o){(0,u["default"])(this,t);var n=(0,p["default"])(this,(0,s["default"])(t).call(this,e,o));n._onAnimate=function(){n._onAnimateInternal()},n.directionalLightPosition=new w["default"].Vector3(0,1,0),n.objectPositions=[new w["default"].Vector3(-400,0,200),new w["default"].Vector3(-200,0,200),new w["default"].Vector3(0,0,200),new w["default"].Vector3(200,0,200),new w["default"].Vector3(-400,0,0),new w["default"].Vector3(-200,0,0),new w["default"].Vector3(0,0,0),new w["default"].Vector3(200,0,0),new w["default"].Vector3(400,0,0),new w["default"].Vector3(-400,0,-200),new w["default"].Vector3(-200,0,-200),new w["default"].Vector3(0,0,-200),new w["default"].Vector3(200,0,-200),new w["default"].Vector3(400,0,-200)],n.lathePoints=[];for(var i=0;50>i;i++)n.lathePoints.push(new w["default"].Vector2(Math.sin(.2*i)*Math.sin(.1*i)*15+50,2*(i-5)));return n.arrowDir=new w["default"].Vector3(0,1,0),n.arrowOrigin=new w["default"].Vector3(0,0,0),n.scenePosition=new w["default"].Vector3(0,0,0),n.state=(0,r["default"])({},n.state,{timer:1e-4*Date.now()}),n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.stats=new x["default"],this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.refs.container.appendChild(this.stats.domElement)}},{key:"componentWillUnmount",value:function(){delete this.stats}},{key:"_onAnimateInternal",value:function(){var e=1e-4*Date.now();this.setState({timer:e}),this.stats.update()}},{key:"render",value:function(){var e=this.props,t=e.width,o=e.height,n=this.state.timer,i=new w["default"].Euler(5*n,2.5*n,0);return y["default"].createElement("div",{ref:"container"},y["default"].createElement(M["default"],{width:t,height:o,antialias:!0,pixelRatio:window.devicePixelRatio,mainCamera:"mainCamera",onAnimate:this._onAnimate},y["default"].createElement("resources",null,y["default"].createElement("texture",{resourceId:"texture",url:"textures/UV_Grid_Sm.jpg",wrapS:w["default"].RepeatWrapping,wrapT:w["default"].RepeatWrapping,anisotropy:16}),y["default"].createElement("meshLambertMaterial",{resourceId:"material",side:w["default"].DoubleSide},y["default"].createElement("textureResource",{resourceId:"texture"}))),y["default"].createElement("scene",null,y["default"].createElement("perspectiveCamera",{fov:45,aspect:t/o,near:1,far:2e3,lookAt:this.scenePosition,name:"mainCamera",position:new w["default"].Vector3(800*Math.cos(n),400,800*Math.sin(n))}),y["default"].createElement("ambientLight",{color:4210752}),y["default"].createElement("directionalLight",{color:16777215,position:this.directionalLightPosition}),y["default"].createElement("mesh",{position:this.objectPositions[0],rotation:i},y["default"].createElement("sphereGeometry",{radius:75,widthSegments:20,heightSegments:10}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("mesh",{position:this.objectPositions[1],rotation:i},y["default"].createElement("icosahedronGeometry",{radius:75,detail:1}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("mesh",{position:this.objectPositions[2],rotation:i},y["default"].createElement("octahedronGeometry",{radius:75,detail:2}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("mesh",{position:this.objectPositions[3],rotation:i},y["default"].createElement("tetrahedronGeometry",{radius:75,detail:0}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("mesh",{position:this.objectPositions[4],rotation:i},y["default"].createElement("planeBufferGeometry",{width:100,height:100,widthSegments:4,heightSegments:4}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("mesh",{position:this.objectPositions[5],rotation:i},y["default"].createElement("boxGeometry",{width:100,height:100,depth:100,widthSegments:4,heightSegments:4,depthSegments:4}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("mesh",{position:this.objectPositions[6],rotation:i},y["default"].createElement("circleGeometry",{radius:50,segments:20,thetaStart:0,thetaLength:2*Math.PI}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("mesh",{position:this.objectPositions[7],rotation:i},y["default"].createElement("ringGeometry",{innerRadius:10,outerRadius:50,thetaSegments:20,phiSegments:5,thetaStart:0,thetaLength:2*Math.PI}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("mesh",{position:this.objectPositions[8],rotation:i},y["default"].createElement("cylinderGeometry",{radiusTop:25,radiusBottom:75,height:100,radialSegments:40,heightSegments:5}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("mesh",{position:this.objectPositions[9],rotation:i},y["default"].createElement("latheGeometry",{points:this.lathePoints,segments:20}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("mesh",{position:this.objectPositions[10],rotation:i},y["default"].createElement("torusGeometry",{radius:50,tube:20,radialSegments:20,tubularSegments:20}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("mesh",{position:this.objectPositions[11],rotation:i},y["default"].createElement("torusKnotGeometry",{radius:50,tube:10,radialSegments:50,tubularSegments:20}),y["default"].createElement("materialResource",{resourceId:"material"})),y["default"].createElement("axisHelper",{position:this.objectPositions[12],size:50,rotation:i}),y["default"].createElement("arrowHelper",{dir:this.arrowDir,origin:this.arrowOrigin,length:50,position:this.objectPositions[13],rotation:i}))))}}]),t}(_["default"]);t["default"]=S},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a,s=o(257),l=n(s),u=o(234),c=n(u),d=o(237),h=n(d),p=o(238),f=n(p),m=o(242),v=n(m),y=o(243),g=n(y),w=o(2),b=n(w),x=o(368),E=n(x),M=o(251),C=n(M),_=o(376),S=n(_),P=o(371),R=n(P),A=o(397),B=n(A),T=o(398),I=n(T),z=o(394),F=n(z),V="perspectiveCamera",q="orthographicCamera",L="mainCamera",k=new C["default"].Euler(0,Math.PI,0),N=new C["default"].Euler(0,Math.PI,0),j=new C["default"].Vector3(0,0,150),D=(r=i=function(e){function t(e,o){(0,h["default"])(this,t);var n=(0,v["default"])(this,(0,c["default"])(t).call(this,e,o));a.call(n);var i=5e-4*Date.now();return n.state=(0,l["default"])({},n.state,{meshPosition:new C["default"].Vector3(Math.cos(i),Math.sin(i),Math.sin(i)).multiplyScalar(700),childPosition:new C["default"].Vector3(70*Math.cos(2*i),150,70*Math.sin(i)),activeCameraName:V,paused:!1,mainCameraPosition:new C["default"].Vector3(0,0,2500)}),n}return(0,g["default"])(t,e),(0,f["default"])(t,[{key:"componentDidMount",value:function(){var e=this;document.addEventListener("keydown",this._onKeyDown,!1);var t=new F["default"](this.refs.mainCamera,E["default"].findDOMNode(this.refs.react3));t.rotateSpeed=1,t.zoomSpeed=1.2,t.panSpeed=.8,t.noZoom=!1,t.noPan=!1,t.staticMoving=!0,t.dynamicDampingFactor=.3,t.addEventListener("change",function(){e.setState({mainCameraPosition:e.refs.mainCamera.position})}),this.controls=t}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this._onKeyDown,!1),this.controls.dispose(),delete this.controls}},{key:"render",value:function(){var e=this.props,t=e.width,o=e.height,n=this.state,i=n.meshPosition,r=n.childPosition,a=n.r,s=.5*t/o;return b["default"].createElement("div",null,b["default"].createElement(B["default"],{pause:this._pause,frame:this._frame}),b["default"].createElement(R["default"],{ref:"react3",width:t,height:o,antialias:!0,onAnimate:this._onAnimate},b["default"].createElement("viewport",{x:0,y:0,width:t/2,height:o,cameraName:this.state.activeCameraName}),b["default"].createElement("viewport",{x:t/2,y:0,width:t/2,height:o,cameraName:L}),b["default"].createElement("scene",null,b["default"].createElement("perspectiveCamera",{ref:"mainCamera",name:L,fov:50,aspect:s,near:1,far:1e4,position:this.state.mainCameraPosition}),b["default"].createElement("object3D",{lookAt:i},b["default"].createElement("perspectiveCamera",{name:V,fov:35+30*Math.sin(.5*a),aspect:s,near:150,far:i.length(),rotation:k}),b["default"].createElement("orthographicCamera",{name:q,left:.5*t/-2,right:.5*t/2,top:o/2,bottom:o/-2,near:150,far:i.length(),rotation:N}),b["default"].createElement("mesh",{position:j},b["default"].createElement("sphereGeometry",{radius:5,widthSegments:16,heightSegments:8}),b["default"].createElement("meshBasicMaterial",{color:255,wireframe:!0}))),b["default"].createElement("cameraHelper",{cameraName:this.state.activeCameraName}),b["default"].createElement("object3D",{position:i},b["default"].createElement("mesh",null,b["default"].createElement("sphereGeometry",{radius:100,widthSegments:16,heightSegments:8}),b["default"].createElement("meshBasicMaterial",{color:16777215,wireframe:!0})),b["default"].createElement("mesh",{position:r},b["default"].createElement("sphereGeometry",{radius:50,widthSegments:16,heightSegments:8}),b["default"].createElement("meshBasicMaterial",{color:65280,wireframe:!0}))),b["default"].createElement(I["default"],null))))}}]),t}(S["default"]),a=function(){var e=this;this._onKeyDown=function(t){switch(t.keyCode){default:break;case 79:e.setState({activeCameraName:q});break;case 80:e.setState({activeCameraName:V})}},this._onAnimate=function(){if(e.controls.update(),!e.state.paused){var t=5e-4*Date.now();e.setState({r:t,meshPosition:new C["default"].Vector3(Math.cos(t),Math.sin(t),Math.sin(t)).multiplyScalar(700),childPosition:new C["default"].Vector3(70*Math.cos(2*t),150,70*Math.sin(t))})}},this._pause=function(){e.setState({paused:!e.state.paused})},this._frame=function(){e.setState({paused:!1},function(){e._onAnimate(),e.setState({paused:!0})})}},r);t["default"]=D},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=y["default"].PropTypes,w=(r=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){return y["default"].createElement("div",{style:{position:"absolute",textAlign:"center",top:0,width:"100%",padding:5,color:"white",zIndex:100}},y["default"].createElement("a",{href:"http://threejs.org",style:{color:"#0080ff"}},"three.js")," - cameras",y["default"].createElement("br",null),y["default"].createElement("b",{style:{color:"lightgreen"}},"O")," orthographic  ",y["default"].createElement("b",{style:{color:"lightgreen"}},"P")," perspective ",y["default"].createElement("br",null),y["default"].createElement("button",{onClick:this.props.pause},"Pause"),y["default"].createElement("button",{onClick:this.props.frame},"Frame"))}}]),t}(y["default"].Component),i.propTypes={pause:g.func.isRequired,frame:g.func.isRequired},r);t["default"]=w},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(234),r=n(i),a=o(237),s=n(a),l=o(238),u=n(l),c=o(242),d=n(c),h=o(243),p=n(h),f=o(2),m=n(f),v=o(251),y=n(v),g=function(e){function t(e,o){(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,r["default"])(t).call(this,e,o));n.pointCloudVertices=[];for(var i=0;1e4>i;i++){var a=new y["default"].Vector3;a.x=y["default"].Math.randFloatSpread(2e3),a.y=y["default"].Math.randFloatSpread(2e3),a.z=y["default"].Math.randFloatSpread(2e3),n.pointCloudVertices.push(a)}return n}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return m["default"].createElement("points",null,m["default"].createElement("geometry",{vertices:this.pointCloudVertices}),m["default"].createElement("pointsMaterial",{color:8947848}))}}]),t}(m["default"].Component);t["default"]=g},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(257),r=n(i),a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=o(251),w=n(g),b=o(379),x=n(b),E=o(371),M=n(E),C=o(376),_=n(C),S=o(400),P=n(S),R=o(402),A=n(R),B=function(e){function t(e,o){(0,u["default"])(this,t);var n=(0,p["default"])(this,(0,s["default"])(t).call(this,e,o));return n._onDocumentMouseDown=function(e){e.preventDefault(),document.addEventListener("mousemove",n._onDocumentMouseMove,!1),document.addEventListener("mouseup",n._onDocumentMouseUp,!1),document.addEventListener("mouseout",n._onDocumentMouseOut,!1);var t=n.props.width,o=t/2;n.mouseXOnMouseDown=e.clientX-o,n.targetRotationOnMouseDown=n.targetRotation},n._onDocumentMouseMove=function(e){var t=n.props.width,o=t/2;n.mouseX=e.clientX-o,n.targetRotation=n.targetRotationOnMouseDown+.02*(n.mouseX-n.mouseXOnMouseDown)},n._onDocumentMouseUp=function(){document.removeEventListener("mousemove",n._onDocumentMouseMove,!1),document.removeEventListener("mouseup",n._onDocumentMouseUp,!1),document.removeEventListener("mouseout",n._onDocumentMouseOut,!1)},n._onDocumentMouseOut=function(){document.removeEventListener("mousemove",n._onDocumentMouseMove,!1),document.removeEventListener("mouseup",n._onDocumentMouseUp,!1),document.removeEventListener("mouseout",n._onDocumentMouseOut,!1)},n._onDocumentTouchStart=function(e){if(1===e.touches.length){e.preventDefault();var t=n.props.width,o=t/2;n.mouseXOnMouseDown=e.touches[0].pageX-o,n.targetRotationOnMouseDown=n.targetRotation}},n._onDocumentTouchMove=function(e){if(1===e.touches.length){e.preventDefault();var t=n.props.width,o=t/2;n.mouseX=e.touches[0].pageX-o,n.targetRotation=n.targetRotationOnMouseDown+.05*(n.mouseX-n.mouseXOnMouseDown)}},n._onAnimate=function(){n._onAnimateInternal()},n.cameraPosition=new w["default"].Vector3(0,150,500),n.groupPosition=new w["default"].Vector3(0,50,0),n.targetRotationOnMouseDown=0,n.mouseX=0,n.mouseXOnMouseDown=0,n.targetRotation=0,n.state=(0,r["default"])({},n.state,{groupRotation:new w["default"].Euler(0,0,0)}),n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.stats=new x["default"];var e=this.refs.container;this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",e.appendChild(this.stats.domElement),e.addEventListener("mousedown",this._onDocumentMouseDown,!1),e.addEventListener("touchstart",this._onDocumentTouchStart,!1),document.addEventListener("touchmove",this._onDocumentTouchMove,!1)}},{key:"componentWillUnmount",value:function(){var e=this.refs.container;e.removeEventListener("mousedown",this._onDocumentMouseDown,!1),e.removeEventListener("touchstart",this._onDocumentTouchStart,!1),document.removeEventListener("touchmove",this._onDocumentTouchMove,!1),document.removeEventListener("mousemove",this._onDocumentMouseMove,!1),document.removeEventListener("mouseup",this._onDocumentMouseUp,!1),document.removeEventListener("mouseout",this._onDocumentMouseOut,!1),delete this.stats}},{key:"_onAnimateInternal",value:function(){var e=this.state.groupRotation.y;Math.abs(e-this.targetRotation)>1e-4&&this.setState({groupRotation:new w["default"].Euler(0,e+.05*(this.targetRotation-e),0)}),this.stats.update()}},{key:"render",value:function(){var e=this.props,t=e.width,o=e.height,n=this.state.groupRotation;return y["default"].createElement("div",{ref:"container"},y["default"].createElement("div",{style:{color:"black",position:"absolute",top:"10px",width:"100%",textAlign:"center"}},"Simple procedurally generated 3D shapes",y["default"].createElement("br",null),"Drag to spin"),y["default"].createElement(M["default"],{width:t,height:o,antialias:!0,pixelRatio:window.devicePixelRatio,mainCamera:"mainCamera",clearColor:15790320,onAnimate:this._onAnimate},y["default"].createElement("scene",{ref:"scene"},y["default"].createElement("perspectiveCamera",{name:"mainCamera",ref:"camera",fov:50,aspect:t/o,near:1,far:1e3,position:this.cameraPosition},y["default"].createElement("pointLight",{color:16777215,intensity:.8})),y["default"].createElement(P["default"],null),y["default"].createElement("group",{position:this.groupPosition,rotation:n},y["default"].createElement(A["default"],null)))))}}]),t}(_["default"]);t["default"]=B},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(234),r=n(i),a=o(237),s=n(a),l=o(238),u=n(l),c=o(242),d=n(c),h=o(243),p=n(h),f=o(2),m=n(f),v=o(251),y=n(v),g=o(401),w=n(g),b=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(0,r["default"])(t).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){this.textureRepeat=new y["default"].Vector2(.008,.008);var e=0,t=0,o=80,n=120,i=40,r=[];r.push(new y["default"].Vector2(610,320)),r.push(new y["default"].Vector2(450,300)),r.push(new y["default"].Vector2(392,392)),r.push(new y["default"].Vector2(266,438)),r.push(new y["default"].Vector2(190,570)),r.push(new y["default"].Vector2(190,600)),r.push(new y["default"].Vector2(160,620)),r.push(new y["default"].Vector2(160,650)),r.push(new y["default"].Vector2(180,640)),r.push(new y["default"].Vector2(165,680)),r.push(new y["default"].Vector2(150,670)),r.push(new y["default"].Vector2(90,737)),r.push(new y["default"].Vector2(80,795)),r.push(new y["default"].Vector2(50,835)),r.push(new y["default"].Vector2(64,870)),r.push(new y["default"].Vector2(60,945)),r.push(new y["default"].Vector2(300,945)),r.push(new y["default"].Vector2(300,743)),r.push(new y["default"].Vector2(600,473)),r.push(new y["default"].Vector2(626,425)),r.push(new y["default"].Vector2(600,370)),r.push(new y["default"].Vector2(610,320));for(var a=0;a<r.length;a++)r[a].multiplyScalar(.25);return this.californiaPts=r,m["default"].createElement("resources",null,m["default"].createElement("texture",{resourceId:"texture",url:"textures/UV_Grid_Sm.jpg",wrapS:y["default"].RepeatWrapping,wrapT:y["default"].RepeatWrapping,repeat:this.textureRepeat}),m["default"].createElement("meshBasicMaterial",{resourceId:"hoverMaterial",color:16711680,side:y["default"].DoubleSide}),m["default"].createElement("meshPhongMaterial",{resourceId:"phongMaterial",side:y["default"].DoubleSide},m["default"].createElement("textureResource",{resourceId:"texture"})),m["default"].createElement("shape",{resourceId:"california",points:this.californiaPts}),m["default"].createElement("shape",{resourceId:"triangle"},m["default"].createElement("moveTo",{x:80,y:20}),m["default"].createElement("lineTo",{x:40,y:80}),m["default"].createElement("lineTo",{x:120,y:80}),m["default"].createElement("lineTo",{x:80,y:20})),m["default"].createElement("shape",{resourceId:"heart"},m["default"].createElement("moveTo",{x:e+25,y:t+25}),m["default"].createElement("bezierCurveTo",{cp1X:e+25,cp1Y:t+25,cp2X:e+20,cp2Y:t,aX:e,aY:t}),m["default"].createElement("bezierCurveTo",{cp1X:e-30,cp1Y:t,cp2X:e-30,cp2Y:t+35,aX:e-30,aY:t+35}),m["default"].createElement("bezierCurveTo",{cp1X:e-30,cp1Y:t+55,cp2X:e-10,cp2Y:t+77,aX:e+25,aY:t+95}),m["default"].createElement("bezierCurveTo",{cp1X:e+60,cp1Y:t+77,cp2X:e+80,cp2Y:t+55,aX:e+80,aY:t+35}),m["default"].createElement("bezierCurveTo",{cp1X:e+80,cp1Y:t+35,cp2X:e+80,cp2Y:t,aX:e+50,aY:t}),m["default"].createElement("bezierCurveTo",{cp1X:e+35,cp1Y:t,cp2X:e+25,cp2Y:t+25,aX:e+25,aY:t+25})),m["default"].createElement(w["default"],{resourceId:"square",width:o,length:o}),m["default"].createElement(w["default"],{resourceId:"rect",width:i,length:n}),function(e,t,o,n,i){return m["default"].createElement("shape",{resourceId:"roundedRect"},m["default"].createElement("moveTo",{x:e,y:t+i}),m["default"].createElement("lineTo",{x:e,y:t+n-i}),m["default"].createElement("quadraticCurveTo",{cpX:e,cpY:t+n,x:e+i,y:t+n}),m["default"].createElement("lineTo",{x:e+o-i,y:t+n}),m["default"].createElement("quadraticCurveTo",{cpX:e+o,cpY:t+n,x:e+o,y:t+n-i}),m["default"].createElement("lineTo",{x:e+o,y:t+i}),m["default"].createElement("quadraticCurveTo",{cpX:e+o,cpY:t,x:e+o-i,y:t}),m["default"].createElement("lineTo",{x:e+i,y:t}),m["default"].createElement("quadraticCurveTo",{cpX:e,cpY:t,x:e,y:t+i}))}(0,0,50,50,20),m["default"].createElement("shape",{resourceId:"track"},m["default"].createElement("moveTo",{x:40,y:40}),m["default"].createElement("lineTo",{x:40,y:160}),m["default"].createElement("absArc",{x:60,y:160,radius:20,startAngle:Math.PI,endAngle:0,clockwise:!0}),m["default"].createElement("lineTo",{x:80,y:40}),m["default"].createElement("absArc",{x:60,y:40,radius:20,startAngle:2*Math.PI,endAngle:Math.PI,clockwise:!0})),function(){var e=40;return m["default"].createElement("shape",{resourceId:"circle"},m["default"].createElement("moveTo",{x:0,y:e}),m["default"].createElement("quadraticCurveTo",{cpX:e,cpY:e,x:e,y:0}),m["default"].createElement("quadraticCurveTo",{cpX:e,cpY:-e,x:0,y:-e}),m["default"].createElement("quadraticCurveTo",{cpX:-e,cpY:-e,x:-e,y:0}),m["default"].createElement("quadraticCurveTo",{cpX:-e,cpY:e,x:0,y:e}))}(),m["default"].createElement("shape",{resourceId:"arc"},m["default"].createElement("moveTo",{x:50,y:10}),m["default"].createElement("absArc",{x:10,y:10,radius:40,startAngle:0,endAngle:2*Math.PI,clockwise:!1}),m["default"].createElement("hole",null,m["default"].createElement("moveTo",{x:20,y:10}),m["default"].createElement("absArc",{
x:10,y:10,radius:10,startAngle:0,endAngle:2*Math.PI,clockwise:!0}))),m["default"].createElement("shape",{resourceId:"fish"},m["default"].createElement("moveTo",{x:e,y:t}),m["default"].createElement("quadraticCurveTo",{cpX:e+50,cpY:t-80,x:e+90,y:t-10}),m["default"].createElement("quadraticCurveTo",{cpX:e+100,cpY:t-10,x:e+115,y:t-40}),m["default"].createElement("quadraticCurveTo",{cpX:e+115,cpY:t,x:e+115,y:t+40}),m["default"].createElement("quadraticCurveTo",{cpX:e+100,cpY:t+10,x:e+90,y:t+10}),m["default"].createElement("quadraticCurveTo",{cpX:e+50,cpY:t+80,x:e,y:t})),m["default"].createElement("shape",{resourceId:"smiley"},m["default"].createElement("moveTo",{x:80,y:40}),m["default"].createElement("absArc",{x:40,y:40,radius:40,startAngle:0,endAngle:2*Math.PI,clockwise:!1}),m["default"].createElement("hole",{key:"eye1"},m["default"].createElement("moveTo",{x:35,y:20}),m["default"].createElement("absEllipse",{x:25,y:20,xRadius:10,yRadius:10,startAngle:0,endAngle:2*Math.PI,clockwise:!0})),m["default"].createElement("hole",{key:"eye2"},m["default"].createElement("moveTo",{x:65,y:20}),m["default"].createElement("absArc",{x:55,y:20,radius:10,startAngle:0,endAngle:2*Math.PI,clockwise:!0})),m["default"].createElement("hole",{key:"mouth"},m["default"].createElement("moveTo",{x:20,y:40}),m["default"].createElement("quadraticCurveTo",{cpX:40,cpY:60,x:60,y:40}),m["default"].createElement("bezierCurveTo",{cp1X:70,cp1Y:45,cp2X:70,cp2Y:50,aX:60,aY:60}),m["default"].createElement("quadraticCurveTo",{cpX:40,cpY:80,x:20,y:60}),m["default"].createElement("quadraticCurveTo",{cpX:5,cpY:50,x:20,y:40}))),function(){var e=[];return e.push(new y["default"].Vector2(70,20)),e.push(new y["default"].Vector2(80,90)),e.push(new y["default"].Vector2(-30,70)),e.push(new y["default"].Vector2(0,0)),m["default"].createElement("shape",{resourceId:"spline"},m["default"].createElement("moveTo",{x:0,y:0}),m["default"].createElement("splineThru",{points:e}))}())}}]),t}(m["default"].Component);t["default"]=b},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=e.width,o=e.length,n=e.resourceId;return a["default"].createElement("shape",{resourceId:n},a["default"].createElement("moveTo",{x:0,y:0}),a["default"].createElement("lineTo",{x:0,y:t}),a["default"].createElement("lineTo",{x:o,y:t}),a["default"].createElement("lineTo",{x:o,y:0}),a["default"].createElement("lineTo",{x:0,y:0}))}Object.defineProperty(t,"__esModule",{value:!0});var r=o(2),a=n(r),s=o(107),l=n(s);i.propTypes={width:l["default"].number.isRequired,length:l["default"].number.isRequired,resourceId:l["default"].string.isRequired},t["default"]=i},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(234),r=n(i),a=o(237),s=n(a),l=o(238),u=n(l),c=o(242),d=n(c),h=o(243),p=n(h),f=o(2),m=n(f),v=o(403),y=n(v),g=function(e){function t(){return(0,s["default"])(this,t),(0,d["default"])(this,(0,r["default"])(t).apply(this,arguments))}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return m["default"].createElement("group",null,m["default"].createElement(y["default"],{resourceId:"california",x:-300,y:-100,z:0,color:15761408,rx:0,ry:0,rz:0,s:1}),m["default"].createElement(y["default"],{resourceId:"triangle",color:8421616,x:-180,y:0,z:0,rx:0,ry:0,rz:0,s:1}),m["default"].createElement(y["default"],{resourceId:"roundedRect",x:-150,y:150,z:0,color:32768,rx:0,ry:0,rz:0,s:1}),m["default"].createElement(y["default"],{resourceId:"track",x:200,y:-100,z:0,color:32896,rx:0,ry:0,rz:0,s:1}),m["default"].createElement(y["default"],{resourceId:"square",color:16624,x:150,y:100,z:0,rx:0,ry:0,rz:0,s:1}),m["default"].createElement(y["default"],{resourceId:"heart",color:15728640,x:60,y:100,z:0,rx:0,ry:0,rz:Math.PI,s:1}),m["default"].createElement(y["default"],{resourceId:"circle",color:61440,x:120,y:250,z:0,rx:0,ry:0,rz:0,s:1}),m["default"].createElement(y["default"],{resourceId:"fish",color:4210752,x:-60,y:200,z:0,rx:0,ry:0,rz:0,s:1}),m["default"].createElement(y["default"],{resourceId:"smiley",x:-200,y:250,z:0,color:15728880,rx:0,ry:0,rz:Math.PI,s:1}),m["default"].createElement(y["default"],{resourceId:"arc",color:8404992,x:150,y:0,z:0,rx:0,ry:0,rz:0,s:1}),m["default"].createElement(y["default"],{resourceId:"spline",color:8421504,x:-50,y:-100,z:0,rx:0,ry:0,rz:0,s:1}))}}]),t}(m["default"].Component);t["default"]=g},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=o(251),w=n(g),b=o(107),x=n(b),E=o(373),M=n(E),C={amount:8,bevelEnabled:!0,bevelSegments:2,steps:2,bevelSize:1,bevelThickness:1},_=(r=i=function(e){function t(){var e,o,n,i;(0,u["default"])(this,t);for(var r=arguments.length,a=Array(r),l=0;r>l;l++)a[l]=arguments[l];return o=n=(0,p["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(a))),n.shouldComponentUpdate=M["default"].shouldComponentUpdate,i=o,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.rx,o=e.ry,n=e.rz,i=e.s,r=e.resourceId,a=e.color,s=e.x,l=e.y,u=e.z,c=new w["default"].Euler(t,o,n),d=new w["default"].Vector3(i,i,i);return y["default"].createElement("group",null,y["default"].createElement("mesh",{position:new w["default"].Vector3(s,l,u-175),rotation:c,scale:d},y["default"].createElement("shapeGeometryResource",{resourceId:r,type:"shape"}),y["default"].createElement("materialResource",{resourceId:"phongMaterial"})),y["default"].createElement("mesh",{position:new w["default"].Vector3(s,l,u-125),rotation:c,scale:d},y["default"].createElement("shapeGeometryResource",{resourceId:r,type:"shape"}),y["default"].createElement("meshPhongMaterial",{color:a,side:w["default"].DoubleSide})),y["default"].createElement("mesh",{position:new w["default"].Vector3(s,l,u-75),rotation:c,scale:d},y["default"].createElement("extrudeGeometry",{settings:C},y["default"].createElement("shapeResource",{resourceId:r})),y["default"].createElement("meshPhongMaterial",{color:a})),y["default"].createElement("line",{position:new w["default"].Vector3(s,l,u-25),rotation:c,scale:d},y["default"].createElement("shapeGeometryResource",{resourceId:r,type:"points"}),y["default"].createElement("lineBasicMaterial",{color:a})),y["default"].createElement("points",{position:new w["default"].Vector3(s,l,u+25),rotation:c,scale:d},y["default"].createElement("shapeGeometryResource",{resourceId:r,type:"points"}),y["default"].createElement("pointsMaterial",{color:a,size:4})),y["default"].createElement("line",{position:new w["default"].Vector3(s,l,u+75),rotation:c,scale:d},y["default"].createElement("shapeGeometryResource",{resourceId:r,type:"spacedPoints",divisions:50}),y["default"].createElement("lineBasicMaterial",{color:a,linewidth:3})),y["default"].createElement("points",{position:new w["default"].Vector3(s,l,u+125),rotation:c,scale:d},y["default"].createElement("shapeGeometryResource",{resourceId:r,type:"spacedPoints",divisions:50}),y["default"].createElement("pointsMaterial",{color:a,size:4})))}}]),t}(y["default"].Component),i.propTypes={resourceId:x["default"].string.isRequired,color:x["default"].any.isRequired,x:x["default"].number.isRequired,y:x["default"].number.isRequired,z:x["default"].number.isRequired,rx:x["default"].number.isRequired,ry:x["default"].number.isRequired,rz:x["default"].number.isRequired,s:x["default"].number.isRequired},r);t["default"]=_},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(234),r=n(i),a=o(237),s=n(a),l=o(238),u=n(l),c=o(242),d=n(c),h=o(243),p=n(h),f=o(2),m=n(f),v=o(373),y=n(v),g=o(251),w=n(g),b=o(379),x=n(b),E=o(371),M=n(E),C=o(376),_=n(C),S=o(394),P=n(S),R=o(405),A=n(R),B=o(410),T=n(B),I=function(e){function t(e,o){(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,r["default"])(t).call(this,e,o));return n.shouldComponentUpdate=y["default"].shouldComponentUpdate,n._onAnimate=function(){n._onAnimateInternal()},n._onCubesMounted=function(e){n.cubes=e},n._onHoverStart=function(){n.setState({hovering:!0})},n._onHoverEnd=function(){n.setState({hovering:!1})},n._onDragStart=function(){n.setState({dragging:!0})},n._onDragEnd=function(){n.setState({dragging:!1})},n._onTrackballChange=function(){n.setState({cameraPosition:n.refs.camera.position.clone(),cameraRotation:n.refs.camera.rotation.clone()})},n.state={cameraPosition:new w["default"].Vector3(0,0,1e3),cameraRotation:new w["default"].Euler,mouseInput:null,hovering:!1,dragging:!1},n._cursor={hovering:!1,dragging:!1},n.lightPosition=new w["default"].Vector3(0,500,2e3),n}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.stats=new x["default"],this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px";var e=this.refs,t=e.container,o=e.camera;t.appendChild(this.stats.domElement);var n=new P["default"](o);n.rotateSpeed=1,n.zoomSpeed=1.2,n.panSpeed=.8,n.noZoom=!1,n.noPan=!1,n.staticMoving=!0,n.dynamicDampingFactor=.3,this.controls=n,this.controls.addEventListener("change",this._onTrackballChange)}},{key:"componentDidUpdate",value:function(e){var t=this.refs.mouseInput,o=this.props,n=o.width,i=o.height;n===e.width&&i===e.height||t.containerResized()}},{key:"componentWillUnmount",value:function(){this.controls.removeEventListener("change",this._onTrackballChange),this.controls.dispose(),delete this.controls,delete this.stats}},{key:"_onAnimateInternal",value:function(){var e=this.refs,t=e.mouseInput,o=e.camera;if(!t.isReady()){var n=this.refs,i=n.scene,r=n.container;t.ready(i,r,o),t.restrictIntersections(this.cubes),t.setActive(!1)}this.state.mouseInput!==t&&this.setState({mouseInput:t}),this.state.camera!==o&&this.setState({camera:o}),this.stats.update(),this.controls.update()}},{key:"render",value:function(){var e=this.props,t=e.width,o=e.height,n=this.state,i=n.cameraPosition,r=n.cameraRotation,a=n.mouseInput,s=n.camera,l=n.hovering,u=n.dragging,c={};return u?c.cursor="move":l&&(c.cursor="pointer"),this._cursor.hovering=l,this._cursor.dragging=u,m["default"].createElement("div",{ref:"container",style:c},m["default"].createElement(M["default"],{width:t,height:o,antialias:!0,pixelRatio:window.devicePixelRatio,mainCamera:"mainCamera",onAnimate:this._onAnimate,sortObjects:!1,shadowMapEnabled:!0,shadowMapType:w["default"].PCFShadowMap,clearColor:15790320},m["default"].createElement("module",{ref:"mouseInput",descriptor:A["default"]}),m["default"].createElement("resources",null,m["default"].createElement("boxGeometry",{resourceId:"boxGeometry",width:40,height:40,depth:40}),m["default"].createElement("meshBasicMaterial",{resourceId:"highlightMaterial",color:16776960,wireframe:!0})),m["default"].createElement("scene",{ref:"scene"},m["default"].createElement("perspectiveCamera",{fov:70,aspect:t/o,near:1,far:1e4,name:"mainCamera",ref:"camera",position:i,rotation:r}),m["default"].createElement("ambientLight",{color:5263440}),m["default"].createElement("spotLight",{color:16777215,intensity:1.5,position:this.lightPosition,castShadow:!0,shadowCameraNear:200,shadowCameraFar:1e4,shadowCameraFov:50,shadowBias:-22e-5,shadowMapWidth:2048,shadowMapHeight:2048}),m["default"].createElement(T["default"],{mouseInput:a,camera:s,onCubesMounted:this._onCubesMounted,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,onDragStart:this._onDragStart,onDragEnd:this._onDragEnd,cursor:this._cursor}))))}}]),t}(_["default"]);t["default"]=I},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(257),r=n(i),a=o(231),s=n(a),l=o(406),u=n(l),c=o(234),d=n(c),h=o(237),p=n(h),f=o(238),m=n(f),v=o(242),y=n(v),g=o(267),w=n(g),b=o(243),x=n(b),E=o(371),M=n(E),C=o(251),_=n(C),S=o(54),P=n(S),R=o(86),A=n(R),B=o(259),T=n(B),I=o(107),z=n(I),F=new _["default"].Vector2,V={mousedown:"onMouseDown",mouseup:"onMouseUp"},q=["onMouseEnter","onMouseLeave","onMouseDown","onMouseUp","onClick"],L={ignorePointerEvents:!1},k=function(e){function t(){(0,p["default"])(this,t);var e=(0,y["default"])(this,(0,d["default"])(t).call(this));return e._onMouseDown=function(t,o){P["default"].batchedUpdates(function(){var n=e._intersectAndDispatch(t,o),i=n.event,r=n.intersections;i.isDefaultPrevented()||i.isPropagationStopped()?e._intersectionsForClick=null:e._intersectionsForClick=r})},e._onMouseUp=function(t,o){P["default"].batchedUpdates(function(){var n=e._intersectAndDispatch(t,o),i=n.event,r=n.intersections;if(!i.isDefaultPrevented()&&!i.isPropagationStopped()){if(null===e._intersectionsForClick)return;for(var a=e._intersectionsForClick.reduce(function(e,t){return e[t.object.uuid]=t,e},{}),s=0;s<r.length;++s){if(i.isDefaultPrevented()||i.isPropagationStopped())return;var l=r[s],u=l.object,c=u.uuid;a[c]&&M["default"].eventDispatcher.dispatchEvent(u,"onClick",e._createSyntheticMouseEvent("click",i),l)}}}),e._intersectionsForClick=null},e._isReady=!1,e._active=!0,e._restrictIntersections=!1,e._objectsToIntersect=null,e._restrictedIntersectionRecursive=!1,e._patchedDescriptors=[],e}return(0,x["default"])(t,e),(0,m["default"])(t,[{key:"setup",value:function(e){var o=this;(0,w["default"])((0,d["default"])(t.prototype),"setup",this).call(this,e);var n=e.threeElementDescriptors.object3D.constructor;(0,u["default"])(e.threeElementDescriptors).forEach(function(e){e instanceof n&&(q.forEach(function(t){e.hasEvent(t)}),(0,s["default"])(L).forEach(function(t){e.hasProp(t,{type:z["default"].bool,update:function(e,o,n){n?e.userData[t]=o:e.userData[t]=L[t]},"default":L[t]})}),o._patchedDescriptors.push(e))})}},{key:"isReady",value:function(){return this._isReady}},{key:"setActive",value:function(e){this._active=e}},{key:"restrictIntersections",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];this._restrictIntersections=!0,this._objectsToIntersect=e,this._restrictedIntersectionRecursive=t}},{key:"ready",value:function(e,t,o){var n=this;this._isReady=!0,this._scene=e,this._container=t,this._camera=o,this._raycaster=new _["default"].Raycaster,this._mouse=new _["default"].Vector2,this._onMouseMove=function(e){n._mouse.set(e.clientX,e.clientY),n._active||n._updateEnterLeave()},this._containerRect=this._container.getBoundingClientRect(),this._hoverObjectMap={},document.addEventListener("mousemove",this._onMouseMove,!1),this._intersectionsForClick=null,this._caughtListenersCleanupFunctions=[],(0,s["default"])(V).forEach(function(e){var o=void 0,i=V[e];switch(e){case"mousedown":o=n._onMouseDown.bind(n,i);break;case"mouseup":o=n._onMouseUp.bind(n,i)}o&&(t.addEventListener(e,o,!0),n._caughtListenersCleanupFunctions.push(function(){t.removeEventListener(e,o,!0)}))})}},{key:"_createSyntheticMouseEvent",value:function(e,t){return A["default"].getPooled(null,null,new MouseEvent(e,t),t.target)}},{key:"_intersectAndDispatch",value:function(e,t){var o=A["default"].getPooled(null,null,t,t.target),n=this._getIntersections(F.set(o.clientX,o.clientY));return P["default"].batchedUpdates(function(){for(var t=0;t<n.length;++t){var i=n[t];if(o.isDefaultPrevented()||o.isPropagationStopped())return;var r=i.object;M["default"].eventDispatcher.dispatchEvent(r,e,o,i)}}),{event:o,intersections:n}}},{key:"_getIntersections",value:function(e){var t=this._getRelativeMouseCoords(e);return this._raycaster.setFromCamera(t,this._camera),this._restrictIntersections?this._raycaster.intersectObjects(this._objectsToIntersect,this._restrictedIntersectionRecursive):this._raycaster.intersectObject(this._scene,!0)}},{key:"getCameraRay",value:function(e){var t=this._getRelativeMouseCoords(e),o=this._raycaster.ray.clone();this._raycaster.setFromCamera(t,this._camera);var n=this._raycaster.ray.clone();return this._raycaster.ray.copy(o),n}},{key:"intersectObject",value:function(e,t){var o=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],n=this._getRelativeMouseCoords(e),i=this._raycaster.ray.clone();this._raycaster.setFromCamera(n,this._camera);var r=this._raycaster.intersectObject(t,o);return this._raycaster.ray.copy(i),r}},{key:"containerResized",value:function(){this._containerRect=this._container.getBoundingClientRect()}},{key:"update",value:function(){this._isReady&&this._active&&this._updateEnterLeave()}},{key:"_updateEnterLeave",value:function(){for(var e=this._getIntersections(this._mouse),t=(0,r["default"])({},this._hoverObjectMap),o=this._createSyntheticMouseEvent("mouseEnter",{target:this._container,clientX:this._mouse.x,clientY:this._mouse.y}),n=0;n<e.length;++n){var i=e[n],a=i.object;if(!a.userData||!a.userData.ignorePointerEvents){var l=a.uuid;this._hoverObjectMap[l]?(delete t[l],this._hoverObjectMap[l].intersection=i):(this._hoverObjectMap[l]={object:a,intersection:i},o.isDefaultPrevented()||o.isPropagationStopped()||M["default"].eventDispatcher.dispatchEvent(a,"onMouseEnter",o,i,n));break}}for(var u=this._createSyntheticMouseEvent("mouseLeave",{target:this._container,clientX:this._mouse.x,clientY:this._mouse.y}),c=(0,s["default"])(t),d=0;d<c.length;++d){var h=c[d];u.isDefaultPrevented()||u.isPropagationStopped()||M["default"].eventDispatcher.dispatchEvent(this._hoverObjectMap[h].object,"onMouseLeave",u),delete this._hoverObjectMap[h]}}},{key:"_getRelativeMouseCoords",value:function(e){var t=this._containerRect,o=e.clone().sub(F.set(t.left,t.top)).divide(F.set(t.width,t.height));return o.x=2*o.x-1,o.y=2*-o.y+1,o}},{key:"dispose",value:function(){document.removeEventListener("mousemove",this._onMouseMove,!1),this._caughtListenersCleanupFunctions.forEach(function(e){return e()}),delete this._caughtListenersCleanupFunctions,delete this._onMouseMove,this._patchedDescriptors.forEach(function(e){var t=(0,s["default"])(L).concat(q);t.forEach(function(t){e.removeProp(t)})})}}]),t}(T["default"]);t["default"]=k},function(e,t,o){e.exports={"default":o(407),__esModule:!0}},function(e,t,o){o(408),e.exports=o(172).Object.values},function(e,t,o){var n=o(171),i=o(409)(!1);n(n.S,"Object",{values:function(e){return i(e)}})},function(e,t,o){var n=o(191),i=o(193),r=o(219).f;e.exports=function(e){return function(t){for(var o,a=i(t),s=n(a),l=s.length,u=0,c=[];l>u;)r.call(a,o=s[u++])&&c.push(e?[o,a[o]]:a[o]);return c}}},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=o(411),w=n(g),b=o(251),x=n(b),E=o(373),M=n(E),C=o(405),_=n(C),S=y["default"].PropTypes,P=(r=i=function(e){function t(e,o){(0,u["default"])(this,t);var n=(0,p["default"])(this,(0,s["default"])(t).call(this,e,o));n.shouldComponentUpdate=M["default"].shouldComponentUpdate,n._onCubeCreate=function(e,t){n.cubes[e]=t},n._onCubeMouseEnter=function(){if(0===n._hoveredCubes){var e=n.props.onHoverStart;e()}n._hoveredCubes++},n._onCubeMouseLeave=function(){if(n._hoveredCubes--,0===n._hoveredCubes){var e=n.props.onHoverEnd;e()}},n._onCubeDragStart=function(){if(0===n._draggingCubes){var e=n.props.onDragStart;e()}n._draggingCubes++},n._onCubeDragEnd=function(){if(n._draggingCubes--,0===n._draggingCubes){var e=n.props.onDragEnd;e()}};var i=[];i.length=200;for(var r=0;200>r;++r)i[r]=new x["default"].Vector3(1e3*Math.random()-500,600*Math.random()-300,800*Math.random()-400);var a=[];return a.length=i.length,n.cubes=a,n.cubePositions=i,n._hoveredCubes=0,n._draggingCubes=0,n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){var e=this.props.onCubesMounted;e(this.cubes)}},{key:"render",value:function(){var e=this,t=this.props,o=t.mouseInput,n=t.camera,i=t.cursor;return y["default"].createElement("group",null,this.cubePositions.map(function(t,r){var a=e._onCubeCreate.bind(e,r);return y["default"].createElement(w["default"],{key:r,mouseInput:o,camera:n,initialPosition:t,onCreate:a,onMouseEnter:e._onCubeMouseEnter,onMouseLeave:e._onCubeMouseLeave,onDragStart:e._onCubeDragStart,onDragEnd:e._onCubeDragEnd,cursor:i})}))}}]),t}(y["default"].Component),i.propTypes={mouseInput:S.instanceOf(_["default"]),camera:S.instanceOf(x["default"].PerspectiveCamera),onCubesMounted:S.func.isRequired,onHoverStart:S.func.isRequired,onHoverEnd:S.func.isRequired,onDragStart:S.func.isRequired,onDragEnd:S.func.isRequired,cursor:S.any},r);t["default"]=P},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=o(251),w=n(g),b=o(373),x=n(b),E=o(405),M=n(E),C=y["default"].PropTypes,_=new w["default"].Plane,S=new w["default"].Vector3(0,0,-1),P=(r=i=function(e){function t(e,o){(0,u["default"])(this,t);var n=(0,p["default"])(this,(0,s["default"])(t).call(this,e,o));n.shouldComponentUpdate=x["default"].shouldComponentUpdate,n._onMouseEnter=function(){n.setState({hovered:!0});var e=n.props.onMouseEnter;e()},n._onMouseDown=function(e,t){e.preventDefault(),e.stopPropagation();var o=n.state.position,i=n.props,r=i.onDragStart,a=i.camera;_.setFromNormalAndCoplanarPoint(S.clone().applyQuaternion(a.quaternion),t.point),n._offset=t.point.clone().sub(o),document.addEventListener("mouseup",n._onDocumentMouseUp),document.addEventListener("mousemove",n._onDocumentMouseMove),n.setState({pressed:!0}),r()},n._onDocumentMouseMove=function(e){e.preventDefault();var t=n.props.mouseInput,o=t.getCameraRay(new w["default"].Vector2(e.clientX,e.clientY)),i=_.intersectLine(new w["default"].Line3(o.origin,o.origin.clone().add(o.direction.clone().multiplyScalar(1e4))));i&&n.setState({position:i.sub(n._offset)})},n._onDocumentMouseUp=function(e){e.preventDefault(),document.removeEventListener("mouseup",n._onDocumentMouseUp),document.removeEventListener("mousemove",n._onDocumentMouseMove);var t=n.props.onDragEnd;t(),n.setState({pressed:!1})},n._onMouseLeave=function(){n.state.hovered&&n.setState({hovered:!1});var e=n.props.onMouseLeave;e()},n._ref=function(e){var t=n.props.onCreate;t(e)},n.rotation=new w["default"].Euler(2*Math.random()*Math.PI,2*Math.random()*Math.PI,2*Math.random()*Math.PI),n.scale=new w["default"].Vector3(2*Math.random()+1,2*Math.random()+1,2*Math.random()+1),n.color=new w["default"].Color(16777215*Math.random());var i=n.color.getHSL();i.s=Math.min(1,1.1*i.s),i.l=Math.min(1,1.1*i.l);var r=i.h,a=i.s,l=i.l;n.hoverColor=(new w["default"].Color).setHSL(r,a,l),n.pressedColor=16711680;var c=e.initialPosition;return n.state={hovered:!1,pressed:!1,position:c},n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillUnmount",value:function(){document.removeEventListener("mouseup",this._onDocumentMouseUp)}},{key:"render",value:function(){var e=this.rotation,t=this.scale,o=this.props.cursor.dragging,n=this.state,i=n.hovered,r=n.pressed,a=n.position,s=void 0,l=i&&!o;return s=r?this.pressedColor:l?this.hoverColor:this.color,y["default"].createElement("group",{position:a,rotation:e,scale:t},y["default"].createElement("mesh",{castShadow:!0,receiveShadow:!0,onMouseEnter:this._onMouseEnter,onMouseDown:this._onMouseDown,onMouseLeave:this._onMouseLeave,ref:this._ref},y["default"].createElement("geometryResource",{resourceId:"boxGeometry"}),y["default"].createElement("meshLambertMaterial",{color:s})),l?y["default"].createElement("mesh",{ignorePointerEvents:!0},y["default"].createElement("geometryResource",{resourceId:"boxGeometry"}),y["default"].createElement("materialResource",{resourceId:"highlightMaterial"})):null)}}]),t}(y["default"].Component),i.propTypes={initialPosition:C.instanceOf(w["default"].Vector3).isRequired,mouseInput:C.instanceOf(M["default"]),camera:C.instanceOf(w["default"].PerspectiveCamera),onCreate:C.func.isRequired,onMouseEnter:C.func.isRequired,onMouseLeave:C.func.isRequired,onDragStart:C.func.isRequired,onDragEnd:C.func.isRequired,cursor:C.any},r);t["default"]=P},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(234),r=n(i),a=o(237),s=n(a),l=o(238),u=n(l),c=o(242),d=n(c),h=o(243),p=n(h),f=o(2),m=n(f),v=o(371),y=n(v),g=o(251),w=n(g),b=o(413),x=n(b),E=o(379),M=n(E),C=o(376),_=n(C),S=function(e){function t(e,o){(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,r["default"])(t).call(this,e,o)),i=new x["default"].World;n.world=i,i.gravity.set(0,0,0),i.broadphase=new x["default"].NaiveBroadphase,i.solver.iterations=10;var a=new x["default"].Box(new x["default"].Vec3(1,1,1)),l=1,u=new x["default"].Body({mass:l});u.addShape(a),u.angularVelocity.set(0,10,0),u.angularDamping=.5,i.addBody(u),n._onMouseDown=function(){u.angularVelocity.y+=5},n.cameraPosition=new w["default"].Vector3(0,0,5);var c=1/60,h=function(){i.step(c),n.setState({meshPosition:(new w["default"].Vector3).copy(u.position),meshQuaternion:(new w["default"].Quaternion).copy(u.quaternion)})};return n._onAnimate=function(){h(),n.stats.update()},n.state={meshPosition:new w["default"].Vector3,meshQuaternion:new w["default"].Quaternion},n}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"componentWillUnmount",value:function(){delete this.world,delete this.stats}},{key:"componentDidMount",value:function(){var e=this.refs.container;this.stats=new M["default"],this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",e.appendChild(this.stats.domElement)}},{key:"render",value:function(){var e=this.props,t=e.width,o=e.height,n=this.state,i=n.meshPosition,r=n.meshQuaternion;return m["default"].createElement("div",{ref:"container",onMouseDown:this._onMouseDown},m["default"].createElement(y["default"],{antialias:!0,mainCamera:"camera",width:t,height:o,onAnimate:this._onAnimate},m["default"].createElement("scene",null,m["default"].createElement("perspectiveCamera",{name:"camera",fov:75,aspect:t/o,near:1,far:100,position:this.cameraPosition}),m["default"].createElement("mesh",{position:i,quaternion:r},m["default"].createElement("boxGeometry",{width:2,height:2,depth:2}),m["default"].createElement("meshBasicMaterial",{color:65280,wireframe:!0})))))}}]),t}(_["default"]);t["default"]=S},function(e,t,o){e.exports={version:o(414).version,AABB:o(415),ArrayCollisionMatrix:o(419),Body:o(420),Box:o(425),Broadphase:o(428),Constraint:o(430),ContactEquation:o(431),Narrowphase:o(434),ConeTwistConstraint:o(441),ContactMaterial:o(445),ConvexPolyhedron:o(426),Cylinder:o(446),DistanceConstraint:o(447),Equation:o(432),EventTarget:o(421),FrictionEquation:o(440),GSSolver:o(448),GridBroadphase:o(449),Heightfield:o(450),HingeConstraint:o(451),LockConstraint:o(453),Mat3:o(417),Material:o(424),NaiveBroadphase:o(454),ObjectCollisionMatrix:o(455),Pool:o(439),Particle:o(456),Plane:o(429),PointToPointConstraint:o(442),Quaternion:o(423),Ray:o(435),RaycastVehicle:o(457),RaycastResult:o(436),RigidVehicle:o(459),RotationalEquation:o(444),RotationalMotorEquation:o(452),SAPBroadphase:o(461),SPHSystem:o(462),Shape:o(422),Solver:o(437),Sphere:o(460),SplitSolver:o(463),Spring:o(464),Trimesh:o(465),Vec3:o(416),Vec3Pool:o(438),World:o(467)}},function(e,t){e.exports={_args:[["cannon@^0.6.2","C:\\wamp\\www\\Ecnomic-react\\wintermotes\\project\\react-three-renderer-example"]],_from:"cannon@>=0.6.2 <0.7.0",_id:"cannon@0.6.2",_inCache:!0,_installable:!0,_location:"/cannon",_npmUser:{email:"schteppe@gmail.com",name:"schteppe"},_npmVersion:"1.4.3",_phantomChildren:{},_requested:{name:"cannon",raw:"cannon@^0.6.2",rawSpec:"^0.6.2",scope:null,spec:">=0.6.2 <0.7.0",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/cannon/-/cannon-0.6.2.tgz",_shasum:"1e7bc72dd5841982f3c104c2bc578bfa4fb1c572",_shrinkwrap:null,_spec:"cannon@^0.6.2",_where:"C:\\wamp\\www\\Ecnomic-react\\wintermotes\\project\\react-three-renderer-example",author:{email:"schteppe@gmail.com",name:"Stefan Hedman",url:"http://steffe.se"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},dependencies:{},description:"A lightweight 3D physics engine written in JavaScript.",devDependencies:{browserify:"*",grunt:"~0.4.0","grunt-browserify":"^2.1.4","grunt-contrib-concat":"~0.1.3","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"^0.5.1","grunt-contrib-yuidoc":"^0.5.2",jshint:"latest",nodeunit:"^0.9.0","uglify-js":"latest"},directories:{},dist:{shasum:"1e7bc72dd5841982f3c104c2bc578bfa4fb1c572",tarball:"https://registry.npmjs.org/cannon/-/cannon-0.6.2.tgz"},engines:{node:"*"},homepage:"https://github.com/schteppe/cannon.js",keywords:["3d","cannon","cannon.js","engine","physics"],licenses:[{type:"MIT"}],main:"./build/cannon.js",maintainers:[{name:"schteppe",email:"schteppe@gmail.com"}],name:"cannon",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/schteppe/cannon.js.git"},version:"0.6.2"}},function(e,t,o){function n(e){e=e||{},this.lowerBound=new i,e.lowerBound&&this.lowerBound.copy(e.lowerBound),this.upperBound=new i,e.upperBound&&this.upperBound.copy(e.upperBound)}var i=o(416);o(418);e.exports=n;var r=new i;n.prototype.setFromPoints=function(e,t,o,n){var i=this.lowerBound,a=this.upperBound,s=o;i.copy(e[0]),s&&s.vmult(i,i),a.copy(i);for(var l=1;l<e.length;l++){var u=e[l];s&&(s.vmult(u,r),u=r),u.x>a.x&&(a.x=u.x),u.x<i.x&&(i.x=u.x),u.y>a.y&&(a.y=u.y),u.y<i.y&&(i.y=u.y),u.z>a.z&&(a.z=u.z),u.z<i.z&&(i.z=u.z)}return t&&(t.vadd(i,i),t.vadd(a,a)),n&&(i.x-=n,i.y-=n,i.z-=n,a.x+=n,a.y+=n,a.z+=n),this},n.prototype.copy=function(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this},n.prototype.clone=function(){return(new n).copy(this)},n.prototype.extend=function(e){var t=e.lowerBound.x;this.lowerBound.x>t&&(this.lowerBound.x=t);var o=e.upperBound.x;this.upperBound.x<o&&(this.upperBound.x=o);var t=e.lowerBound.y;this.lowerBound.y>t&&(this.lowerBound.y=t);var o=e.upperBound.y;this.upperBound.y<o&&(this.upperBound.y=o);var t=e.lowerBound.z;this.lowerBound.z>t&&(this.lowerBound.z=t);var o=e.upperBound.z;this.upperBound.z<o&&(this.upperBound.z=o)},n.prototype.overlaps=function(e){var t=this.lowerBound,o=this.upperBound,n=e.lowerBound,i=e.upperBound;return(n.x<=o.x&&o.x<=i.x||t.x<=i.x&&i.x<=o.x)&&(n.y<=o.y&&o.y<=i.y||t.y<=i.y&&i.y<=o.y)&&(n.z<=o.z&&o.z<=i.z||t.z<=i.z&&i.z<=o.z)},n.prototype.contains=function(e){var t=this.lowerBound,o=this.upperBound,n=e.lowerBound,i=e.upperBound;return t.x<=n.x&&o.x>=i.x&&t.y<=n.y&&o.y>=i.y&&t.z<=n.z&&o.z>=i.z},n.prototype.getCorners=function(e,t,o,n,i,r,a,s){var l=this.lowerBound,u=this.upperBound;e.copy(l),t.set(u.x,l.y,l.z),o.set(u.x,u.y,l.z),n.set(l.x,u.y,u.z),i.set(u.x,l.y,l.z),r.set(l.x,u.y,l.z),a.set(l.x,l.y,u.z),s.copy(u)};var a=[new i,new i,new i,new i,new i,new i,new i,new i];n.prototype.toLocalFrame=function(e,t){var o=a,n=o[0],i=o[1],r=o[2],s=o[3],l=o[4],u=o[5],c=o[6],d=o[7];this.getCorners(n,i,r,s,l,u,c,d);for(var h=0;8!==h;h++){var p=o[h];e.pointToLocal(p,p)}return t.setFromPoints(o)},n.prototype.toWorldFrame=function(e,t){var o=a,n=o[0],i=o[1],r=o[2],s=o[3],l=o[4],u=o[5],c=o[6],d=o[7];this.getCorners(n,i,r,s,l,u,c,d);for(var h=0;8!==h;h++){var p=o[h];e.pointToWorld(p,p)}return t.setFromPoints(o)}},function(e,t,o){function n(e,t,o){this.x=e||0,this.y=t||0,this.z=o||0}e.exports=n;var i=o(417);n.ZERO=new n(0,0,0),n.UNIT_X=new n(1,0,0),n.UNIT_Y=new n(0,1,0),n.UNIT_Z=new n(0,0,1),n.prototype.cross=function(e,t){var o=e.x,i=e.y,r=e.z,a=this.x,s=this.y,l=this.z;return t=t||new n,t.x=s*r-l*i,t.y=l*o-a*r,t.z=a*i-s*o,t},n.prototype.set=function(e,t,o){return this.x=e,this.y=t,this.z=o,this},n.prototype.setZero=function(){this.x=this.y=this.z=0},n.prototype.vadd=function(e,t){return t?(t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z,void 0):new n(this.x+e.x,this.y+e.y,this.z+e.z)},n.prototype.vsub=function(e,t){return t?(t.x=this.x-e.x,t.y=this.y-e.y,
t.z=this.z-e.z,void 0):new n(this.x-e.x,this.y-e.y,this.z-e.z)},n.prototype.crossmat=function(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},n.prototype.normalize=function(){var e=this.x,t=this.y,o=this.z,n=Math.sqrt(e*e+t*t+o*o);if(n>0){var i=1/n;this.x*=i,this.y*=i,this.z*=i}else this.x=0,this.y=0,this.z=0;return n},n.prototype.unit=function(e){e=e||new n;var t=this.x,o=this.y,i=this.z,r=Math.sqrt(t*t+o*o+i*i);return r>0?(r=1/r,e.x=t*r,e.y=o*r,e.z=i*r):(e.x=1,e.y=0,e.z=0),e},n.prototype.norm=function(){var e=this.x,t=this.y,o=this.z;return Math.sqrt(e*e+t*t+o*o)},n.prototype.length=n.prototype.norm,n.prototype.norm2=function(){return this.dot(this)},n.prototype.lengthSquared=n.prototype.norm2,n.prototype.distanceTo=function(e){var t=this.x,o=this.y,n=this.z,i=e.x,r=e.y,a=e.z;return Math.sqrt((i-t)*(i-t)+(r-o)*(r-o)+(a-n)*(a-n))},n.prototype.distanceSquared=function(e){var t=this.x,o=this.y,n=this.z,i=e.x,r=e.y,a=e.z;return(i-t)*(i-t)+(r-o)*(r-o)+(a-n)*(a-n)},n.prototype.mult=function(e,t){t=t||new n;var o=this.x,i=this.y,r=this.z;return t.x=e*o,t.y=e*i,t.z=e*r,t},n.prototype.scale=n.prototype.mult,n.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},n.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},n.prototype.negate=function(e){return e=e||new n,e.x=-this.x,e.y=-this.y,e.z=-this.z,e};var r=new n,a=new n;n.prototype.tangents=function(e,t){var o=this.norm();if(o>0){var n=r,i=1/o;n.set(this.x*i,this.y*i,this.z*i);var s=a;Math.abs(n.x)<.9?(s.set(1,0,0),n.cross(s,e)):(s.set(0,1,0),n.cross(s,e)),n.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)},n.prototype.toString=function(){return this.x+","+this.y+","+this.z},n.prototype.toArray=function(){return[this.x,this.y,this.z]},n.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},n.prototype.lerp=function(e,t,o){var n=this.x,i=this.y,r=this.z;o.x=n+(e.x-n)*t,o.y=i+(e.y-i)*t,o.z=r+(e.z-r)*t},n.prototype.almostEquals=function(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)},n.prototype.almostZero=function(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)};var s=new n;n.prototype.isAntiparallelTo=function(e,t){return this.negate(s),s.almostEquals(e,t)},n.prototype.clone=function(){return new n(this.x,this.y,this.z)}},function(e,t,o){function n(e){e?this.elements=e:this.elements=[0,0,0,0,0,0,0,0,0]}e.exports=n;var i=o(416);n.prototype.identity=function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1},n.prototype.setZero=function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0},n.prototype.setTrace=function(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z},n.prototype.getTrace=function(e){var e=e||new i,t=this.elements;e.x=t[0],e.y=t[4],e.z=t[8]},n.prototype.vmult=function(e,t){t=t||new i;var o=this.elements,n=e.x,r=e.y,a=e.z;return t.x=o[0]*n+o[1]*r+o[2]*a,t.y=o[3]*n+o[4]*r+o[5]*a,t.z=o[6]*n+o[7]*r+o[8]*a,t},n.prototype.smult=function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]*=e},n.prototype.mmult=function(e,t){for(var o=t||new n,i=0;3>i;i++)for(var r=0;3>r;r++){for(var a=0,s=0;3>s;s++)a+=e.elements[i+3*s]*this.elements[s+3*r];o.elements[i+3*r]=a}return o},n.prototype.scale=function(e,t){t=t||new n;for(var o=this.elements,i=t.elements,r=0;3!==r;r++)i[3*r+0]=e.x*o[3*r+0],i[3*r+1]=e.y*o[3*r+1],i[3*r+2]=e.z*o[3*r+2];return t},n.prototype.solve=function(e,t){t=t||new i;for(var o=3,n=4,r=[],a=0;o*n>a;a++)r.push(0);var a,s;for(a=0;3>a;a++)for(s=0;3>s;s++)r[a+n*s]=this.elements[a+3*s];r[3]=e.x,r[7]=e.y,r[11]=e.z;var l,u,c=3,d=c,h=4;do{if(a=d-c,0===r[a+n*a])for(s=a+1;d>s;s++)if(0!==r[a+n*s]){l=h;do u=h-l,r[u+n*a]+=r[u+n*s];while(--l);break}if(0!==r[a+n*a])for(s=a+1;d>s;s++){var p=r[a+n*s]/r[a+n*a];l=h;do u=h-l,r[u+n*s]=a>=u?0:r[u+n*s]-r[u+n*a]*p;while(--l)}}while(--c);if(t.z=r[2*n+3]/r[2*n+2],t.y=(r[1*n+3]-r[1*n+2]*t.z)/r[1*n+1],t.x=(r[0*n+3]-r[0*n+2]*t.z-r[0*n+1]*t.y)/r[0*n+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=["+t.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return t},n.prototype.e=function(e,t,o){return void 0===o?this.elements[t+3*e]:void(this.elements[t+3*e]=o)},n.prototype.copy=function(e){for(var t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this},n.prototype.toString=function(){for(var e="",t=",",o=0;9>o;o++)e+=this.elements[o]+t;return e},n.prototype.reverse=function(e){e=e||new n;for(var t=3,o=6,i=[],r=0;t*o>r;r++)i.push(0);var r,a;for(r=0;3>r;r++)for(a=0;3>a;a++)i[r+o*a]=this.elements[r+3*a];i[3]=1,i[9]=0,i[15]=0,i[4]=0,i[10]=1,i[16]=0,i[5]=0,i[11]=0,i[17]=1;var s,l,u=3,c=u,d=o;do{if(r=c-u,0===i[r+o*r])for(a=r+1;c>a;a++)if(0!==i[r+o*a]){s=d;do l=d-s,i[l+o*r]+=i[l+o*a];while(--s);break}if(0!==i[r+o*r])for(a=r+1;c>a;a++){var h=i[r+o*a]/i[r+o*r];s=d;do l=d-s,i[l+o*a]=r>=l?0:i[l+o*a]-i[l+o*r]*h;while(--s)}}while(--u);r=2;do{a=r-1;do{var h=i[r+o*a]/i[r+o*r];s=o;do l=o-s,i[l+o*a]=i[l+o*a]-i[l+o*r]*h;while(--s)}while(a--)}while(--r);r=2;do{var h=1/i[r+o*r];s=o;do l=o-s,i[l+o*r]=i[l+o*r]*h;while(--s)}while(r--);r=2;do{a=2;do{if(l=i[t+a+o*r],isNaN(l)||l===1/0)throw"Could not reverse! A=["+this.toString()+"]";e.e(r,a,l)}while(a--)}while(r--);return e},n.prototype.setRotationFromQuaternion=function(e){var t=e.x,o=e.y,n=e.z,i=e.w,r=t+t,a=o+o,s=n+n,l=t*r,u=t*a,c=t*s,d=o*a,h=o*s,p=n*s,f=i*r,m=i*a,v=i*s,y=this.elements;return y[0]=1-(d+p),y[1]=u-v,y[2]=c+m,y[3]=u+v,y[4]=1-(l+p),y[5]=h-f,y[6]=c-m,y[7]=h+f,y[8]=1-(l+d),this},n.prototype.transpose=function(e){e=e||new n;for(var t=e.elements,o=this.elements,i=0;3!==i;i++)for(var r=0;3!==r;r++)t[3*i+r]=o[3*r+i];return e}},function(e,t){function o(){}e.exports=o,o.defaults=function(e,t){e=e||{};for(var o in t)o in e||(e[o]=t[o]);return e}},function(e,t){function o(){this.matrix=[]}e.exports=o,o.prototype.get=function(e,t){if(e=e.index,t=t.index,t>e){var o=t;t=e,e=o}return this.matrix[(e*(e+1)>>1)+t-1]},o.prototype.set=function(e,t,o){if(e=e.index,t=t.index,t>e){var n=t;t=e,e=n}this.matrix[(e*(e+1)>>1)+t-1]=o?1:0},o.prototype.reset=function(){for(var e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0},o.prototype.setNumObjects=function(e){this.matrix.length=e*(e-1)>>1}},function(e,t,o){function n(e){e=e||{},i.apply(this),this.id=n.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new r,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:1,this.collisionResponse=!0,this.position=new r,e.position&&this.position.copy(e.position),this.previousPosition=new r,this.initPosition=new r,this.velocity=new r,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new r,this.force=new r;var t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=0>=t?n.STATIC:n.DYNAMIC,typeof e.type==typeof n.STATIC&&(this.type=e.type),this.allowSleep="undefined"!=typeof e.allowSleep?e.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit="undefined"!=typeof e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit="undefined"!=typeof e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new r,this.quaternion=new s,e.quaternion&&this.quaternion.copy(e.quaternion),this.initQuaternion=new s,this.angularVelocity=new r,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new r,this.interpolatedPosition=new r,this.interpolatedQuaternion=new s,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new r,this.invInertia=new r,this.invInertiaWorld=new a,this.invMassSolve=0,this.invInertiaSolve=new r,this.invInertiaWorldSolve=new a,this.fixedRotation="undefined"!=typeof e.fixedRotation?e.fixedRotation:!1,this.angularDamping="undefined"!=typeof e.angularDamping?e.angularDamping:.01,this.aabb=new l,this.aabbNeedsUpdate=!0,this.wlambda=new r,e.shape&&this.addShape(e.shape),this.updateMassProperties()}e.exports=n;var i=o(421),r=(o(422),o(416)),a=o(417),s=o(423),l=(o(424),o(415)),u=o(425);n.prototype=new i,n.prototype.constructor=n,n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2,n.idCounter=0,n.prototype.wakeUp=function(){var e=this.sleepState;this.sleepState=0,e===n.SLEEPING&&this.dispatchEvent({type:"wakeup"})},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.prototype.sleepTick=function(e){if(this.allowSleep){var t=this.sleepState,o=this.velocity.norm2()+this.angularVelocity.norm2(),i=Math.pow(this.sleepSpeedLimit,2);t===n.AWAKE&&i>o?(this.sleepState=n.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(n.sleepyEvent)):t===n.SLEEPY&&o>i?this.wakeUp():t===n.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(n.sleepEvent))}},n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},n.prototype.pointToLocalFrame=function(e,t){var t=t||new r;return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t},n.prototype.vectorToLocalFrame=function(e,t){var t=t||new r;return this.quaternion.conjugate().vmult(e,t),t},n.prototype.pointToWorldFrame=function(e,t){var t=t||new r;return this.quaternion.vmult(e,t),t.vadd(this.position,t),t},n.prototype.vectorToWorldFrame=function(e,t){var t=t||new r;return this.quaternion.vmult(e,t),t};var c=new r,d=new s;n.prototype.addShape=function(e,t,o){var n=new r,i=new s;return t&&n.copy(t),o&&i.copy(o),this.shapes.push(e),this.shapeOffsets.push(n),this.shapeOrientations.push(i),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},n.prototype.updateBoundingRadius=function(){for(var e=this.shapes,t=this.shapeOffsets,o=e.length,n=0,i=0;i!==o;i++){var r=e[i];r.updateBoundingSphereRadius();var a=t[i].norm(),s=r.boundingSphereRadius;a+s>n&&(n=a+s)}this.boundingRadius=n};var h=new l;n.prototype.computeAABB=function(){for(var e=this.shapes,t=this.shapeOffsets,o=this.shapeOrientations,n=e.length,i=c,r=d,a=this.quaternion,s=this.aabb,l=h,u=0;u!==n;u++){var p=e[u];o[u].mult(a,r),r.vmult(t[u],i),i.vadd(this.position,i),p.calculateWorldAABB(i,r,l.lowerBound,l.upperBound),0===u?s.copy(l):s.extend(l)}this.aabbNeedsUpdate=!1};var p=new a,f=new a;new a;n.prototype.updateInertiaWorld=function(e){var t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){var o=p,n=f;o.setRotationFromQuaternion(this.quaternion),o.transpose(n),o.scale(t,o),o.mmult(n,this.invInertiaWorld)}else;};var m=new r,v=new r;n.prototype.applyForce=function(e,t){if(this.type===n.DYNAMIC){var o=m;t.vsub(this.position,o);var i=v;o.cross(e,i),this.force.vadd(e,this.force),this.torque.vadd(i,this.torque)}};var y=new r,g=new r;n.prototype.applyLocalForce=function(e,t){if(this.type===n.DYNAMIC){var o=y,i=g;this.vectorToWorldFrame(e,o),this.pointToWorldFrame(t,i),this.applyForce(o,i)}};var w=new r,b=new r,x=new r;n.prototype.applyImpulse=function(e,t){if(this.type===n.DYNAMIC){var o=w;t.vsub(this.position,o);var i=b;i.copy(e),i.mult(this.invMass,i),this.velocity.vadd(i,this.velocity);var r=x;o.cross(e,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}};var E=new r,M=new r;n.prototype.applyLocalImpulse=function(e,t){if(this.type===n.DYNAMIC){var o=E,i=M;this.vectorToWorldFrame(e,o),this.pointToWorldFrame(t,i),this.applyImpulse(o,i)}};var C=new r;n.prototype.updateMassProperties=function(){var e=C;this.invMass=this.mass>0?1/this.mass:0;var t=this.inertia,o=this.fixedRotation;this.computeAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),u.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!o?1/t.x:0,t.y>0&&!o?1/t.y:0,t.z>0&&!o?1/t.z:0),this.updateInertiaWorld(!0)},n.prototype.getVelocityAtWorldPoint=function(e,t){var o=new r;return e.vsub(this.position,o),this.angularVelocity.cross(o,t),this.velocity.vadd(t,t),t}},function(e,t){var o=function(){};e.exports=o,o.prototype={constructor:o,addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var o=this._listeners;return void 0===o[e]&&(o[e]=[]),-1===o[e].indexOf(t)&&o[e].push(t),this},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var o=this._listeners;return void 0!==o[e]&&-1!==o[e].indexOf(t)},removeEventListener:function(e,t){if(void 0===this._listeners)return this;var o=this._listeners;if(void 0===o[e])return this;var n=o[e].indexOf(t);return-1!==n&&o[e].splice(n,1),this},dispatchEvent:function(e){if(void 0===this._listeners)return this;var t=this._listeners,o=t[e.type];if(void 0!==o){e.target=this;for(var n=0,i=o.length;i>n;n++)o[n].call(this,e)}return this}}},function(e,t,o){function n(){this.id=n.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}e.exports=n;var n=o(422);o(416),o(423),o(424);n.prototype.constructor=n,n.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},n.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},n.prototype.calculateLocalInertia=function(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type},n.idCounter=0,n.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},function(e,t,o){function n(e,t,o,n){this.x=void 0!==e?e:0,this.y=void 0!==t?t:0,this.z=void 0!==o?o:0,this.w=void 0!==n?n:1}e.exports=n;var i=o(416);n.prototype.set=function(e,t,o,n){this.x=e,this.y=t,this.z=o,this.w=n},n.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},n.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},n.prototype.setFromAxisAngle=function(e,t){var o=Math.sin(.5*t);this.x=e.x*o,this.y=e.y*o,this.z=e.z*o,this.w=Math.cos(.5*t)},n.prototype.toAxisAngle=function(e){e=e||new i,this.normalize();var t=2*Math.acos(this.w),o=Math.sqrt(1-this.w*this.w);return.001>o?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/o,e.y=this.y/o,e.z=this.z/o),[e,t]};var r=new i,a=new i;n.prototype.setFromVectors=function(e,t){if(e.isAntiparallelTo(t)){var o=r,n=a;e.tangents(o,n),this.setFromAxisAngle(o,Math.PI)}else{var i=e.cross(t);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(Math.pow(e.norm(),2)*Math.pow(t.norm(),2))+e.dot(t),this.normalize()}};var s=new i,l=new i,u=new i;n.prototype.mult=function(e,t){t=t||new n;var o=this.w,i=s,r=l,a=u;return i.set(this.x,this.y,this.z),r.set(e.x,e.y,e.z),t.w=o*e.w-i.dot(r),i.cross(r,a),t.x=o*r.x+e.w*i.x+a.x,t.y=o*r.y+e.w*i.y+a.y,t.z=o*r.z+e.w*i.z+a.z,t},n.prototype.inverse=function(e){var t=this.x,o=this.y,i=this.z,r=this.w;e=e||new n,this.conjugate(e);var a=1/(t*t+o*o+i*i+r*r);return e.x*=a,e.y*=a,e.z*=a,e.w*=a,e},n.prototype.conjugate=function(e){return e=e||new n,e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e},n.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e)},n.prototype.normalizeFast=function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e)},n.prototype.vmult=function(e,t){t=t||new i;var o=e.x,n=e.y,r=e.z,a=this.x,s=this.y,l=this.z,u=this.w,c=u*o+s*r-l*n,d=u*n+l*o-a*r,h=u*r+a*n-s*o,p=-a*o-s*n-l*r;return t.x=c*u+p*-a+d*-l-h*-s,t.y=d*u+p*-s+h*-a-c*-l,t.z=h*u+p*-l+c*-s-d*-a,t},n.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},n.prototype.toEuler=function(e,t){t=t||"YZX";var o,n,i,r=this.x,a=this.y,s=this.z,l=this.w;switch(t){case"YZX":var u=r*a+s*l;if(u>.499&&(o=2*Math.atan2(r,l),n=Math.PI/2,i=0),-.499>u&&(o=-2*Math.atan2(r,l),n=-Math.PI/2,i=0),isNaN(o)){var c=r*r,d=a*a,h=s*s;o=Math.atan2(2*a*l-2*r*s,1-2*d-2*h),n=Math.asin(2*u),i=Math.atan2(2*r*l-2*a*s,1-2*c-2*h)}break;default:throw new Error("Euler order "+t+" not supported yet.")}e.y=o,e.z=n,e.x=i},n.prototype.setFromEuler=function(e,t,o,n){n=n||"XYZ";var i=Math.cos(e/2),r=Math.cos(t/2),a=Math.cos(o/2),s=Math.sin(e/2),l=Math.sin(t/2),u=Math.sin(o/2);return"XYZ"===n?(this.x=s*r*a+i*l*u,this.y=i*l*a-s*r*u,this.z=i*r*u+s*l*a,this.w=i*r*a-s*l*u):"YXZ"===n?(this.x=s*r*a+i*l*u,this.y=i*l*a-s*r*u,this.z=i*r*u-s*l*a,this.w=i*r*a+s*l*u):"ZXY"===n?(this.x=s*r*a-i*l*u,this.y=i*l*a+s*r*u,this.z=i*r*u+s*l*a,this.w=i*r*a-s*l*u):"ZYX"===n?(this.x=s*r*a-i*l*u,this.y=i*l*a+s*r*u,this.z=i*r*u-s*l*a,this.w=i*r*a+s*l*u):"YZX"===n?(this.x=s*r*a+i*l*u,this.y=i*l*a+s*r*u,this.z=i*r*u-s*l*a,this.w=i*r*a-s*l*u):"XZY"===n&&(this.x=s*r*a-i*l*u,this.y=i*l*a-s*r*u,this.z=i*r*u+s*l*a,this.w=i*r*a+s*l*u),this},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)}},function(e,t){function o(e){var t="";e=e||{},"string"==typeof e?(t=e,e={}):"object"==typeof e&&(t=""),this.name=t,this.id=o.idCounter++,this.friction="undefined"!=typeof e.friction?e.friction:-1,this.restitution="undefined"!=typeof e.restitution?e.restitution:-1}e.exports=o,o.idCounter=0},function(e,t,o){function n(e){i.call(this),this.type=i.types.BOX,this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}e.exports=n;var i=o(422),r=o(416),a=o(426);n.prototype=new i,n.prototype.constructor=n,n.prototype.updateConvexPolyhedronRepresentation=function(){var e=this.halfExtents.x,t=this.halfExtents.y,o=this.halfExtents.z,n=r,i=[new n(-e,-t,-o),new n(e,-t,-o),new n(e,t,-o),new n(-e,t,-o),new n(-e,-t,o),new n(e,-t,o),new n(e,t,o),new n(-e,t,o)],s=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],l=([new n(0,0,1),new n(0,1,0),new n(1,0,0)],new a(i,s));this.convexPolyhedronRepresentation=l,l.material=this.material},n.prototype.calculateLocalInertia=function(e,t){return t=t||new r,n.calculateInertia(this.halfExtents,e,t),t},n.calculateInertia=function(e,t,o){var n=e;o.x=1/12*t*(2*n.y*2*n.y+2*n.z*2*n.z),o.y=1/12*t*(2*n.x*2*n.x+2*n.z*2*n.z),o.z=1/12*t*(2*n.y*2*n.y+2*n.x*2*n.x)},n.prototype.getSideNormals=function(e,t){var o=e,n=this.halfExtents;if(o[0].set(n.x,0,0),o[1].set(0,n.y,0),o[2].set(0,0,n.z),o[3].set(-n.x,0,0),o[4].set(0,-n.y,0),o[5].set(0,0,-n.z),void 0!==t)for(var i=0;i!==o.length;i++)t.vmult(o[i],o[i]);return o},n.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var s=new r;new r;n.prototype.forEachWorldCorner=function(e,t,o){for(var n=this.halfExtents,i=[[n.x,n.y,n.z],[-n.x,n.y,n.z],[-n.x,-n.y,n.z],[-n.x,-n.y,-n.z],[n.x,-n.y,-n.z],[n.x,n.y,-n.z],[-n.x,n.y,-n.z],[n.x,-n.y,n.z]],r=0;r<i.length;r++)s.set(i[r][0],i[r][1],i[r][2]),t.vmult(s,s),e.vadd(s,s),o(s.x,s.y,s.z)};var l=[new r,new r,new r,new r,new r,new r,new r,new r];n.prototype.calculateWorldAABB=function(e,t,o,n){var i=this.halfExtents;l[0].set(i.x,i.y,i.z),l[1].set(-i.x,i.y,i.z),l[2].set(-i.x,-i.y,i.z),l[3].set(-i.x,-i.y,-i.z),l[4].set(i.x,-i.y,-i.z),l[5].set(i.x,i.y,-i.z),l[6].set(-i.x,i.y,-i.z),l[7].set(i.x,-i.y,i.z);var r=l[0];t.vmult(r,r),e.vadd(r,r),n.copy(r),o.copy(r);for(var a=1;8>a;a++){var r=l[a];t.vmult(r,r),e.vadd(r,r);var s=r.x,u=r.y,c=r.z;s>n.x&&(n.x=s),u>n.y&&(n.y=u),c>n.z&&(n.z=c),s<o.x&&(o.x=s),u<o.y&&(o.y=u),c<o.z&&(o.z=c)}}},function(e,t,o){function n(e,t,o){i.call(this),this.type=i.types.CONVEXPOLYHEDRON,this.vertices=e||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=t||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=o?o.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}e.exports=n;var i=o(422),r=o(416),a=(o(423),o(427));n.prototype=new i,n.prototype.constructor=n;var s=new r;n.prototype.computeEdges=function(){var e=this.faces,t=this.vertices,o=(t.length,this.uniqueEdges);o.length=0;for(var n=s,i=0;i!==e.length;i++)for(var r=e[i],a=r.length,l=0;l!==a;l++){var u=(l+1)%a;t[r[l]].vsub(t[r[u]],n),n.normalize();for(var c=!1,d=0;d!==o.length;d++)if(o[d].almostEquals(n)||o[d].almostEquals(n)){c=!0;break}c||o.push(n.clone())}},n.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var e=0;e<this.faces.length;e++){for(var t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error("Vertex "+this.faces[e][t]+" not found!");var o=this.faceNormals[e]||new r;this.getFaceNormal(e,o),o.negate(o),this.faceNormals[e]=o;var n=this.vertices[this.faces[e][0]];if(o.dot(n)<0){console.error(".faceNormals["+e+"] = Vec3("+o.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var t=0;t<this.faces[e].length;t++)console.warn(".vertices["+this.faces[e][t]+"] = Vec3("+this.vertices[this.faces[e][t]].toString()+")")}}};var l=new r,u=new r;n.computeNormal=function(e,t,o,n){t.vsub(e,u),o.vsub(t,l),l.cross(u,n),n.isZero()||n.normalize()},n.prototype.getFaceNormal=function(e,t){var o=this.faces[e],i=this.vertices[o[0]],r=this.vertices[o[1]],a=this.vertices[o[2]];return n.computeNormal(i,r,a,t)};var c=new r;n.prototype.clipAgainstHull=function(e,t,o,n,i,a,s,l,u){for(var d=c,h=-1,p=-Number.MAX_VALUE,f=0;f<o.faces.length;f++){d.copy(o.faceNormals[f]),i.vmult(d,d);var m=d.dot(a);m>p&&(p=m,h=f)}for(var v=[],y=o.faces[h],g=y.length,w=0;g>w;w++){var b=o.vertices[y[w]],x=new r;x.copy(b),i.vmult(x,x),n.vadd(x,x),v.push(x)}h>=0&&this.clipFaceAgainstHull(a,e,t,v,s,l,u)};var d=new r,h=new r,p=new r,f=new r,m=new r,v=new r;n.prototype.findSeparatingAxis=function(e,t,o,n,i,r,a,s){var l=d,u=h,c=p,y=f,g=m,w=v,b=Number.MAX_VALUE,x=this,E=0;if(x.uniqueAxes)for(var M=0;M!==x.uniqueAxes.length;M++){o.vmult(x.uniqueAxes[M],l);var C=x.testSepAxis(l,e,t,o,n,i);if(C===!1)return!1;b>C&&(b=C,r.copy(l))}else for(var _=a?a.length:x.faces.length,M=0;_>M;M++){var S=a?a[M]:M;l.copy(x.faceNormals[S]),o.vmult(l,l);var C=x.testSepAxis(l,e,t,o,n,i);if(C===!1)return!1;b>C&&(b=C,r.copy(l))}if(e.uniqueAxes)for(var M=0;M!==e.uniqueAxes.length;M++){i.vmult(e.uniqueAxes[M],u),E++;var C=x.testSepAxis(u,e,t,o,n,i);if(C===!1)return!1;b>C&&(b=C,r.copy(u))}else for(var P=s?s.length:e.faces.length,M=0;P>M;M++){var S=s?s[M]:M;u.copy(e.faceNormals[S]),i.vmult(u,u),E++;var C=x.testSepAxis(u,e,t,o,n,i);if(C===!1)return!1;b>C&&(b=C,r.copy(u))}for(var R=0;R!==x.uniqueEdges.length;R++){o.vmult(x.uniqueEdges[R],y);for(var A=0;A!==e.uniqueEdges.length;A++)if(i.vmult(e.uniqueEdges[A],g),y.cross(g,w),!w.almostZero()){w.normalize();var B=x.testSepAxis(w,e,t,o,n,i);if(B===!1)return!1;b>B&&(b=B,r.copy(w))}}return n.vsub(t,c),c.dot(r)>0&&r.negate(r),!0};var y=[],g=[];n.prototype.testSepAxis=function(e,t,o,i,r,a){var s=this;n.project(s,e,o,i,y),n.project(t,e,r,a,g);var l=y[0],u=y[1],c=g[0],d=g[1];if(d>l||u>c)return!1;var h=l-d,p=c-u,f=p>h?h:p;return f};var w=new r,b=new r;n.prototype.calculateLocalInertia=function(e,t){this.computeLocalAABB(w,b);var o=b.x-w.x,n=b.y-w.y,i=b.z-w.z;t.x=1/12*e*(2*n*2*n+2*i*2*i),t.y=1/12*e*(2*o*2*o+2*i*2*i),t.z=1/12*e*(2*n*2*n+2*o*2*o)},n.prototype.getPlaneConstantOfFace=function(e){var t=this.faces[e],o=this.faceNormals[e],n=this.vertices[t[0]],i=-o.dot(n);return i};var x=new r,E=new r,M=new r,C=new r,_=new r,S=new r,P=new r,R=new r;n.prototype.clipFaceAgainstHull=function(e,t,o,n,i,r,a){for(var s=x,l=E,u=M,c=C,d=_,h=S,p=P,f=R,m=this,v=[],y=n,g=v,w=-1,b=Number.MAX_VALUE,A=0;A<m.faces.length;A++){s.copy(m.faceNormals[A]),o.vmult(s,s);var B=s.dot(e);b>B&&(b=B,w=A)}if(!(0>w)){var T=m.faces[w];T.connectedFaces=[];for(var I=0;I<m.faces.length;I++)for(var z=0;z<m.faces[I].length;z++)-1!==T.indexOf(m.faces[I][z])&&I!==w&&-1===T.connectedFaces.indexOf(I)&&T.connectedFaces.push(I);for(var F=(y.length,T.length),V=0;F>V;V++){var q=m.vertices[T[V]],L=m.vertices[T[(V+1)%F]];q.vsub(L,l),u.copy(l),o.vmult(u,u),t.vadd(u,u),c.copy(this.faceNormals[w]),o.vmult(c,c),t.vadd(c,c),u.cross(c,d),d.negate(d),h.copy(q),o.vmult(h,h),t.vadd(h,h);var k,N=(-h.dot(d),T.connectedFaces[V]);p.copy(this.faceNormals[N]);var j=this.getPlaneConstantOfFace(N);f.copy(p),o.vmult(f,f);var k=j-f.dot(t);for(this.clipFaceAgainstPlane(y,g,f,k);y.length;)y.shift();for(;g.length;)y.push(g.shift())}p.copy(this.faceNormals[w]);var j=this.getPlaneConstantOfFace(w);f.copy(p),o.vmult(f,f);for(var k=j-f.dot(t),I=0;I<y.length;I++){var D=f.dot(y[I])+k;if(i>=D&&(console.log("clamped: depth="+D+" to minDist="+(i+"")),D=i),r>=D){var O=y[I];if(0>=D){var W={point:O,normal:f,depth:D};a.push(W)}}}}},n.prototype.clipFaceAgainstPlane=function(e,t,o,n){var i,a,s=e.length;if(2>s)return t;var l=e[e.length-1],u=e[0];i=o.dot(l)+n;for(var c=0;s>c;c++){if(u=e[c],a=o.dot(u)+n,0>i)if(0>a){var d=new r;d.copy(u),t.push(d)}else{var d=new r;l.lerp(u,i/(i-a),d),t.push(d)}else if(0>a){var d=new r;l.lerp(u,i/(i-a),d),t.push(d),t.push(u)}l=u,i=a}return t},n.prototype.computeWorldVertices=function(e,t){for(var o=this.vertices.length;this.worldVertices.length<o;)this.worldVertices.push(new r);for(var n=this.vertices,i=this.worldVertices,a=0;a!==o;a++)t.vmult(n[a],i[a]),e.vadd(i[a],i[a]);this.worldVerticesNeedsUpdate=!1};new r;n.prototype.computeLocalAABB=function(e,t){var o=this.vertices.length,n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var i=0;o>i;i++){var r=n[i];r.x<e.x?e.x=r.x:r.x>t.x&&(t.x=r.x),r.y<e.y?e.y=r.y:r.y>t.y&&(t.y=r.y),r.z<e.z?e.z=r.z:r.z>t.z&&(t.z=r.z)}},n.prototype.computeWorldFaceNormals=function(e){for(var t=this.faceNormals.length;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new r);for(var o=this.faceNormals,n=this.worldFaceNormals,i=0;i!==t;i++)e.vmult(o[i],n[i]);this.worldFaceNormalsNeedsUpdate=!1},n.prototype.updateBoundingSphereRadius=function(){for(var e=0,t=this.vertices,o=0,n=t.length;o!==n;o++){var i=t[o].norm2();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)};var A=new r;n.prototype.calculateWorldAABB=function(e,t,o,n){for(var i,r,a,s,l,u,c=this.vertices.length,d=this.vertices,h=0;c>h;h++){A.copy(d[h]),t.vmult(A,A),e.vadd(A,A);var p=A;p.x<i||void 0===i?i=p.x:(p.x>s||void 0===s)&&(s=p.x),p.y<r||void 0===r?r=p.y:(p.y>l||void 0===l)&&(l=p.y),p.z<a||void 0===a?a=p.z:(p.z>u||void 0===u)&&(u=p.z)}o.set(i,r,a),n.set(s,l,u)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.prototype.getAveragePointLocal=function(e){e=e||new r;for(var t=this.vertices.length,o=this.vertices,n=0;t>n;n++)e.vadd(o[n],e);return e.mult(1/t,e),e},n.prototype.transformAllPoints=function(e,t){var o=this.vertices.length,n=this.vertices;if(t){for(var i=0;o>i;i++){var r=n[i];t.vmult(r,r)}for(var i=0;i<this.faceNormals.length;i++){var r=this.faceNormals[i];t.vmult(r,r)}}if(e)for(var i=0;o>i;i++){var r=n[i];r.vadd(e,r)}};var B=new r,T=new r,I=new r;n.prototype.pointIsInside=function(e){var t=this.vertices.length,o=this.vertices,n=this.faces,i=this.faceNormals,r=null,a=this.faces.length,s=B;this.getAveragePointLocal(s);for(var l=0;a>l;l++){var t=(this.faces[l].length,i[l]),u=o[n[l][0]],c=T;e.vsub(u,c);var d=t.dot(c),h=I;s.vsub(u,h);var p=t.dot(h);if(0>d&&p>0||d>0&&0>p)return!1}return r?1:-1};var z=(new r,new r),F=new r;n.project=function(e,t,o,n,i){var r=e.vertices.length,s=z,l=0,u=0,c=F,d=e.vertices;c.setZero(),a.vectorToLocalFrame(o,n,t,s),a.pointToLocalFrame(o,n,c,c);var h=c.dot(s);u=l=d[0].dot(s);for(var p=1;r>p;p++){var f=d[p].dot(s);f>l&&(l=f),u>f&&(u=f)}if(u-=h,l-=h,u>l){var m=u;u=l,l=m}i[0]=l,i[1]=u}},function(e,t,o){function n(e){e=e||{},this.position=new i,e.position&&this.position.copy(e.position),this.quaternion=new r,e.quaternion&&this.quaternion.copy(e.quaternion)}var i=o(416),r=o(423);e.exports=n;var a=new r;n.pointToLocalFrame=function(e,t,o,n){var n=n||new i;return o.vsub(e,n),t.conjugate(a),a.vmult(n,n),n},n.prototype.pointToLocal=function(e,t){return n.pointToLocalFrame(this.position,this.quaternion,e,t)},n.pointToWorldFrame=function(e,t,o,n){var n=n||new i;return t.vmult(o,n),n.vadd(e,n),n},n.prototype.pointToWorld=function(e,t){return n.pointToWorldFrame(this.position,this.quaternion,e,t)},n.prototype.vectorToWorldFrame=function(e,t){var t=t||new i;return this.quaternion.vmult(e,t),t},n.vectorToWorldFrame=function(e,t,o){return e.vmult(t,o),o},n.vectorToLocalFrame=function(e,t,o,n){var n=n||new i;return t.w*=-1,t.vmult(o,n),t.w*=-1,n}},function(e,t,o){function n(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var i=o(420),r=o(416),a=o(423);o(422),o(429);e.exports=n,n.prototype.collisionPairs=function(e,t,o){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var s=i.STATIC|i.KINEMATIC;n.prototype.needBroadphaseCollision=function(e,t){return 0===(e.collisionFilterGroup&t.collisionFilterMask)||0===(t.collisionFilterGroup&e.collisionFilterMask)?!1:0===(e.type&s)&&e.sleepState!==i.SLEEPING||0===(t.type&s)&&t.sleepState!==i.SLEEPING},n.prototype.intersectionTest=function(e,t,o,n){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,o,n):this.doBoundingSphereBroadphase(e,t,o,n)};var l=new r;new r,new a,new r;n.prototype.doBoundingSphereBroadphase=function(e,t,o,n){var i=l;t.position.vsub(e.position,i);var r=Math.pow(e.boundingRadius+t.boundingRadius,2),a=i.norm2();r>a&&(o.push(e),n.push(t))},n.prototype.doBoundingBoxBroadphase=function(e,t,o,n){e.aabbNeedsUpdate&&e.computeAABB(),t.aabbNeedsUpdate&&t.computeAABB(),e.aabb.overlaps(t.aabb)&&(o.push(e),n.push(t))};var u={keys:[]},c=[],d=[];n.prototype.makePairsUnique=function(e,t){for(var o=u,n=c,i=d,r=e.length,a=0;a!==r;a++)n[a]=e[a],i[a]=t[a];e.length=0,t.length=0;for(var a=0;a!==r;a++){var s=n[a].id,l=i[a].id,h=l>s?s+","+l:l+","+s;o[h]=a,o.keys.push(h)}for(var a=0;a!==o.keys.length;a++){var h=o.keys.pop(),p=o[h];e.push(n[p]),t.push(i[p]),delete o[h]}},n.prototype.setWorld=function(e){};var h=new r;n.boundingSphereCheck=function(e,t){var o=h;return e.position.vsub(t.position,o),Math.pow(e.shape.boundingSphereRadius+t.shape.boundingSphereRadius,2)>o.norm2()},n.prototype.aabbQuery=function(e,t,o){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},function(e,t,o){function n(){i.call(this),this.type=i.types.PLANE,this.worldNormal=new r,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}e.exports=n;var i=o(422),r=o(416);n.prototype=new i,n.prototype.constructor=n,n.prototype.computeWorldNormal=function(e){var t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1},n.prototype.calculateLocalInertia=function(e,t){return t=t||new r},n.prototype.volume=function(){return Number.MAX_VALUE};var a=new r;n.prototype.calculateWorldAABB=function(e,t,o,n){a.set(0,0,1),t.vmult(a,a);var i=Number.MAX_VALUE;o.set(-i,-i,-i),n.set(i,i,i),1===a.x&&(n.x=e.x),1===a.y&&(n.y=e.y),1===a.z&&(n.z=e.z),-1===a.x&&(o.x=e.x),-1===a.y&&(o.y=e.y),-1===a.z&&(o.z=e.z)},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},function(e,t,o){function n(e,t,o){o=i.defaults(o,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=n.idCounter++,this.collideConnected=o.collideConnected,o.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}e.exports=n;var i=o(418);n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!");
},n.prototype.enable=function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!0},n.prototype.disable=function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!1},n.idCounter=0},function(e,t,o){function n(e,t,o){o="undefined"!=typeof o?o:1e6,i.call(this,e,t,0,o),this.restitution=0,this.ri=new r,this.rj=new r,this.ni=new r}e.exports=n;var i=o(432),r=o(416);o(417);n.prototype=new i,n.prototype.constructor=n;var a=new r,s=new r,l=new r;n.prototype.computeB=function(e){var t=this.a,o=this.b,n=this.bi,i=this.bj,r=this.ri,u=this.rj,c=a,d=s,h=n.velocity,p=n.angularVelocity,f=(n.force,n.torque,i.velocity),m=i.angularVelocity,v=(i.force,i.torque,l),y=this.jacobianElementA,g=this.jacobianElementB,w=this.ni;r.cross(w,c),u.cross(w,d),w.negate(y.spatial),c.negate(y.rotational),g.spatial.copy(w),g.rotational.copy(d),v.copy(i.position),v.vadd(u,v),v.vsub(n.position,v),v.vsub(r,v);var b=w.dot(v),x=this.restitution+1,E=x*f.dot(w)-x*h.dot(w)+m.dot(d)-p.dot(c),M=this.computeGiMf(),C=-b*t-E*o-e*M;return C};var u=new r,c=new r,d=new r,h=new r,p=new r;n.prototype.getImpactVelocityAlongNormal=function(){var e=u,t=c,o=d,n=h,i=p;return this.bi.position.vadd(this.ri,o),this.bj.position.vadd(this.rj,n),this.bi.getVelocityAtWorldPoint(o,e),this.bj.getVelocityAtWorldPoint(n,t),e.vsub(t,i),this.ni.dot(i)}},function(e,t,o){function n(e,t,o,r){this.id=n.id++,this.minForce="undefined"==typeof o?-1e6:o,this.maxForce="undefined"==typeof r?1e6:r,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new i,this.jacobianElementB=new i,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}e.exports=n;var i=o(433),r=o(416);n.prototype.constructor=n,n.id=0,n.prototype.setSpookParams=function(e,t,o){var n=t,i=e,r=o;this.a=4/(r*(1+4*n)),this.b=4*n/(1+4*n),this.eps=4/(r*r*i*(1+4*n))},n.prototype.computeB=function(e,t,o){var n=this.computeGW(),i=this.computeGq(),r=this.computeGiMf();return-i*e-n*t-r*o},n.prototype.computeGq=function(){var e=this.jacobianElementA,t=this.jacobianElementB,o=this.bi,n=this.bj,i=o.position,r=n.position;return e.spatial.dot(i)+t.spatial.dot(r)};var a=new r;n.prototype.computeGW=function(){var e=this.jacobianElementA,t=this.jacobianElementB,o=this.bi,n=this.bj,i=o.velocity,r=n.velocity,s=o.angularVelocity||a,l=n.angularVelocity||a;return e.multiplyVectors(i,s)+t.multiplyVectors(r,l)},n.prototype.computeGWlambda=function(){var e=this.jacobianElementA,t=this.jacobianElementB,o=this.bi,n=this.bj,i=o.vlambda,r=n.vlambda,s=o.wlambda||a,l=n.wlambda||a;return e.multiplyVectors(i,s)+t.multiplyVectors(r,l)};var s=new r,l=new r,u=new r,c=new r;n.prototype.computeGiMf=function(){var e=this.jacobianElementA,t=this.jacobianElementB,o=this.bi,n=this.bj,i=o.force,r=o.torque,a=n.force,d=n.torque,h=o.invMassSolve,p=n.invMassSolve;return o.invInertiaWorldSolve?o.invInertiaWorldSolve.vmult(r,u):u.set(0,0,0),n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(d,c):c.set(0,0,0),i.mult(h,s),a.mult(p,l),e.multiplyVectors(s,u)+t.multiplyVectors(l,c)};var d=new r;n.prototype.computeGiMGt=function(){var e=this.jacobianElementA,t=this.jacobianElementB,o=this.bi,n=this.bj,i=o.invMassSolve,r=n.invMassSolve,a=o.invInertiaWorldSolve,s=n.invInertiaWorldSolve,l=i+r;return a&&(a.vmult(e.rotational,d),l+=d.dot(e.rotational)),s&&(s.vmult(t.rotational,d),l+=d.dot(t.rotational)),l};var h=new r;new r,new r,new r,new r,new r;n.prototype.addToWlambda=function(e){var t=this.jacobianElementA,o=this.jacobianElementB,n=this.bi,i=this.bj,r=h;t.spatial.mult(n.invMassSolve*e,r),n.vlambda.vadd(r,n.vlambda),o.spatial.mult(i.invMassSolve*e,r),i.vlambda.vadd(r,i.vlambda),n.invInertiaWorldSolve&&(n.invInertiaWorldSolve.vmult(t.rotational,r),r.mult(e,r),n.wlambda.vadd(r,n.wlambda)),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(o.rotational,r),r.mult(e,r),i.wlambda.vadd(r,i.wlambda))},n.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},function(e,t,o){function n(){this.spatial=new i,this.rotational=new i}e.exports=n;var i=o(416);n.prototype.multiplyElement=function(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)},n.prototype.multiplyVectors=function(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}},function(e,t,o){function n(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new d,this.world=e,this.currentContactMaterial=null,this.enableFrictionReduction=!1}function i(e,t,o){for(var n=null,i=e.length,r=0;r!==i;r++){var a=e[r],s=D;e[(r+1)%i].vsub(a,s);var l=O;s.cross(t,l);var u=W;o.vsub(a,u);var c=l.dot(u);if(!(null===n||c>0&&n===!0||0>=c&&n===!1))return!1;null===n&&(n=c>0)}return!0}e.exports=n;var r=o(415),a=o(422),s=o(435),l=o(416),u=o(427),c=(o(426),o(423)),d=(o(437),o(438)),h=o(431),p=o(440);n.prototype.createContactEquation=function(e,t,o,n,i,r){var a;this.contactPointPool.length?(a=this.contactPointPool.pop(),a.bi=e,a.bj=t):a=new h(e,t),a.enabled=e.collisionResponse&&t.collisionResponse&&o.collisionResponse&&n.collisionResponse;var s=this.currentContactMaterial;a.restitution=s.restitution,a.setSpookParams(s.contactEquationStiffness,s.contactEquationRelaxation,this.world.dt);var l=o.material||e.material,u=n.material||t.material;return l&&u&&l.restitution>=0&&u.restitution>=0&&(a.restitution=l.restitution*u.restitution),a.si=i||o,a.sj=r||n,a},n.prototype.createFrictionEquationsFromContact=function(e,t){var o=e.bi,n=e.bj,i=e.si,r=e.sj,a=this.world,s=this.currentContactMaterial,l=s.friction,u=i.material||o.material,c=r.material||n.material;if(u&&c&&u.friction>=0&&c.friction>=0&&(l=u.friction*c.friction),l>0){var d=l*a.gravity.length(),h=o.invMass+n.invMass;h>0&&(h=1/h);var f=this.frictionEquationPool,m=f.length?f.pop():new p(o,n,d*h),v=f.length?f.pop():new p(o,n,d*h);return m.bi=v.bi=o,m.bj=v.bj=n,m.minForce=v.minForce=-d*h,m.maxForce=v.maxForce=d*h,m.ri.copy(e.ri),m.rj.copy(e.rj),v.ri.copy(e.ri),v.rj.copy(e.rj),e.ni.tangents(m.t,v.t),m.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),v.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),m.enabled=v.enabled=e.enabled,t.push(m,v),!0}return!1};var f=new l,m=new l,v=new l;n.prototype.createFrictionFromAverage=function(e){var t=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(t,this.frictionResult)&&1!==e){var o=this.frictionResult[this.frictionResult.length-2],n=this.frictionResult[this.frictionResult.length-1];f.setZero(),m.setZero(),v.setZero();for(var i=t.bi,r=(t.bj,0);r!==e;r++)t=this.result[this.result.length-1-r],t.bodyA!==i?(f.vadd(t.ni,f),m.vadd(t.ri,m),v.vadd(t.rj,v)):(f.vsub(t.ni,f),m.vadd(t.rj,m),v.vadd(t.ri,v));var a=1/e;m.scale(a,o.ri),v.scale(a,o.rj),n.ri.copy(o.ri),n.rj.copy(o.rj),f.normalize(),f.tangents(o.t,n.t)}};var y=new l,g=new l,w=new c,b=new c;n.prototype.getContacts=function(e,t,o,n,i,r,a){this.contactPointPool=i,this.frictionEquationPool=a,this.result=n,this.frictionResult=r;for(var s=w,l=b,u=y,c=g,d=0,h=e.length;d!==h;d++){var p=e[d],f=t[d],m=null;p.material&&f.material&&(m=o.getContactMaterial(p.material,f.material)||null);for(var v=0;v<p.shapes.length;v++){p.quaternion.mult(p.shapeOrientations[v],s),p.quaternion.vmult(p.shapeOffsets[v],u),u.vadd(p.position,u);for(var x=p.shapes[v],E=0;E<f.shapes.length;E++){f.quaternion.mult(f.shapeOrientations[E],l),f.quaternion.vmult(f.shapeOffsets[E],c),c.vadd(f.position,c);var M=f.shapes[E];if(!(u.distanceTo(c)>x.boundingSphereRadius+M.boundingSphereRadius)){var C=null;x.material&&M.material&&(C=o.getContactMaterial(x.material,M.material)||null),this.currentContactMaterial=C||m||o.defaultContactMaterial;var _=this[x.type|M.type];_&&(x.type<M.type?_.call(this,x,M,u,c,s,l,p,f,x,M):_.call(this,M,x,c,u,l,s,f,p,x,M))}}}}};n.prototype[a.types.BOX|a.types.BOX]=n.prototype.boxBox=function(e,t,o,n,i,r,a,s){e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,o,n,i,r,a,s,e,t)},n.prototype[a.types.BOX|a.types.CONVEXPOLYHEDRON]=n.prototype.boxConvex=function(e,t,o,n,i,r,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,o,n,i,r,a,s,e,t)},n.prototype[a.types.BOX|a.types.PARTICLE]=n.prototype.boxParticle=function(e,t,o,n,i,r,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,o,n,i,r,a,s,e,t)},n.prototype[a.types.SPHERE]=n.prototype.sphereSphere=function(e,t,o,n,i,r,a,s){var l=this.createContactEquation(a,s,e,t);n.vsub(o,l.ni),l.ni.normalize(),l.ri.copy(l.ni),l.rj.copy(l.ni),l.ri.mult(e.radius,l.ri),l.rj.mult(-t.radius,l.rj),l.ri.vadd(o,l.ri),l.ri.vsub(a.position,l.ri),l.rj.vadd(n,l.rj),l.rj.vsub(s.position,l.rj),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)};var x=new l,E=new l,M=new l;n.prototype[a.types.PLANE|a.types.TRIMESH]=n.prototype.planeTrimesh=function(e,t,o,n,i,r,a,s){var c=new l,d=x;d.set(0,0,1),i.vmult(d,d);for(var h=0;h<t.vertices.length/3;h++){t.getVertex(h,c);var p=new l;p.copy(c),u.pointToWorldFrame(n,r,p,c);var f=E;c.vsub(o,f);var m=d.dot(f);if(0>=m){var v=this.createContactEquation(a,s,e,t);v.ni.copy(d);var y=M;d.scale(f.dot(d),y),c.vsub(y,y),v.ri.copy(y),v.ri.vsub(a.position,v.ri),v.rj.copy(c),v.rj.vsub(s.position,v.rj),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}};var C=new l,_=new l,S=(new l,new l),P=new l,R=new l,A=new l,B=new l,T=new l,I=new l,z=new l,F=new l,V=new l,q=new l,L=new r,k=[];n.prototype[a.types.SPHERE|a.types.TRIMESH]=n.prototype.sphereTrimesh=function(e,t,o,n,i,r,a,l){var c=R,d=A,h=B,p=T,f=I,m=z,v=L,y=P,g=_,w=k;u.pointToLocalFrame(n,r,o,f);var b=e.radius;v.lowerBound.set(f.x-b,f.y-b,f.z-b),v.upperBound.set(f.x+b,f.y+b,f.z+b),t.getTrianglesInAABB(v,w);for(var x=S,E=e.radius*e.radius,M=0;M<w.length;M++)for(var N=0;3>N;N++)if(t.getVertex(t.indices[3*w[M]+N],x),x.vsub(f,g),g.norm2()<=E){y.copy(x),u.pointToWorldFrame(n,r,y,x),x.vsub(o,g);var j=this.createContactEquation(a,l,e,t);j.ni.copy(g),j.ni.normalize(),j.ri.copy(j.ni),j.ri.scale(e.radius,j.ri),j.ri.vadd(o,j.ri),j.ri.vsub(a.position,j.ri),j.rj.copy(x),j.rj.vsub(l.position,j.rj),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}for(var M=0;M<w.length;M++)for(var N=0;3>N;N++){t.getVertex(t.indices[3*w[M]+N],c),t.getVertex(t.indices[3*w[M]+(N+1)%3],d),d.vsub(c,h),f.vsub(d,m);var D=m.dot(h);f.vsub(c,m);var O=m.dot(h);if(O>0&&0>D){f.vsub(c,m),p.copy(h),p.normalize(),O=m.dot(p),p.scale(O,m),m.vadd(c,m);var W=m.distanceTo(f);if(W<e.radius){var j=this.createContactEquation(a,l,e,t);m.vsub(f,j.ni),j.ni.normalize(),j.ni.scale(e.radius,j.ri),u.pointToWorldFrame(n,r,m,m),m.vsub(l.position,j.rj),u.vectorToWorldFrame(r,j.ni,j.ni),u.vectorToWorldFrame(r,j.ri,j.ri),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}}}for(var U=F,X=V,G=q,H=C,M=0,Y=w.length;M!==Y;M++){t.getTriangleVertices(w[M],U,X,G),t.getNormal(w[M],H),f.vsub(U,m);var W=m.dot(H);if(H.scale(W,m),f.vsub(m,m),W=m.distanceTo(f),s.pointInTriangle(m,U,X,G)&&W<e.radius){var j=this.createContactEquation(a,l,e,t);m.vsub(f,j.ni),j.ni.normalize(),j.ni.scale(e.radius,j.ri),u.pointToWorldFrame(n,r,m,m),m.vsub(l.position,j.rj),u.vectorToWorldFrame(r,j.ni,j.ni),u.vectorToWorldFrame(r,j.ri,j.ri),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}}w.length=0};var N=new l,j=new l;n.prototype[a.types.SPHERE|a.types.PLANE]=n.prototype.spherePlane=function(e,t,o,n,i,r,a,s){var l=this.createContactEquation(a,s,e,t);if(l.ni.set(0,0,1),r.vmult(l.ni,l.ni),l.ni.negate(l.ni),l.ni.normalize(),l.ni.mult(e.radius,l.ri),o.vsub(n,N),l.ni.mult(l.ni.dot(N),j),N.vsub(j,l.rj),-N.dot(l.ni)<=e.radius){var u=l.ri,c=l.rj;u.vadd(o,u),u.vsub(a.position,u),c.vadd(n,c),c.vsub(s.position,c),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}};var D=new l,O=new l,W=new l,U=new l,X=new l,G=new l,H=new l,Y=[new l,new l,new l,new l,new l,new l],Z=new l,Q=new l,K=new l,J=new l;n.prototype[a.types.SPHERE|a.types.BOX]=n.prototype.sphereBox=function(e,t,o,n,i,r,a,s){var l=this.v3pool,u=Y;o.vsub(n,U),t.getSideNormals(u,r);for(var c=e.radius,d=!1,h=Q,p=K,f=J,m=null,v=0,y=0,g=0,w=null,b=0,x=u.length;b!==x&&d===!1;b++){var E=X;E.copy(u[b]);var M=E.norm();E.normalize();var C=U.dot(E);if(M+c>C&&C>0){var _=G,S=H;_.copy(u[(b+1)%3]),S.copy(u[(b+2)%3]);var P=_.norm(),R=S.norm();_.normalize(),S.normalize();var A=U.dot(_),B=U.dot(S);if(P>A&&A>-P&&R>B&&B>-R){var T=Math.abs(C-M-c);(null===w||w>T)&&(w=T,y=A,g=B,m=M,h.copy(E),p.copy(_),f.copy(S),v++)}}}if(v){d=!0;var I=this.createContactEquation(a,s,e,t);h.mult(-c,I.ri),I.ni.copy(h),I.ni.negate(I.ni),h.mult(m,h),p.mult(y,p),h.vadd(p,h),f.mult(g,f),h.vadd(f,I.rj),I.ri.vadd(o,I.ri),I.ri.vsub(a.position,I.ri),I.rj.vadd(n,I.rj),I.rj.vsub(s.position,I.rj),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult)}for(var z=l.get(),F=Z,V=0;2!==V&&!d;V++)for(var q=0;2!==q&&!d;q++)for(var L=0;2!==L&&!d;L++)if(z.set(0,0,0),V?z.vadd(u[0],z):z.vsub(u[0],z),q?z.vadd(u[1],z):z.vsub(u[1],z),L?z.vadd(u[2],z):z.vsub(u[2],z),n.vadd(z,F),F.vsub(o,F),F.norm2()<c*c){d=!0;var I=this.createContactEquation(a,s,e,t);I.ri.copy(F),I.ri.normalize(),I.ni.copy(I.ri),I.ri.mult(c,I.ri),I.rj.copy(z),I.ri.vadd(o,I.ri),I.ri.vsub(a.position,I.ri),I.rj.vadd(n,I.rj),I.rj.vsub(s.position,I.rj),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult)}l.release(z),z=null;for(var k=l.get(),N=l.get(),I=l.get(),j=l.get(),T=l.get(),D=u.length,V=0;V!==D&&!d;V++)for(var q=0;q!==D&&!d;q++)if(V%3!==q%3){u[q].cross(u[V],k),k.normalize(),u[V].vadd(u[q],N),I.copy(o),I.vsub(N,I),I.vsub(n,I);var O=I.dot(k);k.mult(O,j);for(var L=0;L===V%3||L===q%3;)L++;T.copy(o),T.vsub(j,T),T.vsub(N,T),T.vsub(n,T);var W=Math.abs(O),$=T.norm();if(W<u[L].norm()&&c>$){d=!0;var ee=this.createContactEquation(a,s,e,t);N.vadd(j,ee.rj),ee.rj.copy(ee.rj),T.negate(ee.ni),ee.ni.normalize(),ee.ri.copy(ee.rj),ee.ri.vadd(n,ee.ri),ee.ri.vsub(o,ee.ri),ee.ri.normalize(),ee.ri.mult(c,ee.ri),ee.ri.vadd(o,ee.ri),ee.ri.vsub(a.position,ee.ri),ee.rj.vadd(n,ee.rj),ee.rj.vsub(s.position,ee.rj),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult)}}l.release(k,N,I,j,T)};var $=new l,ee=new l,te=new l,oe=new l,ne=new l,ie=new l,re=new l,ae=new l,se=new l,le=new l;n.prototype[a.types.SPHERE|a.types.CONVEXPOLYHEDRON]=n.prototype.sphereConvex=function(e,t,o,n,r,a,s,l){var u=this.v3pool;o.vsub(n,$);for(var c=t.faceNormals,d=t.faces,h=t.vertices,p=e.radius,f=0;f!==h.length;f++){var m=h[f],v=ne;a.vmult(m,v),n.vadd(v,v);var y=oe;if(v.vsub(o,y),y.norm2()<p*p){w=!0;var g=this.createContactEquation(s,l,e,t);return g.ri.copy(y),g.ri.normalize(),g.ni.copy(g.ri),g.ri.mult(p,g.ri),v.vsub(n,g.rj),g.ri.vadd(o,g.ri),g.ri.vsub(s.position,g.ri),g.rj.vadd(n,g.rj),g.rj.vsub(l.position,g.rj),this.result.push(g),void this.createFrictionEquationsFromContact(g,this.frictionResult)}}for(var w=!1,f=0,b=d.length;f!==b&&w===!1;f++){var x=c[f],E=d[f],M=ie;a.vmult(x,M);var C=re;a.vmult(h[E[0]],C),C.vadd(n,C);var _=ae;M.mult(-p,_),o.vadd(_,_);var S=se;_.vsub(C,S);var P=S.dot(M),R=le;if(o.vsub(C,R),0>P&&R.dot(M)>0){for(var A=[],B=0,T=E.length;B!==T;B++){var I=u.get();a.vmult(h[E[B]],I),n.vadd(I,I),A.push(I)}if(i(A,M,o)){w=!0;var g=this.createContactEquation(s,l,e,t);M.mult(-p,g.ri),M.negate(g.ni);var z=u.get();M.mult(-P,z);var F=u.get();M.mult(-p,F),o.vsub(n,g.rj),g.rj.vadd(F,g.rj),g.rj.vadd(z,g.rj),g.rj.vadd(n,g.rj),g.rj.vsub(l.position,g.rj),g.ri.vadd(o,g.ri),g.ri.vsub(s.position,g.ri),u.release(z),u.release(F),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult);for(var B=0,V=A.length;B!==V;B++)u.release(A[B]);return}for(var B=0;B!==E.length;B++){var q=u.get(),L=u.get();a.vmult(h[E[(B+1)%E.length]],q),a.vmult(h[E[(B+2)%E.length]],L),n.vadd(q,q),n.vadd(L,L);var k=ee;L.vsub(q,k);var N=te;k.unit(N);var j=u.get(),D=u.get();o.vsub(q,D);var O=D.dot(N);N.mult(O,j),j.vadd(q,j);var W=u.get();if(j.vsub(o,W),O>0&&O*O<k.norm2()&&W.norm2()<p*p){var g=this.createContactEquation(s,l,e,t);j.vsub(n,g.rj),j.vsub(o,g.ni),g.ni.normalize(),g.ni.mult(p,g.ri),g.rj.vadd(n,g.rj),g.rj.vsub(l.position,g.rj),g.ri.vadd(o,g.ri),g.ri.vsub(s.position,g.ri),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult);for(var B=0,V=A.length;B!==V;B++)u.release(A[B]);return u.release(q),u.release(L),u.release(j),u.release(W),void u.release(D)}u.release(q),u.release(L),u.release(j),u.release(W),u.release(D)}for(var B=0,V=A.length;B!==V;B++)u.release(A[B])}}};new l,new l;n.prototype[a.types.PLANE|a.types.BOX]=n.prototype.planeBox=function(e,t,o,n,i,r,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.planeConvex(e,t.convexPolyhedronRepresentation,o,n,i,r,a,s)};var ue=new l,ce=new l,de=new l,he=new l;n.prototype[a.types.PLANE|a.types.CONVEXPOLYHEDRON]=n.prototype.planeConvex=function(e,t,o,n,i,r,a,s){var l=ue,u=ce;u.set(0,0,1),i.vmult(u,u);for(var c=0,d=de,h=0;h!==t.vertices.length;h++){l.copy(t.vertices[h]),r.vmult(l,l),n.vadd(l,l),l.vsub(o,d);var p=u.dot(d);if(0>=p){var f=this.createContactEquation(a,s,e,t),m=he;u.mult(u.dot(d),m),l.vsub(m,m),m.vsub(o,f.ri),f.ni.copy(u),l.vsub(n,f.rj),f.ri.vadd(o,f.ri),f.ri.vsub(a.position,f.ri),f.rj.vadd(n,f.rj),f.rj.vsub(s.position,f.rj),this.result.push(f),c++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(f,this.frictionResult)}}this.enableFrictionReduction&&c&&this.createFrictionFromAverage(c)};var pe=new l,fe=new l;n.prototype[a.types.CONVEXPOLYHEDRON]=n.prototype.convexConvex=function(e,t,o,n,i,r,a,s,l,u,c,d){var h=pe;if(!(o.distanceTo(n)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,o,i,n,r,h,c,d)){var p=[],f=fe;e.clipAgainstHull(o,i,t,n,r,h,-100,100,p);for(var m=0,v=0;v!==p.length;v++){var y=this.createContactEquation(a,s,e,t,l,u),g=y.ri,w=y.rj;h.negate(y.ni),p[v].normal.negate(f),f.mult(p[v].depth,f),p[v].point.vadd(f,g),w.copy(p[v].point),g.vsub(o,g),w.vsub(n,w),g.vadd(o,g),g.vsub(a.position,g),w.vadd(n,w),w.vsub(s.position,w),this.result.push(y),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(y,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}};var me=new l,ve=new l,ye=new l;n.prototype[a.types.PLANE|a.types.PARTICLE]=n.prototype.planeParticle=function(e,t,o,n,i,r,a,s){var l=me;l.set(0,0,1),a.quaternion.vmult(l,l);var u=ve;n.vsub(a.position,u);var c=l.dot(u);if(0>=c){var d=this.createContactEquation(s,a,t,e);d.ni.copy(l),d.ni.negate(d.ni),d.ri.set(0,0,0);var h=ye;l.mult(l.dot(n),h),n.vsub(h,h),d.rj.copy(h),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}};var ge=new l;n.prototype[a.types.PARTICLE|a.types.SPHERE]=n.prototype.sphereParticle=function(e,t,o,n,i,r,a,s){var l=ge;l.set(0,0,1),n.vsub(o,l);var u=l.norm2();if(u<=e.radius*e.radius){var c=this.createContactEquation(s,a,t,e);l.normalize(),c.rj.copy(l),c.rj.mult(e.radius,c.rj),c.ni.copy(l),c.ni.negate(c.ni),c.ri.set(0,0,0),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}};var we=new c,be=new l,xe=(new l,new l),Ee=new l,Me=new l;n.prototype[a.types.PARTICLE|a.types.CONVEXPOLYHEDRON]=n.prototype.convexParticle=function(e,t,o,n,i,r,a,s){var l=-1,u=xe,c=Me,d=null,h=0,p=be;if(p.copy(n),p.vsub(o,p),i.conjugate(we),we.vmult(p,p),e.pointIsInside(p)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(o,i),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(i);for(var f=0,m=e.faces.length;f!==m;f++){var v=[e.worldVertices[e.faces[f][0]]],y=e.worldFaceNormals[f];n.vsub(v[0],Ee);var g=-y.dot(Ee);(null===d||Math.abs(g)<Math.abs(d))&&(d=g,l=f,u.copy(y),h++)}if(-1!==l){var w=this.createContactEquation(s,a,t,e);u.mult(d,c),c.vadd(n,c),c.vsub(o,c),w.rj.copy(c),u.negate(w.ni),w.ri.set(0,0,0);var b=w.ri,x=w.rj;b.vadd(n,b),b.vsub(s.position,b),x.vadd(o,x),x.vsub(a.position,x),this.result.push(w),this.createFrictionEquationsFromContact(w,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},n.prototype[a.types.BOX|a.types.HEIGHTFIELD]=n.prototype.boxHeightfield=function(e,t,o,n,i,r,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,o,n,i,r,a,s)};var Ce=new l,_e=new l,Se=[0];n.prototype[a.types.CONVEXPOLYHEDRON|a.types.HEIGHTFIELD]=n.prototype.convexHeightfield=function(e,t,o,n,i,r,a,s){var l=t.data,c=t.elementSize,d=e.boundingSphereRadius,h=_e,p=Se,f=Ce;u.pointToLocalFrame(n,r,o,f);var m=Math.floor((f.x-d)/c)-1,v=Math.ceil((f.x+d)/c)+1,y=Math.floor((f.y-d)/c)-1,g=Math.ceil((f.y+d)/c)+1;if(!(0>v||0>g||m>l.length||y>l[0].length)){0>m&&(m=0),0>v&&(v=0),0>y&&(y=0),0>g&&(g=0),m>=l.length&&(m=l.length-1),v>=l.length&&(v=l.length-1),g>=l[0].length&&(g=l[0].length-1),y>=l[0].length&&(y=l[0].length-1);var w=[];t.getRectMinMax(m,y,v,g,w);var b=w[0],x=w[1];if(!(f.z-d>x||f.z+d<b))for(var E=m;v>E;E++)for(var M=y;g>M;M++)t.getConvexTrianglePillar(E,M,!1),u.pointToWorldFrame(n,r,t.pillarOffset,h),o.distanceTo(h)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.convexConvex(e,t.pillarConvex,o,h,i,r,a,s,null,null,p,null),t.getConvexTrianglePillar(E,M,!0),u.pointToWorldFrame(n,r,t.pillarOffset,h),o.distanceTo(h)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.convexConvex(e,t.pillarConvex,o,h,i,r,a,s,null,null,p,null)}};var Pe=new l,Re=new l;n.prototype[a.types.SPHERE|a.types.HEIGHTFIELD]=n.prototype.sphereHeightfield=function(e,t,o,n,i,r,a,s){var l=t.data,c=e.radius,d=t.elementSize,h=Re,p=Pe;u.pointToLocalFrame(n,r,o,p);var f=Math.floor((p.x-c)/d)-1,m=Math.ceil((p.x+c)/d)+1,v=Math.floor((p.y-c)/d)-1,y=Math.ceil((p.y+c)/d)+1;if(!(0>m||0>y||f>l.length||y>l[0].length)){0>f&&(f=0),0>m&&(m=0),0>v&&(v=0),0>y&&(y=0),f>=l.length&&(f=l.length-1),m>=l.length&&(m=l.length-1),y>=l[0].length&&(y=l[0].length-1),v>=l[0].length&&(v=l[0].length-1);var g=[];t.getRectMinMax(f,v,m,y,g);var w=g[0],b=g[1];if(!(p.z-c>b||p.z+c<w))for(var x=this.result,E=f;m>E;E++)for(var M=v;y>M;M++){var C=x.length;t.getConvexTrianglePillar(E,M,!1),u.pointToWorldFrame(n,r,t.pillarOffset,h),o.distanceTo(h)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.sphereConvex(e,t.pillarConvex,o,h,i,r,a,s),t.getConvexTrianglePillar(E,M,!0),u.pointToWorldFrame(n,r,t.pillarOffset,h),o.distanceTo(h)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.sphereConvex(e,t.pillarConvex,o,h,i,r,a,s);var _=x.length-C;if(_>2)return}}}},function(e,t,o){function n(e,t){this.from=e?e.clone():new a,this.to=t?t.clone():new a,this._direction=new a,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=n.ANY,this.result=new u,this.hasHit=!1,this.callback=function(e){}}function i(e,t,o,n){n.vsub(t,V),o.vsub(t,f),e.vsub(t,m);var i,r,a=V.dot(V),s=V.dot(f),l=V.dot(m),u=f.dot(f),c=f.dot(m);return(i=u*l-s*c)>=0&&(r=a*c-s*l)>=0&&a*u-s*s>i+r}function r(e,t,o){o.vsub(e,V);var n=V.dot(t);t.mult(n,q),q.vadd(e,q);var i=o.distanceTo(q);return i}e.exports=n;var a=o(416),s=o(423),l=o(427),u=(o(426),o(425),o(436)),c=o(422),d=o(415);n.prototype.constructor=n,n.CLOSEST=1,n.ANY=2,n.ALL=4;var h=new d,p=[];n.prototype.intersectWorld=function(e,t){return this.mode=t.mode||n.ANY,this.result=t.result||new u,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask="undefined"!=typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup="undefined"!=typeof t.collisionFilterGroup?t.collisionFilterGroup:-1,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(h),p.length=0,e.broadphase.aabbQuery(e,h,p),this.intersectBodies(p),this.hasHit};var f=new a,m=new a;n.pointInTriangle=i;var v=new a,y=new s;n.prototype.intersectBody=function(e,t){t&&(this.result=t,this._updateDirection());var o=this.checkCollisionResponse;if((!o||e.collisionResponse)&&0!==(this.collisionFilterGroup&e.collisionFilterMask)&&0!==(e.collisionFilterGroup&this.collisionFilterMask))for(var n=v,i=y,r=0,a=e.shapes.length;a>r;r++){var s=e.shapes[r];if((!o||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[r],i),e.quaternion.vmult(e.shapeOffsets[r],n),n.vadd(e.position,n),this.intersectShape(s,i,n,e),this.result._shouldStop))break}},n.prototype.intersectBodies=function(e,t){t&&(this.result=t,this._updateDirection());for(var o=0,n=e.length;!this.result._shouldStop&&n>o;o++)this.intersectBody(e[o])},n.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},n.prototype.intersectShape=function(e,t,o,n){var i=this.from,a=r(i,this._direction,o);if(!(a>e.boundingSphereRadius)){var s=this[e.type];s&&s.call(this,e,t,o,n)}};var g=(new a,new a,new a),w=new a,b=new a,x=new a;new a,new u;n.prototype.intersectBox=function(e,t,o,n){return this.intersectConvex(e.convexPolyhedronRepresentation,t,o,n)},n.prototype[c.types.BOX]=n.prototype.intersectBox,n.prototype.intersectPlane=function(e,t,o,n){var i=this.from,r=this.to,s=this._direction,l=new a(0,0,1);t.vmult(l,l);var u=new a;i.vsub(o,u);var c=u.dot(l);r.vsub(o,u);var d=u.dot(l);if(!(c*d>0||i.distanceTo(r)<c)){var h=l.dot(s);if(!(Math.abs(h)<this.precision)){var p=new a,f=new a,m=new a;i.vsub(o,p);var v=-l.dot(p)/h;s.scale(v,f),i.vadd(f,m),this.reportIntersection(l,m,e,n,-1)}}},n.prototype[c.types.PLANE]=n.prototype.intersectPlane,n.prototype.getAABB=function(e){var t=this.to,o=this.from;e.lowerBound.x=Math.min(t.x,o.x),e.lowerBound.y=Math.min(t.y,o.y),e.lowerBound.z=Math.min(t.z,o.z),e.upperBound.x=Math.max(t.x,o.x),e.upperBound.y=Math.max(t.y,o.y),e.upperBound.z=Math.max(t.z,o.z)};var E={faceList:[0]};n.prototype.intersectHeightfield=function(e,t,o,i){var r=(e.data,e.elementSize,new a),s=new n(this.from,this.to);l.pointToLocalFrame(o,t,s.from,s.from),l.pointToLocalFrame(o,t,s.to,s.to);var u=[],c=null,d=null,h=null,p=null,f=e.getIndexOfPosition(s.from.x,s.from.y,u,!1);if(f&&(c=u[0],d=u[1],h=u[0],p=u[1]),f=e.getIndexOfPosition(s.to.x,s.to.y,u,!1),f&&((null===c||u[0]<c)&&(c=u[0]),(null===h||u[0]>h)&&(h=u[0]),(null===d||u[1]<d)&&(d=u[1]),(null===p||u[1]>p)&&(p=u[1])),null!==c){var m=[];e.getRectMinMax(c,d,h,p,m);for(var v=(m[0],m[1],c);h>=v;v++)for(var y=d;p>=y;y++){if(this.result._shouldStop)return;if(e.getConvexTrianglePillar(v,y,!1),l.pointToWorldFrame(o,t,e.pillarOffset,r),this.intersectConvex(e.pillarConvex,t,r,i,E),this.result._shouldStop)return;e.getConvexTrianglePillar(v,y,!0),l.pointToWorldFrame(o,t,e.pillarOffset,r),this.intersectConvex(e.pillarConvex,t,r,i,E)}}},n.prototype[c.types.HEIGHTFIELD]=n.prototype.intersectHeightfield;var M=new a,C=new a;n.prototype.intersectSphere=function(e,t,o,n){var i=this.from,r=this.to,a=e.radius,s=Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2)+Math.pow(r.z-i.z,2),l=2*((r.x-i.x)*(i.x-o.x)+(r.y-i.y)*(i.y-o.y)+(r.z-i.z)*(i.z-o.z)),u=Math.pow(i.x-o.x,2)+Math.pow(i.y-o.y,2)+Math.pow(i.z-o.z,2)-Math.pow(a,2),c=Math.pow(l,2)-4*s*u,d=M,h=C;if(!(0>c))if(0===c)i.lerp(r,c,d),d.vsub(o,h),h.normalize(),this.reportIntersection(h,d,e,n,-1);else{var p=(-l-Math.sqrt(c))/(2*s),f=(-l+Math.sqrt(c))/(2*s);if(p>=0&&1>=p&&(i.lerp(r,p,d),d.vsub(o,h),h.normalize(),this.reportIntersection(h,d,e,n,-1)),this.result._shouldStop)return;f>=0&&1>=f&&(i.lerp(r,f,d),d.vsub(o,h),h.normalize(),this.reportIntersection(h,d,e,n,-1))}},n.prototype[c.types.SPHERE]=n.prototype.intersectSphere;var _=new a,S=(new a,new a,new a);n.prototype.intersectConvex=function(e,t,o,n,r){for(var a=_,s=S,l=r&&r.faceList||null,u=e.faces,c=e.vertices,d=e.faceNormals,h=this._direction,p=this.from,f=this.to,m=p.distanceTo(f),v=l?l.length:u.length,y=this.result,E=0;!y._shouldStop&&v>E;E++){var M=l?l[E]:E,C=u[M],P=d[M],R=t,A=o;s.copy(c[C[0]]),R.vmult(s,s),s.vadd(A,s),s.vsub(p,s),R.vmult(P,a);var B=h.dot(a);if(!(Math.abs(B)<this.precision)){var T=a.dot(s)/B;if(!(0>T)){h.mult(T,g),g.vadd(p,g),w.copy(c[C[0]]),R.vmult(w,w),A.vadd(w,w);for(var I=1;!y._shouldStop&&I<C.length-1;I++){b.copy(c[C[I]]),x.copy(c[C[I+1]]),R.vmult(b,b),R.vmult(x,x),A.vadd(b,b),A.vadd(x,x);var z=g.distanceTo(p);!i(g,w,b,x)&&!i(g,b,w,x)||z>m||this.reportIntersection(a,g,e,n,M)}}}}},n.prototype[c.types.CONVEXPOLYHEDRON]=n.prototype.intersectConvex;var P=new a,R=new a,A=new a,B=new a,T=new a,I=new a,z=(new d,[]),F=new l;n.prototype.intersectTrimesh=function(e,t,o,n,r){var a=P,s=z,u=F,c=S,d=R,h=A,p=B,f=I,m=T,v=(r&&r.faceList||null,e.indices),y=(e.vertices,e.faceNormals,this.from),E=this.to,M=this._direction;u.position.copy(o),u.quaternion.copy(t),l.vectorToLocalFrame(o,t,M,d),l.pointToLocalFrame(o,t,y,h),l.pointToLocalFrame(o,t,E,p);var C=h.distanceSquared(p);e.tree.rayQuery(this,u,s);for(var _=0,V=s.length;!this.result._shouldStop&&_!==V;_++){var q=s[_];e.getNormal(q,a),e.getVertex(v[3*q],w),w.vsub(h,c);var L=d.dot(a),k=a.dot(c)/L;if(!(0>k)){d.scale(k,g),g.vadd(h,g),e.getVertex(v[3*q+1],b),e.getVertex(v[3*q+2],x);var N=g.distanceSquared(h);!i(g,b,w,x)&&!i(g,w,b,x)||N>C||(l.vectorToWorldFrame(t,a,m),l.pointToWorldFrame(o,t,g,f),this.reportIntersection(m,f,e,n,q))}}s.length=0},n.prototype[c.types.TRIMESH]=n.prototype.intersectTrimesh,n.prototype.reportIntersection=function(e,t,o,i,r){var a=this.from,s=this.to,l=a.distanceTo(t),u=this.result;if(!(this.skipBackfaces&&e.dot(this._direction)>0))switch(u.hitFaceIndex="undefined"!=typeof r?r:-1,this.mode){case n.ALL:this.hasHit=!0,u.set(a,s,e,t,o,i,l),u.hasHit=!0,this.callback(u);break;case n.CLOSEST:(l<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(a,s,e,t,o,i,l));break;case n.ANY:this.hasHit=!0,u.hasHit=!0,u.set(a,s,e,t,o,i,l),u._shouldStop=!0}};var V=new a,q=new a},function(e,t,o){function n(){this.rayFromWorld=new i,this.rayToWorld=new i,this.hitNormalWorld=new i,this.hitPointWorld=new i,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}var i=o(416);e.exports=n,n.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},n.prototype.abort=function(){this._shouldStop=!0},n.prototype.set=function(e,t,o,n,i,r,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(o),this.hitPointWorld.copy(n),this.shape=i,this.body=r,this.distance=a}},function(e,t){function o(){this.equations=[]}e.exports=o,o.prototype.solve=function(e,t){return 0},o.prototype.addEquation=function(e){e.enabled&&this.equations.push(e)},o.prototype.removeEquation=function(e){var t=this.equations,o=t.indexOf(e);-1!==o&&t.splice(o,1)},o.prototype.removeAllEquations=function(){this.equations.length=0}},function(e,t,o){function n(){r.call(this),this.type=i}e.exports=n;var i=o(416),r=o(439);n.prototype=new r,n.prototype.constructObject=function(){return new i}},function(e,t){function o(){this.objects=[],this.type=Object}e.exports=o,o.prototype.release=function(){for(var e=arguments.length,t=0;t!==e;t++)this.objects.push(arguments[t])},o.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},o.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},function(e,t,o){function n(e,t,o){i.call(this,e,t,-o,o),this.ri=new r,this.rj=new r,this.t=new r;
}e.exports=n;var i=o(432),r=o(416);o(417);n.prototype=new i,n.prototype.constructor=n;var a=new r,s=new r;n.prototype.computeB=function(e){var t=(this.a,this.b),o=(this.bi,this.bj,this.ri),n=this.rj,i=a,r=s,l=this.t;o.cross(l,i),n.cross(l,r);var u=this.jacobianElementA,c=this.jacobianElementB;l.negate(u.spatial),i.negate(u.rotational),c.spatial.copy(l),c.rotational.copy(r);var d=this.computeGW(),h=this.computeGiMf(),p=-d*t-e*h;return p}},function(e,t,o){function n(e,t,o){o=o||{};var n="undefined"!=typeof o.maxForce?o.maxForce:1e6,l=o.pivotA?o.pivotA.clone():new s,u=o.pivotB?o.pivotB.clone():new s;this.axisA=o.axisA?o.axisA.clone():new s,this.axisB=o.axisB?o.axisB.clone():new s,i.call(this,e,l,t,u,n),this.collideConnected=!!o.collideConnected,this.angle="undefined"!=typeof o.angle?o.angle:0;var c=this.coneEquation=new r(e,t,o),d=this.twistEquation=new a(e,t,o);this.twistAngle="undefined"!=typeof o.twistAngle?o.twistAngle:0,c.maxForce=0,c.minForce=-n,d.maxForce=0,d.minForce=-n,this.equations.push(c,d)}e.exports=n;var i=(o(430),o(442)),r=o(443),a=o(444),s=(o(431),o(416));n.prototype=new i,n.constructor=n;new s,new s;n.prototype.update=function(){var e=this.bodyA,t=this.bodyB,o=this.coneEquation,n=this.twistEquation;i.prototype.update.call(this),e.vectorToWorldFrame(this.axisA,o.axisA),t.vectorToWorldFrame(this.axisB,o.axisB),this.axisA.tangents(n.axisA,n.axisA),e.vectorToWorldFrame(n.axisA,n.axisA),this.axisB.tangents(n.axisB,n.axisB),t.vectorToWorldFrame(n.axisB,n.axisB),o.angle=this.angle,n.maxAngle=this.twistAngle}},function(e,t,o){function n(e,t,o,n,s){i.call(this,e,o),s="undefined"!=typeof s?s:1e6,this.pivotA=t?t.clone():new a,this.pivotB=n?n.clone():new a;var l=this.equationX=new r(e,o),u=this.equationY=new r(e,o),c=this.equationZ=new r(e,o);this.equations.push(l,u,c),l.minForce=u.minForce=c.minForce=-s,l.maxForce=u.maxForce=c.maxForce=s,l.ni.set(1,0,0),u.ni.set(0,1,0),c.ni.set(0,0,1)}e.exports=n;var i=o(430),r=o(431),a=o(416);n.prototype=new i,n.prototype.update=function(){var e=this.bodyA,t=this.bodyB,o=this.equationX,n=this.equationY,i=this.equationZ;e.quaternion.vmult(this.pivotA,o.ri),t.quaternion.vmult(this.pivotB,o.rj),n.ri.copy(o.ri),n.rj.copy(o.rj),i.ri.copy(o.ri),i.rj.copy(o.rj)}},function(e,t,o){function n(e,t,o){o=o||{};var n="undefined"!=typeof o.maxForce?o.maxForce:1e6;r.call(this,e,t,-n,n),this.axisA=o.axisA?o.axisA.clone():new i(1,0,0),this.axisB=o.axisB?o.axisB.clone():new i(0,1,0),this.angle="undefined"!=typeof o.angle?o.angle:0}e.exports=n;var i=o(416),r=(o(417),o(432));n.prototype=new r,n.prototype.constructor=n;var a=new i,s=new i;n.prototype.computeB=function(e){var t=this.a,o=this.b,n=this.axisA,i=this.axisB,r=a,l=s,u=this.jacobianElementA,c=this.jacobianElementB;n.cross(i,r),i.cross(n,l),u.rotational.copy(l),c.rotational.copy(r);var d=Math.cos(this.angle)-n.dot(i),h=this.computeGW(),p=this.computeGiMf(),f=-d*t-h*o-e*p;return f}},function(e,t,o){function n(e,t,o){o=o||{};var n="undefined"!=typeof o.maxForce?o.maxForce:1e6;r.call(this,e,t,-n,n),this.axisA=o.axisA?o.axisA.clone():new i(1,0,0),this.axisB=o.axisB?o.axisB.clone():new i(0,1,0),this.maxAngle=Math.PI/2}e.exports=n;var i=o(416),r=(o(417),o(432));n.prototype=new r,n.prototype.constructor=n;var a=new i,s=new i;n.prototype.computeB=function(e){var t=this.a,o=this.b,n=this.axisA,i=this.axisB,r=a,l=s,u=this.jacobianElementA,c=this.jacobianElementB;n.cross(i,r),i.cross(n,l),u.rotational.copy(l),c.rotational.copy(r);var d=Math.cos(this.maxAngle)-n.dot(i),h=this.computeGW(),p=this.computeGiMf(),f=-d*t-h*o-e*p;return f}},function(e,t,o){function n(e,t,o){o=i.defaults(o,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=n.idCounter++,this.materials=[e,t],this.friction=o.friction,this.restitution=o.restitution,this.contactEquationStiffness=o.contactEquationStiffness,this.contactEquationRelaxation=o.contactEquationRelaxation,this.frictionEquationStiffness=o.frictionEquationStiffness,this.frictionEquationRelaxation=o.frictionEquationRelaxation}var i=o(418);e.exports=n,n.idCounter=0},function(e,t,o){function n(e,t,o,n){var s=n,l=[],u=[],c=[],d=[],h=[],p=Math.cos,f=Math.sin;l.push(new r(t*p(0),t*f(0),.5*-o)),d.push(0),l.push(new r(e*p(0),e*f(0),.5*o)),h.push(1);for(var m=0;s>m;m++){var v=2*Math.PI/s*(m+1),y=2*Math.PI/s*(m+.5);s-1>m?(l.push(new r(t*p(v),t*f(v),.5*-o)),d.push(2*m+2),l.push(new r(e*p(v),e*f(v),.5*o)),h.push(2*m+3),c.push([2*m+2,2*m+3,2*m+1,2*m])):c.push([0,1,2*m+1,2*m]),(s%2===1||s/2>m)&&u.push(new r(p(y),f(y),0))}c.push(h),u.push(new r(0,0,1));for(var g=[],m=0;m<d.length;m++)g.push(d[d.length-m-1]);c.push(g),this.type=i.types.CONVEXPOLYHEDRON,a.call(this,l,c,u)}e.exports=n;var i=o(422),r=o(416),a=(o(423),o(426));n.prototype=new a},function(e,t,o){function n(e,t,o,n){i.call(this,e,t),"undefined"==typeof o&&(o=e.position.distanceTo(t.position)),"undefined"==typeof n&&(n=1e6),this.distance=o;var a=this.distanceEquation=new r(e,t);this.equations.push(a),a.minForce=-n,a.maxForce=n}e.exports=n;var i=o(430),r=o(431);n.prototype=new i,n.prototype.update=function(){var e=this.bodyA,t=this.bodyB,o=this.distanceEquation,n=.5*this.distance,i=o.ni;t.position.vsub(e.position,i),i.normalize(),i.mult(n,o.ri),i.mult(-n,o.rj)}},function(e,t,o){function n(){i.call(this),this.iterations=10,this.tolerance=1e-7}e.exports=n;var i=(o(416),o(423),o(437));n.prototype=new i;var r=[],a=[],s=[];n.prototype.solve=function(e,t){var o,n,i,l,u,c,d=0,h=this.iterations,p=this.tolerance*this.tolerance,f=this.equations,m=f.length,v=t.bodies,y=v.length,g=e;if(0!==m)for(var w=0;w!==y;w++)v[w].updateSolveMassProperties();var b=a,x=s,E=r;b.length=m,x.length=m,E.length=m;for(var w=0;w!==m;w++){var M=f[w];E[w]=0,x[w]=M.computeB(g),b[w]=1/M.computeC()}if(0!==m){for(var w=0;w!==y;w++){var C=v[w],_=C.vlambda,S=C.wlambda;_.set(0,0,0),S&&S.set(0,0,0)}for(d=0;d!==h;d++){l=0;for(var P=0;P!==m;P++){var M=f[P];o=x[P],n=b[P],c=E[P],u=M.computeGWlambda(),i=n*(o-u-M.eps*c),c+i<M.minForce?i=M.minForce-c:c+i>M.maxForce&&(i=M.maxForce-c),E[P]+=i,l+=i>0?i:-i,M.addToWlambda(i)}if(p>l*l)break}for(var w=0;w!==y;w++){var C=v[w],R=C.velocity,A=C.angularVelocity;R.vadd(C.vlambda,R),A&&A.vadd(C.wlambda,A)}}return d}},function(e,t,o){function n(e,t,o,n,a){i.apply(this),this.nx=o||10,this.ny=n||10,this.nz=a||10,this.aabbMin=e||new r(100,100,100),this.aabbMax=t||new r(-100,-100,-100);var s=this.nx*this.ny*this.nz;if(0>=s)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=s,this.binLengths.length=s;for(var l=0;s>l;l++)this.bins[l]=[],this.binLengths[l]=0}e.exports=n;var i=o(428),r=o(416),a=o(422);n.prototype=new i,n.prototype.constructor=n;var s=new r;new r;n.prototype.collisionPairs=function(e,t,o){function n(e,t,o,n,i,r,a){var s=(e-w)*E|0,l=(t-b)*M|0,u=(o-x)*C|0,v=q((n-w)*E),y=q((i-b)*M),g=q((r-x)*C);0>s?s=0:s>=c&&(s=c-1),0>l?l=0:l>=d&&(l=d-1),0>u?u=0:u>=h&&(u=h-1),0>v?v=0:v>=c&&(v=c-1),0>y?y=0:y>=d&&(y=d-1),0>g?g=0:g>=h&&(g=h-1),s*=p,l*=f,u*=m,v*=p,y*=f,g*=m;for(var _=s;v>=_;_+=p)for(var S=l;y>=S;S+=f)for(var P=u;g>=P;P+=m){var R=_+S+P;I[R][z[R]++]=a}}for(var i=e.numObjects(),r=e.bodies,l=this.aabbMax,u=this.aabbMin,c=this.nx,d=this.ny,h=this.nz,p=d*h,f=h,m=1,v=l.x,y=l.y,g=l.z,w=u.x,b=u.y,x=u.z,E=c/(v-w),M=d/(y-b),C=h/(g-x),_=(v-w)/c,S=(y-b)/d,P=(g-x)/h,R=.5*Math.sqrt(_*_+S*S+P*P),A=a.types,B=A.SPHERE,T=A.PLANE,I=(A.BOX,A.COMPOUND,A.CONVEXPOLYHEDRON,this.bins),z=this.binLengths,F=this.bins.length,V=0;V!==F;V++)z[V]=0;for(var q=Math.ceil,u=Math.min,l=Math.max,V=0;V!==i;V++){var L=r[V],k=L.shape;switch(k.type){case B:var N=L.position.x,j=L.position.y,D=L.position.z,O=k.radius;n(N-O,j-O,D-O,N+O,j+O,D+O,L);break;case T:k.worldNormalNeedsUpdate&&k.computeWorldNormal(L.quaternion);var W=k.worldNormal,U=w+.5*_-L.position.x,X=b+.5*S-L.position.y,G=x+.5*P-L.position.z,H=s;H.set(U,X,G);for(var Y=0,Z=0;Y!==c;Y++,Z+=p,H.y=X,H.x+=_)for(var Q=0,K=0;Q!==d;Q++,K+=f,H.z=G,H.y+=S)for(var J=0,$=0;J!==h;J++,$+=m,H.z+=P)if(H.dot(W)<R){var ee=Z+K+$;I[ee][z[ee]++]=L}break;default:L.aabbNeedsUpdate&&L.computeAABB(),n(L.aabb.lowerBound.x,L.aabb.lowerBound.y,L.aabb.lowerBound.z,L.aabb.upperBound.x,L.aabb.upperBound.y,L.aabb.upperBound.z,L)}}for(var V=0;V!==F;V++){var te=z[V];if(te>1)for(var oe=I[V],Y=0;Y!==te;Y++)for(var L=oe[Y],Q=0;Q!==Y;Q++){var ne=oe[Q];this.needBroadphaseCollision(L,ne)&&this.intersectionTest(L,ne,t,o)}}this.makePairsUnique(t,o)}},function(e,t,o){function n(e,t){t=s.defaults(t,{maxValue:null,minValue:null,elementSize:1}),this.data=e,this.maxValue=t.maxValue,this.minValue=t.minValue,this.elementSize=t.elementSize,null===t.minValue&&this.updateMinValue(),null===t.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,i.call(this),this.pillarConvex=new r,this.pillarOffset=new a,this.type=i.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}var i=o(422),r=o(426),a=o(416),s=o(418);e.exports=n,n.prototype=new i,n.prototype.update=function(){this._cachedPillars={}},n.prototype.updateMinValue=function(){for(var e=this.data,t=e[0][0],o=0;o!==e.length;o++)for(var n=0;n!==e[o].length;n++){var i=e[o][n];t>i&&(t=i)}this.minValue=t},n.prototype.updateMaxValue=function(){for(var e=this.data,t=e[0][0],o=0;o!==e.length;o++)for(var n=0;n!==e[o].length;n++){var i=e[o][n];i>t&&(t=i)}this.maxValue=t},n.prototype.setHeightValueAtIndex=function(e,t,o){var n=this.data;n[e][t]=o,this.clearCachedConvexTrianglePillar(e,t,!1),e>0&&(this.clearCachedConvexTrianglePillar(e-1,t,!0),this.clearCachedConvexTrianglePillar(e-1,t,!1)),t>0&&(this.clearCachedConvexTrianglePillar(e,t-1,!0),this.clearCachedConvexTrianglePillar(e,t-1,!1)),t>0&&e>0&&this.clearCachedConvexTrianglePillar(e-1,t-1,!0)},n.prototype.getRectMinMax=function(e,t,o,n,i){i=i||[];for(var r=this.data,a=this.minValue,s=e;o>=s;s++)for(var l=t;n>=l;l++){var u=r[s][l];u>a&&(a=u)}i[0]=this.minValue,i[1]=a},n.prototype.getIndexOfPosition=function(e,t,o,n){var i=this.elementSize,r=this.data,a=Math.floor(e/i),s=Math.floor(t/i);return o[0]=a,o[1]=s,n&&(0>a&&(a=0),0>s&&(s=0),a>=r.length-1&&(a=r.length-1),s>=r[0].length-1&&(s=r[0].length-1)),!(0>a||0>s||a>=r.length-1||s>=r[0].length-1)},n.prototype.getHeightAt=function(e,t,o){var n=[];this.getIndexOfPosition(e,t,n,o);var i=[];return this.getRectMinMax(n[0],n[1]+1,n[0],n[1]+1,i),(i[0]+i[1])/2},n.prototype.getCacheConvexTrianglePillarKey=function(e,t,o){return e+"_"+t+"_"+(o?1:0)},n.prototype.getCachedConvexTrianglePillar=function(e,t,o){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,o)]},n.prototype.setCachedConvexTrianglePillar=function(e,t,o,n,i){this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,o)]={convex:n,offset:i}},n.prototype.clearCachedConvexTrianglePillar=function(e,t,o){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,o)]},n.prototype.getConvexTrianglePillar=function(e,t,o){var n=this.pillarConvex,i=this.pillarOffset;if(this.cacheEnabled){var s=this.getCachedConvexTrianglePillar(e,t,o);if(s)return this.pillarConvex=s.convex,void(this.pillarOffset=s.offset);n=new r,i=new a,this.pillarConvex=n,this.pillarOffset=i}var s=this.data,l=this.elementSize,u=n.faces;n.vertices.length=6;for(var c=0;6>c;c++)n.vertices[c]||(n.vertices[c]=new a);u.length=5;for(var c=0;5>c;c++)u[c]||(u[c]=[]);var d=n.vertices,h=(Math.min(s[e][t],s[e+1][t],s[e][t+1],s[e+1][t+1])-this.minValue)/2+this.minValue;o?(i.set((e+.75)*l,(t+.75)*l,h),d[0].set(.25*l,.25*l,s[e+1][t+1]-h),d[1].set(-.75*l,.25*l,s[e][t+1]-h),d[2].set(.25*l,-.75*l,s[e+1][t]-h),d[3].set(.25*l,.25*l,-h-1),d[4].set(-.75*l,.25*l,-h-1),d[5].set(.25*l,-.75*l,-h-1),u[0][0]=0,u[0][1]=1,u[0][2]=2,u[1][0]=5,u[1][1]=4,u[1][2]=3,u[2][0]=2,u[2][1]=5,u[2][2]=3,u[2][3]=0,u[3][0]=3,u[3][1]=4,u[3][2]=1,u[3][3]=0,u[4][0]=1,u[4][1]=4,u[4][2]=5,u[4][3]=2):(i.set((e+.25)*l,(t+.25)*l,h),d[0].set(-.25*l,-.25*l,s[e][t]-h),d[1].set(.75*l,-.25*l,s[e+1][t]-h),d[2].set(-.25*l,.75*l,s[e][t+1]-h),d[3].set(-.25*l,-.25*l,-h-1),d[4].set(.75*l,-.25*l,-h-1),d[5].set(-.25*l,.75*l,-h-1),u[0][0]=0,u[0][1]=1,u[0][2]=2,u[1][0]=5,u[1][1]=4,u[1][2]=3,u[2][0]=0,u[2][1]=2,u[2][2]=5,u[2][3]=3,u[3][0]=1,u[3][1]=0,u[3][2]=3,u[3][3]=4,u[4][0]=4,u[4][1]=5,u[4][2]=2,u[4][3]=1),n.computeNormals(),n.computeEdges(),n.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(e,t,o,n,i)},n.prototype.calculateLocalInertia=function(e,t){return t=t||new a,t.set(0,0,0),t},n.prototype.volume=function(){return Number.MAX_VALUE},n.prototype.calculateWorldAABB=function(e,t,o,n){o.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},n.prototype.updateBoundingSphereRadius=function(){var e=this.data,t=this.elementSize;this.boundingSphereRadius=new a(e.length*t,e[0].length*t,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},function(e,t,o){function n(e,t,o){o=o||{};var n="undefined"!=typeof o.maxForce?o.maxForce:1e6,l=o.pivotA?o.pivotA.clone():new s,u=o.pivotB?o.pivotB.clone():new s;i.call(this,e,l,t,u,n);var c=this.axisA=o.axisA?o.axisA.clone():new s(1,0,0);c.normalize();var d=this.axisB=o.axisB?o.axisB.clone():new s(1,0,0);d.normalize();var h=this.rotationalEquation1=new r(e,t,o),p=this.rotationalEquation2=new r(e,t,o),f=this.motorEquation=new a(e,t,n);f.enabled=!1,this.equations.push(h,p,f)}e.exports=n;var i=(o(430),o(442)),r=o(444),a=o(452),s=(o(431),o(416));n.prototype=new i,n.constructor=n,n.prototype.enableMotor=function(){this.motorEquation.enabled=!0},n.prototype.disableMotor=function(){this.motorEquation.enabled=!1},n.prototype.setMotorSpeed=function(e){this.motorEquation.targetVelocity=e},n.prototype.setMotorMaxForce=function(e){this.motorEquation.maxForce=e,this.motorEquation.minForce=-e};var l=new s,u=new s;n.prototype.update=function(){var e=this.bodyA,t=this.bodyB,o=this.motorEquation,n=this.rotationalEquation1,r=this.rotationalEquation2,a=l,s=u,c=this.axisA,d=this.axisB;i.prototype.update.call(this),e.quaternion.vmult(c,a),t.quaternion.vmult(d,s),a.tangents(n.axisA,r.axisA),n.axisB.copy(s),r.axisB.copy(s),this.motorEquation.enabled&&(e.quaternion.vmult(this.axisA,o.axisA),t.quaternion.vmult(this.axisB,o.axisB))}},function(e,t,o){function n(e,t,o){o="undefined"!=typeof o?o:1e6,r.call(this,e,t,-o,o),this.axisA=new i,this.axisB=new i,this.targetVelocity=0}e.exports=n;var i=o(416),r=(o(417),o(432));n.prototype=new r,n.prototype.constructor=n,n.prototype.computeB=function(e){var t=(this.a,this.b),o=(this.bi,this.bj,this.axisA),n=this.axisB,i=this.jacobianElementA,r=this.jacobianElementB;i.rotational.copy(o),n.negate(r.rotational);var a=this.computeGW()-this.targetVelocity,s=this.computeGiMf(),l=-a*t-e*s;return l}},function(e,t,o){function n(e,t,o){o=o||{};var n="undefined"!=typeof o.maxForce?o.maxForce:1e6,s=new a,l=new a,u=new a;e.position.vadd(t.position,u),u.scale(.5,u),t.pointToLocalFrame(u,l),e.pointToLocalFrame(u,s),i.call(this,e,s,t,l,n);var c=this.rotationalEquation1=new r(e,t,o),d=this.rotationalEquation2=new r(e,t,o),h=this.rotationalEquation3=new r(e,t,o);this.equations.push(c,d,h)}e.exports=n;var i=(o(430),o(442)),r=o(444),a=(o(452),o(431),o(416));n.prototype=new i,n.constructor=n;new a,new a;n.prototype.update=function(){var e=this.bodyA,t=this.bodyB,o=(this.motorEquation,this.rotationalEquation1),n=this.rotationalEquation2,r=this.rotationalEquation3;i.prototype.update.call(this),e.vectorToWorldFrame(a.UNIT_X,o.axisA),t.vectorToWorldFrame(a.UNIT_Y,o.axisB),e.vectorToWorldFrame(a.UNIT_Y,n.axisA),t.vectorToWorldFrame(a.UNIT_Z,n.axisB),e.vectorToWorldFrame(a.UNIT_Z,r.axisA),t.vectorToWorldFrame(a.UNIT_X,r.axisB)}},function(e,t,o){function n(){i.apply(this)}e.exports=n;var i=o(428),r=o(415);n.prototype=new i,n.prototype.constructor=n,n.prototype.collisionPairs=function(e,t,o){var n,i,r,a,s=e.bodies,l=s.length;for(n=0;n!==l;n++)for(i=0;i!==n;i++)r=s[n],a=s[i],this.needBroadphaseCollision(r,a)&&this.intersectionTest(r,a,t,o)};new r;n.prototype.aabbQuery=function(e,t,o){o=o||[];for(var n=0;n<e.bodies.length;n++){var i=e.bodies[n];i.aabbNeedsUpdate&&i.computeAABB(),i.aabb.overlaps(t)&&o.push(i)}return o}},function(e,t){function o(){this.matrix={}}e.exports=o,o.prototype.get=function(e,t){if(e=e.id,t=t.id,t>e){var o=t;t=e,e=o}return e+"-"+t in this.matrix},o.prototype.set=function(e,t,o){if(e=e.id,t=t.id,t>e){var n=t;t=e,e=n}o?this.matrix[e+"-"+t]=!0:delete this.matrix[e+"-"+t]},o.prototype.reset=function(){this.matrix={}},o.prototype.setNumObjects=function(e){}},function(e,t,o){function n(){i.call(this),this.type=i.types.PARTICLE}e.exports=n;var i=o(422),r=o(416);n.prototype=new i,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(e,t){return t=t||new r,t.set(0,0,0),t},n.prototype.volume=function(){return 0},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},n.prototype.calculateWorldAABB=function(e,t,o,n){o.copy(e),n.copy(e)}},function(e,t,o){function n(e){this.chassisBody=e.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis="undefined"!=typeof e.indexRightAxis?e.indexRightAxis:1,this.indexForwardAxis="undefined"!=typeof e.indexForwardAxis?e.indexForwardAxis:0,this.indexUpAxis="undefined"!=typeof e.indexUpAxis?e.indexUpAxis:2}function i(e,t,o,n,i){var a=0,s=o,l=x,u=E,c=M;e.getVelocityAtWorldPoint(s,l),t.getVelocityAtWorldPoint(s,u),l.vsub(u,c);var d=n.dot(c),h=r(e,o,n),p=r(t,o,n),f=1,m=f/(h+p);return a=-d*m,a>i&&(a=i),-i>a&&(a=-i),a}function r(e,t,o){var n=C,i=_,r=S,a=P;return t.vsub(e.position,n),n.cross(o,i),e.invInertiaWorld.vmult(i,a),a.cross(n,r),e.invMass+o.dot(r)}function a(e,t,o,n,i,r){var a=i.norm2();if(a>1.1)return 0;var s=R,l=A,u=B;e.getVelocityAtWorldPoint(t,s),o.getVelocityAtWorldPoint(n,l),s.vsub(l,u);var c=i.dot(u),d=.2,h=1/(e.invMass+o.invMass),r=-d*c*h;return r}var s=(o(420),o(416)),l=o(423),u=(o(436),o(435)),c=o(458);e.exports=n;var d=(new s,new s,new s,new s),h=new s,p=new s;new u;n.prototype.addWheel=function(e){e=e||{};var t=new c(e),o=this.wheelInfos.length;return this.wheelInfos.push(t),o},n.prototype.setSteeringValue=function(e,t){var o=this.wheelInfos[t];o.steering=e};new s;n.prototype.applyEngineForce=function(e,t){this.wheelInfos[t].engineForce=e},n.prototype.setBrake=function(e,t){this.wheelInfos[t].brake=e},n.prototype.addToWorld=function(e){this.constraints;e.add(this.chassisBody);var t=this;this.preStepCallback=function(){t.updateVehicle(e.dt)},e.addEventListener("preStep",this.preStepCallback),this.world=e},n.prototype.getVehicleAxisWorld=function(e,t){t.set(0===e?1:0,1===e?1:0,2===e?1:0),this.chassisBody.vectorToWorldFrame(t,t)},n.prototype.updateVehicle=function(e){for(var t=this.wheelInfos,o=t.length,n=this.chassisBody,i=0;o>i;i++)this.updateWheelTransform(i);this.currentVehicleSpeedKmHour=3.6*n.velocity.norm();var r=new s;this.getVehicleAxisWorld(this.indexForwardAxis,r),r.dot(n.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var i=0;o>i;i++)this.castRay(t[i]);this.updateSuspension(e);for(var a=new s,l=new s,i=0;o>i;i++){var u=t[i],c=u.suspensionForce;c>u.maxSuspensionForce&&(c=u.maxSuspensionForce),u.raycastResult.hitNormalWorld.scale(c*e,a),u.raycastResult.hitPointWorld.vsub(n.position,l),n.applyImpulse(a,u.raycastResult.hitPointWorld)}this.updateFriction(e);var d=new s,h=new s,p=new s;for(i=0;o>i;i++){var u=t[i];n.getVelocityAtWorldPoint(u.chassisConnectionPointWorld,p);var f=1;switch(this.indexUpAxis){case 1:f=-1}if(u.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,h);var m=h.dot(u.raycastResult.hitNormalWorld);u.raycastResult.hitNormalWorld.scale(m,d),h.vsub(d,h);var v=h.dot(p);u.deltaRotation=f*v*e/u.radius}!u.sliding&&u.isInContact||0===u.engineForce||!u.useCustomSlidingRotationalSpeed||(u.deltaRotation=(u.engineForce>0?1:-1)*u.customSlidingRotationalSpeed*e),Math.abs(u.brake)>Math.abs(u.engineForce)&&(u.deltaRotation=0),u.rotation+=u.deltaRotation,u.deltaRotation*=.99}},n.prototype.updateSuspension=function(e){for(var t=this.chassisBody,o=t.mass,n=this.wheelInfos,i=n.length,r=0;i>r;r++){var a=n[r];if(a.isInContact){var s,l=a.suspensionRestLength,u=a.suspensionLength,c=l-u;s=a.suspensionStiffness*c*a.clippedInvContactDotSuspension;var d,h=a.suspensionRelativeVelocity;d=0>h?a.dampingCompression:a.dampingRelaxation,s-=d*h,a.suspensionForce=s*o,a.suspensionForce<0&&(a.suspensionForce=0)}else a.suspensionForce=0}},n.prototype.removeFromWorld=function(e){this.constraints;e.remove(this.chassisBody),e.removeEventListener("preStep",this.preStepCallback),this.world=null};var f=new s,m=new s;n.prototype.castRay=function(e){var t=f,o=m;this.updateWheelTransformWorld(e);var n=this.chassisBody,i=-1,r=e.suspensionRestLength+e.radius;e.directionWorld.scale(r,t);var a=e.chassisConnectionPointWorld;a.vadd(t,o);var l=e.raycastResult;l.reset();var u=n.collisionResponse;n.collisionResponse=!1,this.world.rayTest(a,o,l),n.collisionResponse=u;var c=l.body;if(e.raycastResult.groundObject=0,c){i=l.distance,e.raycastResult.hitNormalWorld=l.hitNormalWorld,e.isInContact=!0;var d=l.distance;e.suspensionLength=d-e.radius;var h=e.suspensionRestLength-e.maxSuspensionTravel,p=e.suspensionRestLength+e.maxSuspensionTravel;e.suspensionLength<h&&(e.suspensionLength=h),e.suspensionLength>p&&(e.suspensionLength=p,e.raycastResult.reset());var v=e.raycastResult.hitNormalWorld.dot(e.directionWorld),y=new s;n.getVelocityAtWorldPoint(e.raycastResult.hitPointWorld,y);var g=e.raycastResult.hitNormalWorld.dot(y);if(v>=-.1)e.suspensionRelativeVelocity=0,e.clippedInvContactDotSuspension=10;else{var w=-1/v;e.suspensionRelativeVelocity=g*w,e.clippedInvContactDotSuspension=w}}else e.suspensionLength=e.suspensionRestLength+0*e.maxSuspensionTravel,e.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.raycastResult.hitNormalWorld),e.clippedInvContactDotSuspension=1;return i},n.prototype.updateWheelTransformWorld=function(e){e.isInContact=!1;var t=this.chassisBody;t.pointToWorldFrame(e.chassisConnectionPointLocal,e.chassisConnectionPointWorld),t.vectorToWorldFrame(e.directionLocal,e.directionWorld),t.vectorToWorldFrame(e.axleLocal,e.axleWorld)},n.prototype.updateWheelTransform=function(e){var t=d,o=h,n=p,i=this.wheelInfos[e];this.updateWheelTransformWorld(i),i.directionLocal.scale(-1,t),o.copy(i.axleLocal),t.cross(o,n),n.normalize(),o.normalize();var r=i.steering,a=new l;a.setFromAxisAngle(t,r);var s=new l;s.setFromAxisAngle(o,i.rotation);var u=i.worldTransform.quaternion;this.chassisBody.quaternion.mult(a,u),u.mult(s,u),u.normalize();var c=i.worldTransform.position;c.copy(i.directionWorld),c.scale(i.suspensionLength,c),c.vadd(i.chassisConnectionPointWorld,c)};var v=[new s(1,0,0),new s(0,1,0),new s(0,0,1)];n.prototype.getWheelTransformWorld=function(e){return this.wheelInfos[e].worldTransform};var y=new s,g=[],w=[],b=1;n.prototype.updateFriction=function(e){for(var t=y,o=this.wheelInfos,n=o.length,r=this.chassisBody,l=w,u=g,c=0,d=0;n>d;d++){var h=o[d],p=h.raycastResult.body;p&&c++,h.sideImpulse=0,h.forwardImpulse=0,l[d]||(l[d]=new s),u[d]||(u[d]=new s)}for(var d=0;n>d;d++){var h=o[d],p=h.raycastResult.body;if(p){var f=u[d],m=this.getWheelTransformWorld(d);m.vectorToWorldFrame(v[this.indexRightAxis],f);var x=h.raycastResult.hitNormalWorld,E=f.dot(x);x.scale(E,t),f.vsub(t,f),f.normalize(),x.cross(f,l[d]),l[d].normalize(),h.sideImpulse=a(r,h.raycastResult.hitPointWorld,p,h.raycastResult.hitPointWorld,f),h.sideImpulse*=b}}var M=1,C=.5;this.sliding=!1;for(var d=0;n>d;d++){var h=o[d],p=h.raycastResult.body,_=0;if(h.slipInfo=1,p){var S=0,P=h.brake?h.brake:S;_=i(r,p,h.raycastResult.hitPointWorld,l[d],P),_+=h.engineForce*e;var R=P/_;h.slipInfo*=R}if(h.forwardImpulse=0,h.skidInfo=1,p){h.skidInfo=1;var A=h.suspensionForce*e*h.frictionSlip,B=A,T=A*B;h.forwardImpulse=_;var I=h.forwardImpulse*C,z=h.sideImpulse*M,F=I*I+z*z;if(h.sliding=!1,F>T){this.sliding=!0,h.sliding=!0;var R=A/Math.sqrt(F);h.skidInfo*=R}}}if(this.sliding)for(var d=0;n>d;d++){var h=o[d];0!==h.sideImpulse&&h.skidInfo<1&&(h.forwardImpulse*=h.skidInfo,h.sideImpulse*=h.skidInfo)}for(var d=0;n>d;d++){var h=o[d],V=new s;if(V.copy(h.raycastResult.hitPointWorld),0!==h.forwardImpulse){var q=new s;l[d].scale(h.forwardImpulse,q),r.applyImpulse(q,V)}if(0!==h.sideImpulse){var p=h.raycastResult.body,L=new s;L.copy(h.raycastResult.hitPointWorld);var k=new s;u[d].scale(h.sideImpulse,k),r.pointToLocalFrame(V,V),V["xyz"[this.indexUpAxis]]*=h.rollInfluence,r.pointToWorldFrame(V,V),r.applyImpulse(k,V),k.scale(-1,k),p.applyImpulse(k,L)}}};var x=new s,E=new s,M=new s,C=new s,_=new s,S=new s,P=new s,R=new s,A=new s,B=new s},function(e,t,o){function n(e){e=s.defaults(e,{chassisConnectionPointLocal:new i,chassisConnectionPointWorld:new i,directionLocal:new i,directionWorld:new i,axleLocal:new i,axleWorld:new i,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=e.maxSuspensionTravel,this.customSlidingRotationalSpeed=e.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=e.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=e.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=e.chassisConnectionPointWorld.clone(),this.directionLocal=e.directionLocal.clone(),this.directionWorld=e.directionWorld.clone(),this.axleLocal=e.axleLocal.clone(),this.axleWorld=e.axleWorld.clone(),this.suspensionRestLength=e.suspensionRestLength,this.suspensionMaxLength=e.suspensionMaxLength,this.radius=e.radius,this.suspensionStiffness=e.suspensionStiffness,this.dampingCompression=e.dampingCompression,this.dampingRelaxation=e.dampingRelaxation,this.frictionSlip=e.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=e.rollInfluence,this.maxSuspensionForce=e.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=e.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new a,this.worldTransform=new r,this.isInContact=!1}var i=o(416),r=o(427),a=o(436),s=o(418);e.exports=n;var l=new i,u=new i,l=new i;n.prototype.updateWheel=function(e){var t=this.raycastResult;if(this.isInContact){var o=t.hitNormalWorld.dot(t.directionWorld);t.hitPointWorld.vsub(e.position,u),e.getVelocityAtWorldPoint(u,l);var n=t.hitNormalWorld.dot(l);if(o>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var i=-1/o;this.suspensionRelativeVelocity=n*i,this.clippedInvContactDotSuspension=i}}else t.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.hitNormalWorld),this.clippedInvContactDotSuspension=1}},function(e,t,o){function n(e){if(this.wheelBodies=[],this.coordinateSystem="undefined"==typeof e.coordinateSystem?new s(1,2,3):e.coordinateSystem.clone(),this.chassisBody=e.chassisBody,!this.chassisBody){var t=new a(new s(5,2,.5));this.chassisBody=new i(1,t)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var i=o(420),r=o(460),a=o(425),s=o(416),l=o(451);e.exports=n,n.prototype.addWheel=function(e){e=e||{};var t=e.body;t||(t=new i(1,new r(1.2))),this.wheelBodies.push(t),this.wheelForces.push(0);var o=(new s,"undefined"!=typeof e.position?e.position.clone():new s),n=new s;this.chassisBody.pointToWorldFrame(o,n),t.position.set(n.x,n.y,n.z);var a="undefined"!=typeof e.axis?e.axis.clone():new s(0,1,0);this.wheelAxes.push(a);var u=new l(this.chassisBody,t,{pivotA:o,axisA:a,pivotB:s.ZERO,axisB:a,collideConnected:!1});return this.constraints.push(u),this.wheelBodies.length-1},n.prototype.setSteeringValue=function(e,t){var o=this.wheelAxes[t],n=Math.cos(e),i=Math.sin(e),r=o.x,a=o.y;this.constraints[t].axisA.set(n*r-i*a,i*r+n*a,0)},n.prototype.setMotorSpeed=function(e,t){var o=this.constraints[t];o.enableMotor(),o.motorTargetVelocity=e},n.prototype.disableMotor=function(e){var t=this.constraints[e];t.disableMotor()};var u=new s;n.prototype.setWheelForce=function(e,t){this.wheelForces[t]=e},n.prototype.applyWheelForce=function(e,t){var o=this.wheelAxes[t],n=this.wheelBodies[t],i=n.torque;o.scale(e,u),n.vectorToWorldFrame(u,u),i.vadd(u,i)},n.prototype.addToWorld=function(e){for(var t=this.constraints,o=this.wheelBodies.concat([this.chassisBody]),n=0;n<o.length;n++)e.add(o[n]);for(var n=0;n<t.length;n++)e.addConstraint(t[n]);e.addEventListener("preStep",this._update.bind(this))},n.prototype._update=function(){for(var e=this.wheelForces,t=0;t<e.length;t++)this.applyWheelForce(e[t],t)},n.prototype.removeFromWorld=function(e){for(var t=this.constraints,o=this.wheelBodies.concat([this.chassisBody]),n=0;n<o.length;n++)e.remove(o[n]);for(var n=0;n<t.length;n++)e.removeConstraint(t[n])};var c=new s;n.prototype.getWheelSpeed=function(e){var t=this.wheelAxes[e],o=this.wheelBodies[e],n=o.angularVelocity;return this.chassisBody.vectorToWorldFrame(t,c),n.dot(c)}},function(e,t,o){function n(e){if(i.call(this),this.radius=void 0!==e?Number(e):1,this.type=i.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}e.exports=n;var i=o(422),r=o(416);n.prototype=new i,n.prototype.constructor=n,n.prototype.calculateLocalInertia=function(e,t){t=t||new r;var o=2*e*this.radius*this.radius/5;return t.x=o,t.y=o,t.z=o,t},n.prototype.volume=function(){return 4*Math.PI*this.radius/3},n.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},n.prototype.calculateWorldAABB=function(e,t,o,n){for(var i=this.radius,r=["x","y","z"],a=0;a<r.length;a++){var s=r[a];o[s]=e[s]-i,n[s]=e[s]+i}}},function(e,t,o){function n(e){i.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var t=this.axisList;this._addBodyHandler=function(e){t.push(e.body)},this._removeBodyHandler=function(e){var o=t.indexOf(e.body);-1!==o&&t.splice(o,1)},e&&this.setWorld(e)}var i=(o(422),o(428));e.exports=n,n.prototype=new i,n.prototype.setWorld=function(e){this.axisList.length=0;for(var t=0;t<e.bodies.length;t++)this.axisList.push(e.bodies[t]);e.removeEventListener("addBody",this._addBodyHandler),e.removeEventListener("removeBody",this._removeBodyHandler),e.addEventListener("addBody",this._addBodyHandler),e.addEventListener("removeBody",this._removeBodyHandler),this.world=e,this.dirty=!0},n.insertionSortX=function(e){for(var t=1,o=e.length;o>t;t++){for(var n=e[t],i=t-1;i>=0&&!(e[i].aabb.lowerBound.x<=n.aabb.lowerBound.x);i--)e[i+1]=e[i];e[i+1]=n}return e},n.insertionSortY=function(e){for(var t=1,o=e.length;o>t;t++){for(var n=e[t],i=t-1;i>=0&&!(e[i].aabb.lowerBound.y<=n.aabb.lowerBound.y);i--)e[i+1]=e[i];e[i+1]=n}return e},n.insertionSortZ=function(e){for(var t=1,o=e.length;o>t;t++){for(var n=e[t],i=t-1;i>=0&&!(e[i].aabb.lowerBound.z<=n.aabb.lowerBound.z);i--)e[i+1]=e[i];e[i+1]=n}return e},n.prototype.collisionPairs=function(e,t,o){var i,r,a=this.axisList,s=a.length,l=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),i=0;i!==s;i++){var u=a[i];for(r=i+1;s>r;r++){var c=a[r];if(this.needBroadphaseCollision(u,c)){if(!n.checkBounds(u,c,l))break;this.intersectionTest(u,c,t,o)}}}},n.prototype.sortList=function(){for(var e=this.axisList,t=this.axisIndex,o=e.length,i=0;i!==o;i++){var r=e[i];r.aabbNeedsUpdate&&r.computeAABB()}0===t?n.insertionSortX(e):1===t?n.insertionSortY(e):2===t&&n.insertionSortZ(e)},n.checkBounds=function(e,t,o){var n,i;0===o?(n=e.position.x,i=t.position.x):1===o?(n=e.position.y,i=t.position.y):2===o&&(n=e.position.z,i=t.position.z);var r=e.boundingRadius,a=t.boundingRadius,s=n+r,l=i-a;return s>l},n.prototype.autoDetectAxis=function(){for(var e=0,t=0,o=0,n=0,i=0,r=0,a=this.axisList,s=a.length,l=1/s,u=0;u!==s;u++){var c=a[u],d=c.position.x;e+=d,
t+=d*d;var h=c.position.y;o+=h,n+=h*h;var p=c.position.z;i+=p,r+=p*p}var f=t-e*e*l,m=n-o*o*l,v=r-i*i*l;f>m?f>v?this.axisIndex=0:this.axisIndex=2:m>v?this.axisIndex=1:this.axisIndex=2},n.prototype.aabbQuery=function(e,t,o){o=o||[],this.dirty&&(this.sortList(),this.dirty=!1);var n=this.axisIndex,i="x";1===n&&(i="y"),2===n&&(i="z");for(var r=this.axisList,a=(t.lowerBound[i],t.upperBound[i],0);a<r.length;a++){var s=r[a];s.aabbNeedsUpdate&&s.computeAABB(),s.aabb.overlaps(t)&&o.push(s)}return o}},function(e,t,o){function n(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}e.exports=n;var i=(o(422),o(416));o(423),o(456),o(420),o(424);n.prototype.add=function(e){this.particles.push(e),this.neighbors.length<this.particles.length&&this.neighbors.push([])},n.prototype.remove=function(e){var t=this.particles.indexOf(e);-1!==t&&(this.particles.splice(t,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var r=new i;n.prototype.getNeighbors=function(e,t){for(var o=this.particles.length,n=e.id,i=this.smoothingRadius*this.smoothingRadius,a=r,s=0;s!==o;s++){var l=this.particles[s];l.position.vsub(e.position,a),n!==l.id&&a.norm2()<i&&t.push(l)}};var a=new i,s=new i,l=new i,u=new i,c=new i,d=new i;n.prototype.update=function(){for(var e=this.particles.length,t=a,o=this.speedOfSound,n=this.eps,i=0;i!==e;i++){var r=this.particles[i],h=this.neighbors[i];h.length=0,this.getNeighbors(r,h),h.push(this.particles[i]);for(var p=h.length,f=0,m=0;m!==p;m++){r.position.vsub(h[m].position,t);var v=t.norm(),y=this.w(v);f+=h[m].mass*y}this.densities[i]=f,this.pressures[i]=o*o*(this.densities[i]-this.density)}for(var g=s,w=l,b=u,x=c,E=d,i=0;i!==e;i++){var M=this.particles[i];g.set(0,0,0),w.set(0,0,0);for(var C,_,h=this.neighbors[i],p=h.length,m=0;m!==p;m++){var S=h[m];M.position.vsub(S.position,x);var P=x.norm();C=-S.mass*(this.pressures[i]/(this.densities[i]*this.densities[i]+n)+this.pressures[m]/(this.densities[m]*this.densities[m]+n)),this.gradw(x,b),b.mult(C,b),g.vadd(b,g),S.velocity.vsub(M.velocity,E),E.mult(1/(1e-4+this.densities[i]*this.densities[m])*this.viscosity*S.mass,E),_=this.nablaw(P),E.mult(_,E),w.vadd(E,w)}w.mult(M.mass,w),g.mult(M.mass,g),M.force.vadd(w,M.force),M.force.vadd(g,M.force)}},n.prototype.w=function(e){var t=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(t,9))*Math.pow(t*t-e*e,3)},n.prototype.gradw=function(e,t){var o=e.norm(),n=this.smoothingRadius;e.mult(945/(32*Math.PI*Math.pow(n,9))*Math.pow(n*n-o*o,2),t)},n.prototype.nablaw=function(e){var t=this.smoothingRadius,o=945/(32*Math.PI*Math.pow(t,9))*(t*t-e*e)*(7*e*e-3*t*t);return o}},function(e,t,o){function n(e){for(l.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=e,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}function i(e){for(var t=e.length,o=0;o!==t;o++){var n=e[o];if(!(n.visited||n.body.type&p))return n}return!1}function r(e,t,o,n){for(f.push(e),e.visited=!0,t(e,o,n);f.length;)for(var r,a=f.pop();r=i(a.children);)r.visited=!0,t(r,o,n),f.push(r)}function a(e,t,o){t.push(e.body);for(var n=e.eqs.length,i=0;i!==n;i++){var r=e.eqs[i];-1===o.indexOf(r)&&o.push(r)}}function s(e,t){return t.id-e.id}e.exports=n;var l=(o(416),o(423),o(437)),u=o(420);n.prototype=new l;var c=[],d=[],h={bodies:[]},p=u.STATIC,f=[];n.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},n.prototype.solve=function(e,t){for(var o=c,n=this.nodePool,l=t.bodies,u=this.equations,p=u.length,f=l.length,m=this.subsolver;n.length<f;)n.push(this.createNode());o.length=f;for(var v=0;f>v;v++)o[v]=n[v];for(var v=0;v!==f;v++){var y=o[v];y.body=l[v],y.children.length=0,y.eqs.length=0,y.visited=!1}for(var g=0;g!==p;g++){var w=u[g],v=l.indexOf(w.bi),b=l.indexOf(w.bj),x=o[v],E=o[b];x.children.push(E),x.eqs.push(w),E.children.push(x),E.eqs.push(w)}var M,C=0,_=d;m.tolerance=this.tolerance,m.iterations=this.iterations;for(var S=h;M=i(o);){_.length=0,S.bodies.length=0,r(M,a,S.bodies,_);var P=_.length;_=_.sort(s);for(var v=0;v!==P;v++)m.addEquation(_[v]);m.solve(e,S);m.removeAllEquations(),C++}return C}},function(e,t,o){function n(e,t,o){o=o||{},this.restLength="number"==typeof o.restLength?o.restLength:1,this.stiffness=o.stiffness||100,this.damping=o.damping||1,this.bodyA=e,this.bodyB=t,this.localAnchorA=new i,this.localAnchorB=new i,o.localAnchorA&&this.localAnchorA.copy(o.localAnchorA),o.localAnchorB&&this.localAnchorB.copy(o.localAnchorB),o.worldAnchorA&&this.setWorldAnchorA(o.worldAnchorA),o.worldAnchorB&&this.setWorldAnchorB(o.worldAnchorB)}var i=o(416);e.exports=n,n.prototype.setWorldAnchorA=function(e){this.bodyA.pointToLocalFrame(e,this.localAnchorA)},n.prototype.setWorldAnchorB=function(e){this.bodyB.pointToLocalFrame(e,this.localAnchorB)},n.prototype.getWorldAnchorA=function(e){this.bodyA.pointToWorldFrame(this.localAnchorA,e)},n.prototype.getWorldAnchorB=function(e){this.bodyB.pointToWorldFrame(this.localAnchorB,e)};var r=new i,a=new i,s=new i,l=new i,u=new i,c=new i,d=new i,h=new i,p=new i,f=new i,m=new i;n.prototype.applyForce=function(){var e=this.stiffness,t=this.damping,o=this.restLength,n=this.bodyA,i=this.bodyB,v=r,y=a,g=s,w=l,b=m,x=u,E=c,M=d,C=h,_=p,S=f;this.getWorldAnchorA(x),this.getWorldAnchorB(E),x.vsub(n.position,M),E.vsub(i.position,C),E.vsub(x,v);var P=v.norm();y.copy(v),y.normalize(),i.velocity.vsub(n.velocity,g),i.angularVelocity.cross(C,b),g.vadd(b,g),n.angularVelocity.cross(M,b),g.vsub(b,g),y.mult(-e*(P-o)-t*g.dot(y),w),n.force.vsub(w,n.force),i.force.vadd(w,i.force),M.cross(w,_),C.cross(w,S),n.torque.vsub(_,n.torque),i.torque.vadd(S,i.torque)}},function(e,t,o){function n(e,t){i.call(this),this.type=i.types.TRIMESH,this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new s,this.edges=null,this.scale=new r(1,1,1),this.tree=new l,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}e.exports=n;var i=o(422),r=o(416),a=(o(423),o(427)),s=o(415),l=o(466);n.prototype=new i,n.prototype.constructor=n;var u=new r;n.prototype.updateTree=function(){var e=this.tree;e.reset(),e.aabb.copy(this.aabb);var t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;for(var o=new s,n=new r,i=new r,a=new r,l=[n,i,a],u=0;u<this.indices.length/3;u++){var c=3*u;this._getUnscaledVertex(this.indices[c],n),this._getUnscaledVertex(this.indices[c+1],i),this._getUnscaledVertex(this.indices[c+2],a),o.setFromPoints(l),e.insert(o,u)}e.removeEmptyNodes()};var c=new s;n.prototype.getTrianglesInAABB=function(e,t){c.copy(e);var o=this.scale,n=o.x,i=o.y,r=o.z,a=c.lowerBound,s=c.upperBound;return a.x/=n,a.y/=i,a.z/=r,s.x/=n,s.y/=i,s.z/=r,this.tree.aabbQuery(c,t)},n.prototype.setScale=function(e){var t=this.scale.x===this.scale.y===this.scale.z,o=e.x===e.y===e.z;t&&o||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()},n.prototype.updateNormals=function(){for(var e=u,t=this.normals,o=0;o<this.indices.length/3;o++){var i=3*o,r=this.indices[i],a=this.indices[i+1],s=this.indices[i+2];this.getVertex(r,m),this.getVertex(a,v),this.getVertex(s,y),n.computeNormal(v,m,y,e),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z}},n.prototype.updateEdges=function(){for(var e={},t=function(t,o){var n=r>i?i+"_"+r:r+"_"+i;e[n]=!0},o=0;o<this.indices.length/3;o++){var n=3*o,i=this.indices[n],r=this.indices[n+1],a=this.indices[n+2];t(i,r),t(r,a),t(a,i)}var s=Object.keys(e);this.edges=new Int16Array(2*s.length);for(var o=0;o<s.length;o++){var l=s[o].split("_");this.edges[2*o]=parseInt(l[0],10),this.edges[2*o+1]=parseInt(l[1],10)}},n.prototype.getEdgeVertex=function(e,t,o){var n=this.edges[2*e+(t?1:0)];this.getVertex(n,o)};var d=new r,h=new r;n.prototype.getEdgeVector=function(e,t){var o=d,n=h;this.getEdgeVertex(e,0,o),this.getEdgeVertex(e,1,n),n.vsub(o,t)};var p=new r,f=new r;n.computeNormal=function(e,t,o,n){t.vsub(e,f),o.vsub(t,p),p.cross(f,n),n.isZero()||n.normalize()};var m=new r,v=new r,y=new r;n.prototype.getVertex=function(e,t){var o=this.scale;return this._getUnscaledVertex(e,t),t.x*=o.x,t.y*=o.y,t.z*=o.z,t},n.prototype._getUnscaledVertex=function(e,t){var o=3*e,n=this.vertices;return t.set(n[o],n[o+1],n[o+2])},n.prototype.getWorldVertex=function(e,t,o,n){return this.getVertex(e,n),a.pointToWorldFrame(t,o,n,n),n},n.prototype.getTriangleVertices=function(e,t,o,n){var i=3*e;this.getVertex(this.indices[i],t),this.getVertex(this.indices[i+1],o),this.getVertex(this.indices[i+2],n)},n.prototype.getNormal=function(e,t){var o=3*e;return t.set(this.normals[o],this.normals[o+1],this.normals[o+2])};var g=new s;n.prototype.calculateLocalInertia=function(e,t){this.computeLocalAABB(g);var o=g.upperBound.x-g.lowerBound.x,n=g.upperBound.y-g.lowerBound.y,i=g.upperBound.z-g.lowerBound.z;return t.set(1/12*e*(2*n*2*n+2*i*2*i),1/12*e*(2*o*2*o+2*i*2*i),1/12*e*(2*n*2*n+2*o*2*o))};var w=new r;n.prototype.computeLocalAABB=function(e){var t=e.lowerBound,o=e.upperBound,n=this.vertices.length,i=(this.vertices,w);this.getVertex(0,i),t.copy(i),o.copy(i);for(var r=0;r!==n;r++)this.getVertex(r,i),i.x<t.x?t.x=i.x:i.x>o.x&&(o.x=i.x),i.y<t.y?t.y=i.y:i.y>o.y&&(o.y=i.y),i.z<t.z?t.z=i.z:i.z>o.z&&(o.z=i.z)},n.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},n.prototype.updateBoundingSphereRadius=function(){for(var e=0,t=this.vertices,o=new r,n=0,i=t.length/3;n!==i;n++){this.getVertex(n,o);var a=o.norm2();a>e&&(e=a)}this.boundingSphereRadius=Math.sqrt(e)};var b=(new r,new a),x=new s;n.prototype.calculateWorldAABB=function(e,t,o,n){var i=b,r=x;i.position=e,i.quaternion=t,this.aabb.toWorldFrame(i,r),o.copy(r.lowerBound),n.copy(r.upperBound)},n.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},n.createTorus=function(e,t,o,i,r){e=e||1,t=t||.5,o=o||8,i=i||6,r=r||2*Math.PI;for(var a=[],s=[],l=0;o>=l;l++)for(var u=0;i>=u;u++){var c=u/i*r,d=l/o*Math.PI*2,h=(e+t*Math.cos(d))*Math.cos(c),p=(e+t*Math.cos(d))*Math.sin(c),f=t*Math.sin(d);a.push(h,p,f)}for(var l=1;o>=l;l++)for(var u=1;i>=u;u++){var m=(i+1)*l+u-1,v=(i+1)*(l-1)+u-1,y=(i+1)*(l-1)+u,g=(i+1)*l+u;s.push(m,v,g),s.push(v,y,g)}return new n(a,s)}},function(e,t,o){function n(e){e=e||{},this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new r,this.data=[],this.children=[]}function i(e,t){t=t||{},t.root=null,t.aabb=e,n.call(this,t),this.maxDepth="undefined"!=typeof t.maxDepth?t.maxDepth:8}var r=o(415),a=o(416);e.exports=i,i.prototype=new n,n.prototype.reset=function(e,t){this.children.length=this.data.length=0},n.prototype.insert=function(e,t,o){var n=this.data;if(o=o||0,!this.aabb.contains(e))return!1;var i=this.children;if(o<(this.maxDepth||this.root.maxDepth)){var r=!1;i.length||(this.subdivide(),r=!0);for(var a=0;8!==a;a++)if(i[a].insert(e,t,o+1))return!0;r&&(i.length=0)}return n.push(t),!0};var s=new a;n.prototype.subdivide=function(){var e=this.aabb,t=e.lowerBound,o=e.upperBound,i=this.children;i.push(new n({aabb:new r({lowerBound:new a(0,0,0)})}),new n({aabb:new r({lowerBound:new a(1,0,0)})}),new n({aabb:new r({lowerBound:new a(1,1,0)})}),new n({aabb:new r({lowerBound:new a(1,1,1)})}),new n({aabb:new r({lowerBound:new a(0,1,1)})}),new n({aabb:new r({lowerBound:new a(0,0,1)})}),new n({aabb:new r({lowerBound:new a(1,0,1)})}),new n({aabb:new r({lowerBound:new a(0,1,0)})})),o.vsub(t,s),s.scale(.5,s);for(var l=this.root||this,u=0;8!==u;u++){var c=i[u];c.root=l;var d=c.aabb.lowerBound;d.x*=s.x,d.y*=s.y,d.z*=s.z,d.vadd(t,d),d.vadd(s,c.aabb.upperBound)}},n.prototype.aabbQuery=function(e,t){for(var o=(this.data,this.children,[this]);o.length;){var n=o.pop();n.aabb.overlaps(e)&&Array.prototype.push.apply(t,n.data),Array.prototype.push.apply(o,n.children)}return t};var l=new r;n.prototype.rayQuery=function(e,t,o){return e.getAABB(l),l.toLocalFrame(t,l),this.aabbQuery(l,o),o},n.prototype.removeEmptyNodes=function(){for(var e=[this];e.length;){for(var t=e.pop(),o=t.children.length-1;o>=0;o--)t.children[o].data.length||t.children.splice(o,1);Array.prototype.push.apply(e,t.children)}}},function(e,t,o){function n(){u.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new r,this.broadphase=new g,this.bodies=[],this.solver=new s,this.constraints=[],this.narrowphase=new l(this),this.collisionMatrix=new c,this.collisionMatrixPrevious=new c,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new f,this.defaultMaterial=new d("default"),this.defaultContactMaterial=new h(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}e.exports=n;var i=o(422),r=o(416),a=o(423),s=o(448),l=(o(438),o(431),o(440),o(434)),u=o(421),c=o(419),d=o(424),h=o(445),p=o(420),f=o(468),m=o(436),v=o(415),y=o(435),g=o(454);n.prototype=new u;var w=(new v,new y);if(n.prototype.getContactMaterial=function(e,t){return this.contactMaterialTable.get(e.id,t.id)},n.prototype.numObjects=function(){return this.bodies.length},n.prototype.collisionMatrixTick=function(){var e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset()},n.prototype.add=n.prototype.addBody=function(e){-1===this.bodies.indexOf(e)&&(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof p&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.dispatchEvent(this.addBodyEvent))},n.prototype.addConstraint=function(e){this.constraints.push(e)},n.prototype.removeConstraint=function(e){var t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)},n.prototype.rayTest=function(e,t,o){o instanceof m?this.raycastClosest(e,t,{skipBackfaces:!0},o):this.raycastAll(e,t,{skipBackfaces:!0},o)},n.prototype.raycastAll=function(e,t,o,n){return o.mode=y.ALL,o.from=e,o.to=t,o.callback=n,w.intersectWorld(this,o)},n.prototype.raycastAny=function(e,t,o,n){return o.mode=y.ANY,o.from=e,o.to=t,o.result=n,w.intersectWorld(this,o)},n.prototype.raycastClosest=function(e,t,o,n){return o.mode=y.CLOSEST,o.from=e,o.to=t,o.result=n,w.intersectWorld(this,o)},n.prototype.remove=function(e){e.world=null;var t=this.bodies.length-1,o=this.bodies,n=o.indexOf(e);if(-1!==n){o.splice(n,1);for(var i=0;i!==o.length;i++)o[i].index=i;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,this.dispatchEvent(this.removeBodyEvent)}},n.prototype.removeBody=n.prototype.remove,n.prototype.addMaterial=function(e){this.materials.push(e)},n.prototype.addContactMaterial=function(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)},"undefined"==typeof performance&&(performance={}),!performance.now){var b=Date.now();performance.timing&&performance.timing.navigationStart&&(b=performance.timing.navigationStart),performance.now=function(){return Date.now()-b}}var x=new r;n.prototype.step=function(e,t,o){if(o=o||10,t=t||0,0===t)this.internalStep(e),this.time+=e;else{var n=Math.floor((this.time+t)/e)-Math.floor(this.time/e);n=Math.min(n,o);for(var i=performance.now(),r=0;r!==n&&(this.internalStep(e),!(performance.now()-i>1e3*e));r++);this.time+=t;for(var a=this.time%e,s=a/e,l=x,u=this.bodies,c=0;c!==u.length;c++){var d=u[c];d.type!==p.STATIC&&d.sleepState!==p.SLEEPING?(d.position.vsub(d.previousPosition,l),l.scale(s,l),d.position.vadd(l,d.interpolatedPosition)):(d.interpolatedPosition.copy(d.position),d.interpolatedQuaternion.copy(d.quaternion))}}};var E={type:"postStep"},M={type:"preStep"},C={type:"collide",body:null,contact:null},_=[],S=[],P=[],R=[],A=(new r,new r,new r,new r,new r,new r,new r,new r,new r,new a,new a),B=new a,T=new r;n.prototype.internalStep=function(e){this.dt=e;var t,o=this.contacts,n=P,r=R,a=this.numObjects(),s=this.bodies,l=this.solver,u=this.gravity,c=this.doProfiling,d=this.profile,h=p.DYNAMIC,f=this.constraints,m=S,v=(u.norm(),u.x),y=u.y,g=u.z,w=0;for(c&&(t=performance.now()),w=0;w!==a;w++){var b=s[w];if(b.type&h){var x=b.force,I=b.mass;x.x+=I*v,x.y+=I*y,x.z+=I*g}}for(var w=0,z=this.subsystems.length;w!==z;w++)this.subsystems[w].update();c&&(t=performance.now()),n.length=0,r.length=0,this.broadphase.collisionPairs(this,n,r),c&&(d.broadphase=performance.now()-t);var F=f.length;for(w=0;w!==F;w++){var V=f[w];if(!V.collideConnected)for(var q=n.length-1;q>=0;q-=1)(V.bodyA===n[q]&&V.bodyB===r[q]||V.bodyB===n[q]&&V.bodyA===r[q])&&(n.splice(q,1),r.splice(q,1))}this.collisionMatrixTick(),c&&(t=performance.now());var L=_,k=o.length;for(w=0;w!==k;w++)L.push(o[w]);o.length=0;var N=this.frictionEquations.length;for(w=0;w!==N;w++)m.push(this.frictionEquations[w]);this.frictionEquations.length=0,this.narrowphase.getContacts(n,r,this,o,L,this.frictionEquations,m),c&&(d.narrowphase=performance.now()-t),c&&(t=performance.now());for(var w=0;w<this.frictionEquations.length;w++)l.addEquation(this.frictionEquations[w]);for(var j=o.length,D=0;D!==j;D++){var O,V=o[D],b=V.bi,W=V.bj;V.si,V.sj;O=b.material&&W.material?this.getContactMaterial(b.material,W.material)||this.defaultContactMaterial:this.defaultContactMaterial;var U=O.friction;if(b.material&&W.material&&(b.material.friction>=0&&W.material.friction>=0&&(U=b.material.friction*W.material.friction),b.material.restitution>=0&&W.material.restitution>=0&&(V.restitution=b.material.restitution*W.material.restitution)),l.addEquation(V),b.allowSleep&&b.type===p.DYNAMIC&&b.sleepState===p.SLEEPING&&W.sleepState===p.AWAKE&&W.type!==p.STATIC){var X=W.velocity.norm2()+W.angularVelocity.norm2(),G=Math.pow(W.sleepSpeedLimit,2);X>=2*G&&(b._wakeUpAfterNarrowphase=!0)}if(W.allowSleep&&W.type===p.DYNAMIC&&W.sleepState===p.SLEEPING&&b.sleepState===p.AWAKE&&b.type!==p.STATIC){var H=b.velocity.norm2()+b.angularVelocity.norm2(),Y=Math.pow(b.sleepSpeedLimit,2);H>=2*Y&&(W._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(b,W,!0),this.collisionMatrixPrevious.get(b,W)||(C.body=W,C.contact=V,b.dispatchEvent(C),C.body=b,W.dispatchEvent(C))}for(c&&(d.makeContactConstraints=performance.now()-t,t=performance.now()),w=0;w!==a;w++){var b=s[w];b._wakeUpAfterNarrowphase&&(b.wakeUp(),b._wakeUpAfterNarrowphase=!1)}var F=f.length;for(w=0;w!==F;w++){var V=f[w];V.update();for(var q=0,Z=V.equations.length;q!==Z;q++){var Q=V.equations[q];l.addEquation(Q)}}l.solve(e,this),c&&(d.solve=performance.now()-t),l.removeAllEquations();var K=Math.pow;for(w=0;w!==a;w++){var b=s[w];if(b.type&h){var J=K(1-b.linearDamping,e),$=b.velocity;$.mult(J,$);var ee=b.angularVelocity;if(ee){var te=K(1-b.angularDamping,e);ee.mult(te,ee)}}}for(this.dispatchEvent(M),w=0;w!==a;w++){var b=s[w];b.preStep&&b.preStep.call(b)}c&&(t=performance.now());var oe=A,ne=B,ie=this.stepnumber,re=p.DYNAMIC|p.KINEMATIC,ae=ie%(this.quatNormalizeSkip+1)===0,se=this.quatNormalizeFast,le=.5*e;i.types.PLANE,i.types.CONVEXPOLYHEDRON;for(w=0;w!==a;w++){var ue=s[w],ce=ue.force,de=ue.torque;if(ue.type&re&&ue.sleepState!==p.SLEEPING){var he=ue.velocity,pe=ue.angularVelocity,fe=ue.position,me=ue.quaternion,ve=ue.invMass,ye=ue.invInertiaWorld;he.x+=ce.x*ve*e,he.y+=ce.y*ve*e,he.z+=ce.z*ve*e,ue.angularVelocity&&(ye.vmult(de,T),T.mult(e,T),T.vadd(pe,pe)),fe.x+=he.x*e,fe.y+=he.y*e,fe.z+=he.z*e,ue.angularVelocity&&(oe.set(pe.x,pe.y,pe.z,0),oe.mult(me,ne),me.x+=le*ne.x,me.y+=le*ne.y,me.z+=le*ne.z,me.w+=le*ne.w,ae&&(se?me.normalizeFast():me.normalize())),ue.aabb&&(ue.aabbNeedsUpdate=!0),ue.updateInertiaWorld&&ue.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,c&&(d.integrate=performance.now()-t),this.time+=e,this.stepnumber+=1,this.dispatchEvent(E),w=0;w!==a;w++){var b=s[w],ge=b.postStep;ge&&ge.call(b)}if(this.allowSleep)for(w=0;w!==a;w++)s[w].sleepTick(this.time)},n.prototype.clearForces=function(){for(var e=this.bodies,t=e.length,o=0;o!==t;o++){var n=e[o];n.force,n.torque;n.force.set(0,0,0),n.torque.set(0,0,0)}}},function(e,t){function o(){this.data={keys:[]}}e.exports=o,o.prototype.get=function(e,t){if(e>t){var o=t;t=e,e=o}return this.data[e+"-"+t]},o.prototype.set=function(e,t,o){if(e>t){var n=t;t=e,e=n}var i=e+"-"+t;this.get(e,t)||this.data.keys.push(i),this.data[i]=o},o.prototype.reset=function(){for(var e=this.data,t=e.keys;t.length>0;){var o=t.pop();delete e[o]}}},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(257),r=n(i),a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=o(371),w=n(g),b=o(251),x=n(b),E=o(413),M=n(E),C=o(405),_=n(C),S=o(376),P=n(S),R=o(379),A=n(R),B=o(470),T=n(B),I=new x["default"].Vector3(0,0,-1),z=new x["default"].Plane,F=function(e){function t(e,o){(0,u["default"])(this,t);var n=(0,p["default"])(this,(0,s["default"])(t).call(this,e,o));n._onMeshMouseDown=function(e,t){var o=n.refs.camera,i=t.point;n.setState((0,r["default"])({},n._setClickMarker(i.x,i.y,i.z))),z.setFromNormalAndCoplanarPoint(I.clone().applyQuaternion(o.quaternion),i),n._addMouseConstraint(i,e),window.addEventListener("mousemove",n._onMouseMove,!1),window.addEventListener("mouseup",n._onMouseUp,!1)},n._onMouseUp=function(){window.removeEventListener("mousemove",n._onMouseMove,!1),window.removeEventListener("mouseup",n._onMouseUp,!1),n.setState({clickMarkerVisible:!1}),n.world.removeConstraint(n.mouseConstraint),n.mouseConstraint=!1},n._onMouseMove=function(e){var t=n.refs.mouseInput,o=t.getCameraRay(new x["default"].Vector2(e.clientX,e.clientY)),i=z.intersectLine(new x["default"].Line3(o.origin,o.origin.clone().add(o.direction.clone().multiplyScalar(1e4))));i&&(n.setState((0,r["default"])({},n._setClickMarker(i.x,i.y,i.z))),n.jointBody.position.set(i.x,i.y,i.z),n.mouseConstraint.update())};var i=100;n._raycaster=new x["default"].Raycaster,n.fog=new x["default"].Fog(5413,10,40);var a=20;n.lightPosition=new x["default"].Vector3(a,a,a),n.groundQuaternion=(new x["default"].Quaternion).setFromAxisAngle(new x["default"].Vector3(1,0,0),-Math.PI/2),n.cameraPosition=new x["default"].Vector3(10,2,0),n.cameraQuaternion=(new x["default"].Quaternion).setFromAxisAngle(new x["default"].Vector3(0,1,0),Math.PI/2);var l=new M["default"].World,c=[],d=[],h=void 0,f=void 0,m=function(){l.quatNormalizeSkip=0,l.quatNormalizeFast=!1,l.gravity.set(0,-10,0),l.broadphase=new M["default"].NaiveBroadphase;for(var e=5,t=new M["default"].Box(new M["default"].Vec3(.25,.25,.25)),o=function(o){var i=new M["default"].Body({mass:e});i.addShape(t),i.position.set(-2.5+5*Math.random(),2.5+5*Math.random(),-2.5+5*Math.random()),l.addBody(i),c.push(i),d.push(function(e){e&&(e.userData._bodyIndex=o,n.meshes.push(e))})},r=0;i>r;++r)o(r);var a=new M["default"].Plane,s=new M["default"].Body({mass:0});s.addShape(a),s.quaternion.setFromAxisAngle(new M["default"].Vec3(1,0,0),-Math.PI/2),l.addBody(s);var u=new M["default"].Sphere(.1),h=new M["default"].Body({mass:0});h.addShape(u),h.collisionFilterGroup=0,h.collisionFilterMask=0,l.addBody(h),n.jointBody=h};m();var v=1/60,y=function(){l.step(v)},g=function(){return c.map(function(e,t){var o=e.position,n=e.quaternion;return{position:(new x["default"].Vector3).copy(o),quaternion:(new x["default"].Quaternion).copy(n),ref:d[t]}})};return n._onAnimate=function(){y(),n.setState({meshStates:g()}),n.stats.update()},n._addMouseConstraint=function(e,t){var o=e.x,i=e.y,r=e.z;h=c[t];var a=new M["default"].Vec3(o,i,r).vsub(h.position),s=h.quaternion.inverse();f=s.vmult(a),n.jointBody.position.set(o,i,r),n.mouseConstraint=new M["default"].PointToPointConstraint(h,f,n.jointBody,new M["default"].Vec3(0,0,0)),l.addConstraint(n.mouseConstraint),n.world=l},n.state={clickMarkerVisible:!1,clickMarkerPosition:new x["default"].Vector3,meshStates:g()},n.meshes=[],n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"_setClickMarker",value:function(e,t,o){return{clickMarkerPosition:new x["default"].Vector3(e,t,o),clickMarkerVisible:!0}}},{key:"componentDidMount",value:function(){var e=this.refs,t=e.mouseInput,o=e.container;if(this.stats=new A["default"],this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",o.appendChild(this.stats.domElement),!t.isReady()){var n=this.refs,i=n.scene,r=n.camera;t.ready(i,o,r),t.restrictIntersections(this.meshes),t.setActive(!1)}}},{key:"componentDidUpdate",value:function(e){var t=this.refs.mouseInput,o=this.props,n=o.width,i=o.height;n===e.width&&i===e.height||t.containerResized()}},{key:"componentWillUnmount",value:function(){delete this.world,delete this.stats}},{key:"render",value:function(){var e=this,t=this.props,o=t.width,n=t.height,i=this.state,r=i.clickMarkerVisible,a=i.clickMarkerPosition,s=i.meshStates,l=20,u=s.map(function(t,o){var n=t.position,i=t.quaternion;return y["default"].createElement(T["default"],{key:o,position:n,quaternion:i,bodyIndex:o,meshes:e.meshes,onMouseDown:e._onMeshMouseDown})});return y["default"].createElement("div",{ref:"container"},y["default"].createElement(w["default"],{antialias:!0,mainCamera:"camera",width:o,height:n,onAnimate:this._onAnimate,clearColor:this.fog.color,gammaInput:!0,gammaOutput:!0,shadowMapEnabled:!0},y["default"].createElement("module",{ref:"mouseInput",descriptor:_["default"]}),y["default"].createElement("resources",null,y["default"].createElement("boxGeometry",{resourceId:"cubeGeo",width:.5,height:.5,depth:.5,widthSegments:10,heightSegments:10}),y["default"].createElement("meshPhongMaterial",{resourceId:"cubeMaterial",color:8947848})),y["default"].createElement("scene",{ref:"scene",fog:this.fog},y["default"].createElement("perspectiveCamera",{name:"camera",fov:30,aspect:o/n,near:.5,far:1e4,position:this.cameraPosition,quaternion:this.cameraQuaternion,ref:"camera"}),y["default"].createElement("ambientLight",{color:6710886}),y["default"].createElement("directionalLight",{color:16777215,intensity:1.75,castShadow:!0,shadowMapWidth:1024,shadowMapHeight:1024,shadowCameraLeft:-l,shadowCameraRight:l,shadowCameraTop:l,shadowCameraBottom:-l,shadowCameraFar:3*l,shadowCameraNear:l,position:this.lightPosition}),y["default"].createElement("mesh",{castShadow:!0,receiveShadow:!0,quaternion:this.groundQuaternion},y["default"].createElement("planeBufferGeometry",{width:100,height:100,widthSegments:1,heightSegments:1}),y["default"].createElement("meshLambertMaterial",{color:7829367})),u,y["default"].createElement("mesh",{visible:r,position:a},y["default"].createElement("sphereGeometry",{radius:.2,widthSegments:8,heightSegments:8}),y["default"].createElement("meshLambertMaterial",{color:7807505})))))}}]),t}(P["default"]);t["default"]=F},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=o(251),w=n(g),b=y["default"].PropTypes,x=(r=i=function(e){function t(){var e,o,n,i;(0,u["default"])(this,t);for(var r=arguments.length,a=Array(r),l=0;r>l;l++)a[l]=arguments[l];return o=n=(0,p["default"])(this,(e=(0,s["default"])(t)).call.apply(e,[this].concat(a))),n._onMouseDown=function(e,t){e.preventDefault(),n.props.onMouseDown(n.refs.mesh.userData._bodyIndex,t)},i=o,(0,p["default"])(n,i)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){var e=this.refs.mesh,t=this.props,o=t.bodyIndex,n=t.meshes;e.userData._bodyIndex=o,n.push(e)}},{key:"componentWillUnmount",value:function(){var e=this.refs.mesh,t=this.props.meshes;t.splice(t.indexOf(e),1)}},{key:"render",value:function(){var e=this.props,t=e.position,o=e.quaternion;return y["default"].createElement("mesh",{position:t,quaternion:o,ref:"mesh",castShadow:!0,onMouseDown:this._onMouseDown},y["default"].createElement("geometryResource",{resourceId:"cubeGeo"}),y["default"].createElement("materialResource",{resourceId:"cubeMaterial"}))}}]),t}(y["default"].Component),i.propTypes={position:b.instanceOf(w["default"].Vector3).isRequired,quaternion:b.instanceOf(w["default"].Quaternion).isRequired,meshes:b.arrayOf(b.instanceOf(w["default"].Mesh)).isRequired,bodyIndex:b.number.isRequired,onMouseDown:b.func.isRequired},r);t["default"]=x},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(234),r=n(i),a=o(237),s=n(a),l=o(238),u=n(l),c=o(242),d=n(c),h=o(243),p=n(h),f=o(2),m=n(f),v=o(371),y=n(v),g=o(251),w=n(g),b=o(376),x=n(b),E=o(379),M=n(E),C=o(472),_=n(C),S=function(e){function t(e,o){(0,s["default"])(this,t);var n=(0,d["default"])(this,(0,r["default"])(t).call(this,e,o));n._onAnimate=function(){n._updatePhysics(),n._updateGraphics(),n.stats.update()},n._onBodiesSelectChange=function(e){var t=e.target.value;n.bodies.length=t,n._createBodies(),n.setState({numBodies:t,meshStates:n._getMeshStates()}),n._updateGraphics()};var i=200;n.fog=new w["default"].Fog(5413,10,40);var a=20;n.lightPosition=new w["default"].Vector3(a,a,a),n.groundQuaternion=(new w["default"].Quaternion).setFromAxisAngle(new w["default"].Vector3(1,0,0),-Math.PI/2),n.cameraPosition=new w["default"].Vector3(10,2,0),n.cameraQuaternion=(new w["default"].Quaternion).setFromAxisAngle(new w["default"].Vector3(0,1,0),Math.PI/2);var l=[];return l.length=i,n.bodies=l,n._createBodies(),n.state={numBodies:i,meshStates:n._getMeshStates()},n}return(0,p["default"])(t,e),(0,u["default"])(t,[{key:"_getMeshStates",value:function(){return this.bodies.map(function(e){var t=e.position,o=e.quaternion;return{position:(new w["default"].Vector3).copy(t),quaternion:(new w["default"].Quaternion).copy(o)}})}},{key:"_updateGraphics",value:function(){this.setState({meshStates:this._getMeshStates()})}},{key:"_updatePhysics",value:function(){for(var e=(new Date).getTime(),t=this.bodies,o=0;o<t.length;++o){var n=t[o],i=Math.sin(e*n.timeScale);n.quaternion.multiply(n.rotationDeltaPerFrame);var r=n.movementPerFrame;n.position.copy(n.startPosition.clone().add(r.clone().multiplyScalar(i)))}}},{key:"componentDidMount",value:function(){var e=this.refs.container;this.stats=new M["default"],this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",e.appendChild(this.stats.domElement)}},{key:"componentWillUnmount",value:function(){delete this.stats}},{key:"_createBodies",value:function(){for(var e=this.bodies,t=e.length,o=0;t>o;++o)e[o]=this._createBody(o)}},{key:"_createBody",value:function(){var e=new w["default"].Vector3(-2.5+5*Math.random(),.5+5*Math.random(),-2.5+5*Math.random());return{position:e,timeScale:.005*Math.random(),startPosition:e.clone(),movementPerFrame:new w["default"].Vector3(Math.random(),Math.random(),Math.random()),rotationDeltaPerFrame:(new w["default"].Quaternion).setFromEuler(new w["default"].Euler(.05*Math.random(),.05*Math.random(),.05*Math.random())),quaternion:new w["default"].Quaternion}}},{key:"_getInputBox",value:function(e){var t=this.state.numBodies;return m["default"].createElement("div",{style:{position:"absolute",top:0,color:"white",width:"100%",textAlign:"center",background:"rgba(1,1,1,0.75)"}},m["default"].createElement("div",null,e),m["default"].createElement("label",null,"Bodies: ",m["default"].createElement("select",{value:t,onChange:this._onBodiesSelectChange},[10,50,100,200,300,500,1e3,1500,2e3,2500,3e3].map(function(e){return m["default"].createElement("option",{value:e,key:e},e)}))))}},{key:"render",value:function(){var e=this,t=this.props,o=t.width,n=t.height,i=this.state.meshStates,r=20,a=i.map(function(t,o){var n=t.position,i=t.quaternion;return m["default"].createElement(_["default"],{
key:o,position:n,quaternion:i,bodyIndex:o,meshes:e.meshes})});return m["default"].createElement("div",{ref:"container"},this._getInputBox("Rotating Cubes - Through React"),m["default"].createElement(y["default"],{antialias:!0,mainCamera:"camera",width:o,height:n,onAnimate:this._onAnimate,clearColor:this.fog.color,gammaInput:!0,gammaOutput:!0,shadowMapEnabled:!0},m["default"].createElement("resources",null,m["default"].createElement("boxGeometry",{resourceId:"cubeGeo",width:.5,height:.5,depth:.5,widthSegments:10,heightSegments:10}),m["default"].createElement("meshPhongMaterial",{resourceId:"cubeMaterial",color:8947848})),m["default"].createElement("scene",{ref:"scene",fog:this.fog},m["default"].createElement("perspectiveCamera",{name:"camera",fov:30,aspect:o/n,near:.5,far:1e4,position:this.cameraPosition,quaternion:this.cameraQuaternion,ref:"camera"}),m["default"].createElement("ambientLight",{color:6710886}),m["default"].createElement("directionalLight",{color:16777215,intensity:1.75,castShadow:!0,shadowMapWidth:1024,shadowMapHeight:1024,shadowCameraLeft:-r,shadowCameraRight:r,shadowCameraTop:r,shadowCameraBottom:-r,shadowCameraFar:3*r,shadowCameraNear:r,position:this.lightPosition}),m["default"].createElement("mesh",{castShadow:!0,receiveShadow:!0,quaternion:this.groundQuaternion},m["default"].createElement("planeBufferGeometry",{width:100,height:100,widthSegments:1,heightSegments:1}),m["default"].createElement("meshLambertMaterial",{color:7829367})),a)))}}]),t}(x["default"]);t["default"]=S},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i,r,a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(243),m=n(f),v=o(2),y=n(v),g=o(251),w=n(g),b=y["default"].PropTypes,x=new w["default"].Vector3(1,1,1).multiplyScalar(.5),E=(r=i=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.position,o=e.quaternion;return y["default"].createElement("mesh",{position:t,quaternion:o,scale:x,castShadow:!0},y["default"].createElement("geometryResource",{resourceId:"cubeGeo"}),y["default"].createElement("materialResource",{resourceId:"cubeMaterial"}))}}]),t}(y["default"].Component),i.propTypes={position:b.instanceOf(w["default"].Vector3).isRequired,quaternion:b.instanceOf(w["default"].Quaternion).isRequired},r);t["default"]=E},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=o(257),r=n(i),a=o(234),s=n(a),l=o(237),u=n(l),c=o(238),d=n(c),h=o(242),p=n(h),f=o(267),m=n(f),v=o(243),y=n(v),g=o(2),w=n(g),b=o(371),x=n(b),E=o(251),M=n(E),C=o(472),_=n(C),S=o(471),P=n(S),R=function(e){function t(){return(0,u["default"])(this,t),(0,p["default"])(this,(0,s["default"])(t).apply(this,arguments))}return(0,y["default"])(t,e),(0,d["default"])(t,[{key:"_getMeshStates",value:function(){var e=this.bodies;return e.map(function(e){var t=e.position,o=e.quaternion,n=e.ref;return{position:(new M["default"].Vector3).copy(t),quaternion:(new M["default"].Quaternion).copy(o),ref:n}})}},{key:"_bodyRef",value:function(e,t){null!==t&&(this.bodies[e].body=x["default"].findTHREEObject(t))}},{key:"_updateGraphics",value:function(){for(var e=this.bodies,t=0;t<e.length;++t){var o=e[t];o.body&&(o.body.position.copy(o.position),o.body.quaternion.copy(o.quaternion))}}},{key:"_createBody",value:function(e){return(0,r["default"])({},(0,m["default"])((0,s["default"])(t.prototype),"_createBody",this).call(this),{ref:this._bodyRef.bind(this,e)})}},{key:"render",value:function(){var e=this,t=this.props,o=t.width,n=t.height,i=this.state.meshStates,r=20,a=i.map(function(t,o){var n=t.position,i=t.quaternion,r=t.ref;return w["default"].createElement(_["default"],{key:o,position:n,quaternion:i,ref:r,meshes:e.meshes})});return w["default"].createElement("div",{ref:"container"},this._getInputBox("Rotating Cubes - Direct Updates"),w["default"].createElement(x["default"],{antialias:!0,mainCamera:"camera",width:o,height:n,onAnimate:this._onAnimate,clearColor:this.fog.color,gammaInput:!0,gammaOutput:!0,shadowMapEnabled:!0},w["default"].createElement("resources",null,w["default"].createElement("boxGeometry",{resourceId:"cubeGeo",width:.5,height:.5,depth:.5,widthSegments:10,heightSegments:10}),w["default"].createElement("meshPhongMaterial",{resourceId:"cubeMaterial",color:8947848})),w["default"].createElement("scene",{ref:"scene",fog:this.fog},w["default"].createElement("perspectiveCamera",{name:"camera",fov:30,aspect:o/n,near:.5,far:1e4,position:this.cameraPosition,quaternion:this.cameraQuaternion,ref:"camera"}),w["default"].createElement("ambientLight",{color:6710886}),w["default"].createElement("directionalLight",{color:16777215,intensity:1.75,castShadow:!0,shadowMapWidth:1024,shadowMapHeight:1024,shadowCameraLeft:-r,shadowCameraRight:r,shadowCameraTop:r,shadowCameraBottom:-r,shadowCameraFar:3*r,shadowCameraNear:r,position:this.lightPosition}),w["default"].createElement("mesh",{castShadow:!0,receiveShadow:!0,quaternion:this.groundQuaternion},w["default"].createElement("planeBufferGeometry",{width:100,height:100,widthSegments:1,heightSegments:1}),w["default"].createElement("meshLambertMaterial",{color:7829367})),a)))}}]),t}(P["default"]);t["default"]=R},function(e,t,o){e.exports=o(475)},function(e,t,o){"use strict";function n(e){return Math.floor(100*e)/100}function i(e,t,o){e[t]=(e[t]||0)+o}var r=o(23),a=o(476),s=o(28),l=o(18),u=o(477),c={_allMeasurements:[],_mountStack:[0],_injected:!1,start:function(){c._injected||l.injection.injectMeasure(c.measure),c._allMeasurements.length=0,l.enableMeasure=!0},stop:function(){l.enableMeasure=!1},getLastMeasurements:function(){return c._allMeasurements},printExclusive:function(e){e=e||c._allMeasurements;var t=a.getExclusiveSummary(e);console.table(t.map(function(e){return{"Component class name":e.componentName,"Total inclusive time (ms)":n(e.inclusive),"Exclusive mount time (ms)":n(e.exclusive),"Exclusive render time (ms)":n(e.render),"Mount time per instance (ms)":n(e.exclusive/e.count),"Render time per instance (ms)":n(e.render/e.count),Instances:e.count}}))},printInclusive:function(e){e=e||c._allMeasurements;var t=a.getInclusiveSummary(e);console.table(t.map(function(e){return{"Owner > component":e.componentName,"Inclusive time (ms)":n(e.time),Instances:e.count}})),console.log("Total time:",a.getTotalTime(e).toFixed(2)+" ms")},getMeasurementsSummaryMap:function(e){var t=a.getInclusiveSummary(e,!0);return t.map(function(e){return{"Owner > component":e.componentName,"Wasted time (ms)":e.time,Instances:e.count}})},printWasted:function(e){e=e||c._allMeasurements,console.table(c.getMeasurementsSummaryMap(e)),console.log("Total time:",a.getTotalTime(e).toFixed(2)+" ms")},printDOM:function(e){e=e||c._allMeasurements;var t=a.getDOMSummary(e);console.table(t.map(function(e){var t={};return t[r.ID_ATTRIBUTE_NAME]=e.id,t.type=e.type,t.args=JSON.stringify(e.args),t})),console.log("Total time:",a.getTotalTime(e).toFixed(2)+" ms")},_recordWrite:function(e,t,o,n){var i=c._allMeasurements[c._allMeasurements.length-1].writes;i[e]=i[e]||[],i[e].push({type:t,time:o,args:n})},measure:function(e,t,o){return function(){for(var n=arguments.length,r=Array(n),a=0;n>a;a++)r[a]=arguments[a];var l,d,h;if("_renderNewRootComponent"===t||"flushBatchedUpdates"===t)return c._allMeasurements.push({exclusive:{},inclusive:{},render:{},counts:{},writes:{},displayNames:{},totalTime:0,created:{}}),h=u(),d=o.apply(this,r),c._allMeasurements[c._allMeasurements.length-1].totalTime=u()-h,d;if("_mountImageIntoNode"===t||"ReactBrowserEventEmitter"===e||"ReactDOMIDOperations"===e||"CSSPropertyOperations"===e||"DOMChildrenOperations"===e||"DOMPropertyOperations"===e){if(h=u(),d=o.apply(this,r),l=u()-h,"_mountImageIntoNode"===t){var p=s.getID(r[1]);c._recordWrite(p,t,l,r[0])}else if("dangerouslyProcessChildrenUpdates"===t)r[0].forEach(function(e){var t={};null!==e.fromIndex&&(t.fromIndex=e.fromIndex),null!==e.toIndex&&(t.toIndex=e.toIndex),null!==e.textContent&&(t.textContent=e.textContent),null!==e.markupIndex&&(t.markup=r[1][e.markupIndex]),c._recordWrite(e.parentID,e.type,l,t)});else{var f=r[0];"object"==typeof f&&(f=s.getID(r[0])),c._recordWrite(f,t,l,Array.prototype.slice.call(r,1))}return d}if("ReactCompositeComponent"!==e||"mountComponent"!==t&&"updateComponent"!==t&&"_renderValidatedComponent"!==t)return o.apply(this,r);if(this._currentElement.type===s.TopLevelWrapper)return o.apply(this,r);var m="mountComponent"===t?r[0]:this._rootNodeID,v="_renderValidatedComponent"===t,y="mountComponent"===t,g=c._mountStack,w=c._allMeasurements[c._allMeasurements.length-1];if(v?i(w.counts,m,1):y&&(w.created[m]=!0,g.push(0)),h=u(),d=o.apply(this,r),l=u()-h,v)i(w.render,m,l);else if(y){var b=g.pop();g[g.length-1]+=l,i(w.exclusive,m,l-b),i(w.inclusive,m,l)}else i(w.inclusive,m,l);return w.displayNames[m]={current:this.getName(),owner:this._currentElement._owner?this._currentElement._owner.getName():"<root>"},d}}};e.exports=c},function(e,t,o){"use strict";function n(e){for(var t=0,o=0;o<e.length;o++){var n=e[o];t+=n.totalTime}return t}function i(e){var t=[];return e.forEach(function(e){Object.keys(e.writes).forEach(function(o){e.writes[o].forEach(function(e){t.push({id:o,type:c[e.type]||e.type,args:e.args})})})}),t}function r(e){for(var t,o={},n=0;n<e.length;n++){var i=e[n],r=l({},i.exclusive,i.inclusive);for(var a in r)t=i.displayNames[a].current,o[t]=o[t]||{componentName:t,inclusive:0,exclusive:0,render:0,count:0},i.render[a]&&(o[t].render+=i.render[a]),i.exclusive[a]&&(o[t].exclusive+=i.exclusive[a]),i.inclusive[a]&&(o[t].inclusive+=i.inclusive[a]),i.counts[a]&&(o[t].count+=i.counts[a])}var s=[];for(t in o)o[t].exclusive>=u&&s.push(o[t]);return s.sort(function(e,t){return t.exclusive-e.exclusive}),s}function a(e,t){for(var o,n={},i=0;i<e.length;i++){var r,a=e[i],c=l({},a.exclusive,a.inclusive);t&&(r=s(a));for(var d in c)if(!t||r[d]){var h=a.displayNames[d];o=h.owner+" > "+h.current,n[o]=n[o]||{componentName:o,time:0,count:0},a.inclusive[d]&&(n[o].time+=a.inclusive[d]),a.counts[d]&&(n[o].count+=a.counts[d])}}var p=[];for(o in n)n[o].time>=u&&p.push(n[o]);return p.sort(function(e,t){return t.time-e.time}),p}function s(e){var t={},o=Object.keys(e.writes),n=l({},e.exclusive,e.inclusive);for(var i in n){for(var r=!1,a=0;a<o.length;a++)if(0===o[a].indexOf(i)){r=!0;break}e.created[i]&&(r=!0),!r&&e.counts[i]>0&&(t[i]=!0)}return t}var l=o(39),u=1.2,c={_mountImageIntoNode:"set innerHTML",INSERT_MARKUP:"set innerHTML",MOVE_EXISTING:"move",REMOVE_NODE:"remove",SET_MARKUP:"set innerHTML",TEXT_CONTENT:"set textContent",setValueForProperty:"update attribute",setValueForAttribute:"update attribute",deleteValueForProperty:"remove attribute",setValueForStyles:"update styles",replaceNodeWithMarkup:"replace",updateTextContent:"set textContent"},d={getExclusiveSummary:r,getInclusiveSummary:a,getDOMSummary:i,getTotalTime:n};e.exports=d},function(e,t,o){"use strict";var n,i=o(478);n=i.now?function(){return i.now()}:function(){return Date.now()},e.exports=n},function(e,t,o){"use strict";var n,i=o(9);i.canUseDOM&&(n=window.performance||window.msPerformance||window.webkitPerformance),e.exports=n||{}}]);