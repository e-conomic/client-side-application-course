<!DOCTYPE html>
<html>
<head>
	<title>Deep dive into React</title>
	<script src="http://fb.me/react-0.14.7.js"></script>
	<script src="http://fb.me/react-dom-0.14.7.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
</head>
<body>

<div id="root"> </div>
	<script type="text/babel">

	var List = React.createClass({

		render: function() {
			return 	<div>
						{this.props.list.listId} - {this.props.list.listName}
						<InputComponent  validate={this.props.handleInput} />
						<ErrorMessage errorMessage={this.props.errorMessage} />
						<Messages messages={this.filterMessages()} />
					</div>
		},

		filterMessages: function() {
			return this.props.allMessages.filter((m) => {
				m.listId == this.props.list.listId;
			});
		}
	})


	var InputComponent = React.createClass({
		  render: function() {
		    return 	<div>
		    			<input type="text" ref={(component) => this.input = component} />
						<button type="button" onClick={this.validate}>Submit</button>
		    		</div>;
		  },
		  validate: function() {
		  	var message = this.input.value;
		  	this.props.validate(message);
		  }
	});


	var Message = React.createClass({

		getInitialState: function() {
			return {
				listId: 0,
		  		isArchived: false
			}

		},
		render: function() {
		    return
		    	<div >
		    		{this.props.message}
		    	</div>;
		  }
	});

	var ErrorMessage = React.createClass({
		render: function () {

			var style = {
	   			color: 'red',
    		};
			return 	<div style={style}>
						{this.props.errorMessage}
					</div>
		}

	});

	var Messages = React.createClass({
		render: function () {
			return 	<div>
					    <ol>
					   		{this.props.messages.map(function(message) {
					     		return <Message message={message} />;
					     	})}
					    </ol>
      				</div>
		}

	});



	var App = React.createClass({
		getInitialState: function() {
		    return {
		    		listCount: 2,
		    		lists: [{listId: 0, listName: "first list"},{listId: 1, listName: "second list"}],
		    		errorMessage: '',
		    		allMessages: [{listId: 0, text: "testmessage", IsArchived: false}],
		    	};
		},
		render: function() {
			var handleInput = this.handleInput;
			var allMessages = this.state.allMessages;
			return 	<div>
		    			<input type="text" ref={(component) => this.newListName = component} />
						<button type="button" onClick={this.createList}>New List</button>
						<ol>
					   		{this.state.lists.map(function(list, i) {
					    		return <List key={i} handleInput={handleInput} allMessages={allMessages} list={list}/>;
					   		})}
					    </ol>			
					</div>
		},
		handleInput: function(message) {
			if (message.length>200) {
				this.setState({
		          errorMessage: '',
		          allMessages: this.state.allMessages.concat([message]),
		      	});
			} else {
				this.setState({
		          errorMessage: message,
				});
			}
		},
		createList: function() {
			var newList = [{
				listId: this.state.listCount,
				listName: this.newListName
			}];

			this.setState({
		          lists: this.state.lists.concat(newList),
		          listCount: this.state.listCount++
		      	});
		}
	});

	ReactDOM.render(<App />, document.getElementById('root'));


	</script>
</body>
</html>
